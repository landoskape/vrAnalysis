
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for vrAnalysis - Virtual Reality Analysis Package">
      
      
        <meta name="author" content="Andrew Landau">
      
      
        <link rel="canonical" href="https://landoskape.github.io/vrAnalysis/api/processors/">
      
      
        <link rel="prev" href="../registration/">
      
      
        <link rel="next" href="../../examples/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>processors - vrAnalysis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#processors-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="vrAnalysis Documentation" class="md-header__button md-logo" aria-label="vrAnalysis Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            vrAnalysis Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              processors
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/landoskape/vrAnalysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    landoskape/vrAnalysis
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../overview/" class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../workflows/" class="md-tabs__link">
          
  
  
  Workflows

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../sessions/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="vrAnalysis Documentation" class="md-nav__button md-logo" aria-label="vrAnalysis Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    vrAnalysis Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/landoskape/vrAnalysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    landoskape/vrAnalysis
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../b2session/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    b2sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    registration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    processors
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    processors
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Classes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      
        SpkmapProcessor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpkmapProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_centers" class="md-nav__link">
    <span class="md-ellipsis">
      
        dist_centers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_edges" class="md-nav__link">
    <span class="md-ellipsis">
      
        dist_edges
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cache_directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        cache_directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cached_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        cached_dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.check_params_match" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_params_match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dependent_params" class="md-nav__link">
    <span class="md-ellipsis">
      
        dependent_params
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_env_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_env_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_frame_behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_frame_behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_placefield_prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_placefield_prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_processed_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_processed_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_raw_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_raw_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_reliability" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_reliability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_traversals" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_traversals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.load_from_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_from_cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.save_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.show_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        show_cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Maps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.__setitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __setitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.average_trials" class="md-nav__link">
    <span class="md-ellipsis">
      
        average_trials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_environment_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_environment_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_processed_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_processed_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_raw_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_raw_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_environments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_positions" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_positions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_rois" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_rois
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.map_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.nbytes" class="md-nav__link">
    <span class="md-ellipsis">
      
        nbytes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.pop_nan_positions" class="md-nav__link">
    <span class="md-ellipsis">
      
        pop_nan_positions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.raw_to_processed" class="md-nav__link">
    <span class="md-ellipsis">
      
        raw_to_processed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.smooth_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        smooth_maps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reliability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reliability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_by_environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_by_environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_environments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_rois" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_rois
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams" class="md-nav__link">
    <span class="md-ellipsis">
      
        SpkmapParams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpkmapParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.compare" class="md-nav__link">
    <span class="md-ellipsis">
      
        compare
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-separated-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment-Separated Maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reliability-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reliability Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place-field-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Place Field Predictions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traversals-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Traversals Analysis
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Caching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protocol Interface
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/session_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Session Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Classes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      
        SpkmapProcessor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpkmapProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_centers" class="md-nav__link">
    <span class="md-ellipsis">
      
        dist_centers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_edges" class="md-nav__link">
    <span class="md-ellipsis">
      
        dist_edges
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cache_directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        cache_directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cached_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        cached_dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.check_params_match" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_params_match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dependent_params" class="md-nav__link">
    <span class="md-ellipsis">
      
        dependent_params
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_env_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_env_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_frame_behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_frame_behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_placefield_prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_placefield_prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_processed_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_processed_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_raw_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_raw_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_reliability" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_reliability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_traversals" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_traversals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.load_from_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_from_cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.save_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_cache
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.show_cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        show_cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Maps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.__setitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __setitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.average_trials" class="md-nav__link">
    <span class="md-ellipsis">
      
        average_trials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_environment_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_environment_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_processed_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_processed_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.create_raw_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_raw_maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_environments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_positions" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_positions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.filter_rois" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_rois
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.map_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.nbytes" class="md-nav__link">
    <span class="md-ellipsis">
      
        nbytes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.pop_nan_positions" class="md-nav__link">
    <span class="md-ellipsis">
      
        pop_nan_positions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.raw_to_processed" class="md-nav__link">
    <span class="md-ellipsis">
      
        raw_to_processed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Maps.smooth_maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        smooth_maps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reliability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reliability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_by_environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_by_environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_environments" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_environments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.Reliability.filter_rois" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_rois
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams" class="md-nav__link">
    <span class="md-ellipsis">
      
        SpkmapParams
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpkmapParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.compare" class="md-nav__link">
    <span class="md-ellipsis">
      
        compare
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.processors.spkmaps.SpkmapParams.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-separated-maps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment-Separated Maps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reliability-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reliability Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place-field-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Place Field Predictions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traversals-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Traversals Analysis
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Caching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protocol Interface
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="processors-api-reference">Processors API Reference<a class="headerlink" href="#processors-api-reference" title="Permanent link">&para;</a></h1>
<p>The processors module provides data processing pipelines that transform session data into analysis-ready formats. The main component is the <code>SpkmapProcessor</code>, which creates spatial maps of neural activity, behavioral occupancy, and speed.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The processors module contains:</p>
<ul>
<li><strong>SpkmapProcessor</strong>: Main class for processing spike maps from session data</li>
<li><strong>Maps</strong>: Container class for occupancy, speed, and spike maps</li>
<li><strong>Reliability</strong>: Container class for reliability measurements</li>
<li><strong>SpkmapParams</strong>: Configuration parameters for spike map processing</li>
</ul>
<h2 id="core-classes">Core Classes<a class="headerlink" href="#core-classes" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="vrAnalysis.processors.spkmaps.SpkmapProcessor" class="doc doc-heading">
            <code>SpkmapProcessor</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Class for processing and caching spike maps from session data</p>
<p>NOTES ON ENGINEERING:
I want the variables required for processing spkmaps to be properties (@property)
that have hidden attributes for caching. Therefore, we can use the property method
to get the attribute and each property method can do whatever processing is needed
for that attribute. (Uh, duh). Time to get modern. lol.</p>
<p>Right now I've almost got the register_spkmaps method working again (not tested yet)
but now is when the dataclass refactoring comes in.
1. Make it possible to separate the occmap from the spkmap loading.
   - do so by making the preliminary variables properties with caching
2. Consider how to implement smoothing then correctMap functionality -- it should
   be possible to do this in a way that allows me to iteratively try different
   parameterizations without having to go through the whole pipeline again.
3. Consider how / when to implement reliability measures. In PCSS, they're done all
   right there with get_spkmaps. But it's probably not always necessary and can
   actually take a bit of time? It would also be nice to save reliability scores for
   the neurons... but then we'd also need an independent params saving system for them.
4. Re: the point above, I wonder if the one.data loading system is ideal or if I should
   use a more explicit and dedicated SpkmapProcessor saving / loading system.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpkmapProcessor</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for processing and caching spike maps from session data</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">    NOTES ON ENGINEERING:</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    I want the variables required for processing spkmaps to be properties (@property)</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">    that have hidden attributes for caching. Therefore, we can use the property method</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">    to get the attribute and each property method can do whatever processing is needed</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">    for that attribute. (Uh, duh). Time to get modern. lol.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">    Right now I&#39;ve almost got the register_spkmaps method working again (not tested yet)</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">    but now is when the dataclass refactoring comes in.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    1. Make it possible to separate the occmap from the spkmap loading.</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">       - do so by making the preliminary variables properties with caching</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">    2. Consider how to implement smoothing then correctMap functionality -- it should</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">       be possible to do this in a way that allows me to iteratively try different</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">       parameterizations without having to go through the whole pipeline again.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">    3. Consider how / when to implement reliability measures. In PCSS, they&#39;re done all</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">       right there with get_spkmaps. But it&#39;s probably not always necessary and can</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">       actually take a bit of time? It would also be nice to save reliability scores for</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">       the neurons... but then we&#39;d also need an independent params saving system for them.</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">    4. Re: the point above, I wonder if the one.data loading system is ideal or if I should</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">       use a more explicit and dedicated SpkmapProcessor saving / loading system.</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>    <span class="n">session</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SessionData</span><span class="p">,</span> <span class="n">B2Session</span><span class="p">,</span> <span class="n">SessionToSpkmapProtocol</span><span class="p">]</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">SpkmapParams</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>    <span class="n">data_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="c1"># Check if the session provided is compatible with SpkmapProcessing</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">):</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;session must be a SessionData instance, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="c1"># (Don&#39;t check if it&#39;s a SessionToSpkmapProtocol because hasattr() will call properties which loads data...)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="c1"># We need to handle the case where params is a dictionary of partial updates to the default params</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">resolve_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">SpkmapParams</span><span class="p">)</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cached_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the parameter dependencies for a given data type.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">            Type of cached data (&quot;raw_maps&quot;, &quot;processed_maps&quot;, &quot;env_maps&quot;, or &quot;reliability&quot;).</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">        list of str</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">            List of parameter names that affect the cache validity for this data type.</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth_width&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth_width&quot;</span><span class="p">,</span> <span class="s2">&quot;full_trial_flexibility&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                <span class="s2">&quot;dist_step&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="s2">&quot;smooth_width&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="s2">&quot;full_trial_flexibility&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                <span class="s2">&quot;reliability_method&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="p">]</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="c1"># Otherwise just return all params</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function that scrapes the cache directory and shows cached files</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">        data_type: Optional[str] = None</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">            Indicate a data type to filter which parts of the cache to show</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        Prints a formatted table showing cache information including data_type, size,</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        parameters, and modification date. If no cache directory exists, prints a message.</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="c1"># Get the base cache directory</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span class="n">base_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">()</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cache directory found at: </span><span class="si">{</span><span class="n">base_cache_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>            <span class="k">return</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>        <span class="c1"># Collect information about all cache files</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>        <span class="n">cache_info</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>        <span class="c1"># Define the data types to check</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            <span class="n">data_types_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_type</span><span class="p">]</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>            <span class="n">data_types_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;reliability&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">data_types_to_check</span><span class="p">:</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="c1"># Find all parameter files (they define what caches exist)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="n">param_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;params_*.npz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span class="k">for</span> <span class="n">param_file</span> <span class="ow">in</span> <span class="n">param_files</span><span class="p">:</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="c1"># Extract the hash from the filename</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                <span class="n">params_hash</span> <span class="o">=</span> <span class="n">param_file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;params_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                <span class="c1"># Load the parameters</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                    <span class="n">cached_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">param_file</span><span class="p">))</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                    <span class="n">param_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cached_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                    <span class="n">param_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error loading params: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                <span class="c1"># Get file modification time</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                <span class="n">mod_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">param_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                <span class="n">date_str</span> <span class="o">=</span> <span class="n">mod_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>                <span class="c1"># Calculate total size of all related cache files</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>                <span class="n">total_size</span> <span class="o">=</span> <span class="n">param_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>                <span class="k">if</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                    <span class="c1"># For maps, look for data files for each map type</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                        <span class="n">data_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>                        <span class="k">if</span> <span class="n">data_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>                            <span class="n">total_size</span> <span class="o">+=</span> <span class="n">data_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                <span class="k">elif</span> <span class="n">dt</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                    <span class="c1"># For env_maps, look for environment file and individual environment data files</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                    <span class="n">env_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                    <span class="k">if</span> <span class="n">env_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">env_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                        <span class="c1"># Load environments to find all data files</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                            <span class="n">environments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">env_file</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                            <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                                <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                                    <span class="n">data_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                                    <span class="k">if</span> <span class="n">data_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">data_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                            <span class="k">pass</span>  <span class="c1"># Continue even if we can&#39;t load environments</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                <span class="k">elif</span> <span class="n">dt</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>                    <span class="c1"># For reliability, look for environments and reliability data files</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                    <span class="n">env_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                    <span class="n">rel_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_reliability_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                    <span class="k">if</span> <span class="n">env_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">env_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                    <span class="k">if</span> <span class="n">rel_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">rel_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="c1"># Convert size to human readable format</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                <span class="n">size_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_file_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                <span class="n">cache_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                    <span class="p">{</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                        <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size_str</span><span class="p">,</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">param_str</span><span class="p">,</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date_str</span><span class="p">,</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                        <span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">params_hash</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span>  <span class="c1"># Show first 8 chars of hash</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                    <span class="p">}</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                <span class="p">)</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_info</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No cache files found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>            <span class="k">return</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>        <span class="c1"># Format the output as a table</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Cache Files Summary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Data Type&#39;</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Size&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Date&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Hash&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Parameters&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">cache_info</span><span class="p">:</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total cache entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cache_info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_lines</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_format_file_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_bytes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bytes to human-readable format.</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">        size_bytes : int</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">            Size in bytes.</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">        str</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">            Human-readable size string (e.g., &quot;1.5 MB&quot;).</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>        <span class="k">if</span> <span class="n">size_bytes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>            <span class="k">return</span> <span class="s2">&quot;0 B&quot;</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="n">size_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">size_bytes</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)))</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">size_bytes</span> <span class="o">/</span> <span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">size_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cache_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the cache directory path for a given data type.</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">        data_type : str, optional</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">            Type of cached data. If None, returns the base cache directory.</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a><span class="sd">            Default is None.</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">        Path</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">            Path to the cache directory for the specified data type.</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;spkmaps&quot;</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="n">folder_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;spkmaps&quot;</span> <span class="o">/</span> <span class="n">folder_name</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dependent_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dependent parameters for a given data type as a dictionary.</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">            Type of cached data.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">        dict</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">            Dictionary mapping parameter names to their values for the given data type.</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_dependencies</span><span class="p">(</span><span class="n">data_type</span><span class="p">)}</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_params_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the hash of the dependent parameters for a given data type.</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><span class="sd">            Type of cached data.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="sd">        str</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="sd">            SHA256 hash of the dependent parameters (as hexadecimal string).</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_params</span><span class="p">(</span><span class="n">data_type</span><span class="p">),</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Maps</span><span class="p">,</span> <span class="n">Reliability</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the cached parameters and data for a given data type.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">            Type of data being cached (&quot;raw_maps&quot;, &quot;processed_maps&quot;, &quot;env_maps&quot;, or &quot;reliability&quot;).</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">        data : Maps or Reliability</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">            The data object to cache.</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">        Creates the cache directory if it doesn&#39;t exist. Saves parameters as an NPZ file</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">        and data as NPY files, using a hash of the parameters in the filenames.</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>        <span class="n">params_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params_hash</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>        <span class="n">cache_param_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;params_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npz&quot;</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>            <span class="n">cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">cache_param_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_params</span><span class="p">(</span><span class="n">data_type</span><span class="p">))</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>            <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                <span class="n">cache_data_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_data_path</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapname</span><span class="p">))</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>            <span class="n">environments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">environments</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">environments</span><span class="p">):</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                    <span class="n">cache_data_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_data_path</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapname</span><span class="p">)[</span><span class="n">ienv</span><span class="p">])</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>            <span class="n">environments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">environments</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>            <span class="c1"># don&#39;t need data.method because it&#39;s in params...</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_reliability_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown data type: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Maps</span><span class="p">,</span> <span class="n">Reliability</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load cached parameters and data for a given data type.</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">            Type of cached data to load.</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">            A tuple containing:</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">            - The cached data (Maps or Reliability), or None if not found</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">            - A boolean indicating whether valid cache was found</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>        <span class="k">if</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="c1"># If the directory exists, check if there are any cached params that match the expected hash</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>            <span class="n">params_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params_hash</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>            <span class="n">cached_params_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;params_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npz&quot;</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>            <span class="k">if</span> <span class="n">cached_params_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>                <span class="n">cached_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cached_params_path</span><span class="p">))</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>                <span class="c1"># Check if the cached params match the dependent params</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_params_match</span><span class="p">(</span><span class="n">cached_params</span><span class="p">):</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_cache</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">params_hash</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">cached_params</span><span class="p">),</span> <span class="kc">True</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_params_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cached_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the cached params and the current params are the same.</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">        cached_params : dict</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">            The cached params to check against the current params</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">        bool</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">            True if the cached params are nonempty and match the current params, False otherwise</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="k">return</span> <span class="n">cached_params</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">cached_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cached_params</span><span class="p">)</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Maps</span><span class="p">,</span> <span class="n">Reliability</span><span class="p">]:</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load cached data from disk using a parameter hash.</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">        data_type : str</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a><span class="sd">            Type of cached data to load.</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a><span class="sd">        params_hash : str</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a><span class="sd">            Hash string identifying the cached parameters.</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a><span class="sd">        params : dict, optional</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a><span class="sd">            Dictionary of cached parameters. Used for reliability method.</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a><span class="sd">            Default is None.</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a><span class="sd">        Maps or Reliability</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a><span class="sd">            The loaded cached data object.</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a><span class="sd">        ------</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a><span class="sd">        ValueError</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a><span class="sd">            If data_type is not recognized.</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>            <span class="n">cached_data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                <span class="n">cached_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                <span class="k">return</span> <span class="n">Maps</span><span class="o">.</span><span class="n">create_raw_maps</span><span class="p">(</span><span class="o">**</span><span class="n">cached_data</span><span class="p">)</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                <span class="k">return</span> <span class="n">Maps</span><span class="o">.</span><span class="n">create_processed_maps</span><span class="p">(</span><span class="o">**</span><span class="n">cached_data</span><span class="p">)</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>            <span class="n">environments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>            <span class="n">cached_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">environments</span><span class="o">=</span><span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="n">cached_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>                <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>                    <span class="n">cached_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">mmap_mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="k">return</span> <span class="n">Maps</span><span class="o">.</span><span class="n">create_environment_maps</span><span class="p">(</span><span class="o">**</span><span class="n">cached_data</span><span class="p">)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>        <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>            <span class="n">environments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_reliability_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>            <span class="n">method</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;reliability_method&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>            <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">environments</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown data type: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_filter_environments</span><span class="p">(</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="n">envnum</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter the session data to only include trials from certain environments.</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><span class="sd">        envnum : int, iterable of int, or None, optional</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="sd">            Environment number(s) to filter. If None, returns all trials.</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="sd">            Default is None.</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><span class="sd">            Whether to clear the onefile cache after filtering. Default is True.</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a><span class="sd">        np.ndarray</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a><span class="sd">            Boolean array indicating which trials belong to the specified environment(s).</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><span class="sd">        This assumes that the trials are in order. We might want to use the third</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><span class="sd">        output of session.positions to get the &quot;real&quot; trial numbers which aren&#39;t</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">        always contiguous and 0 indexed.</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="k">if</span> <span class="n">envnum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="n">envnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">environments</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="n">envnum</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">envnum</span><span class="p">)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">trial_environment</span><span class="p">,</span> <span class="n">envnum</span><span class="p">)</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dist_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Distance edges for the position bins.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">        np.ndarray</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">            1D array of position bin edges. Shape is (num_positions + 1,).</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">        ------</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">        ValueError</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">            If not all trials have the same environment length.</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><span class="sd">        The number of position bins is determined by dividing the environment</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">        length by dist_step. This property caches the environment length</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">        internally after first access.</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_env_length&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>            <span class="n">env_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">env_length</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env_length</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">env_length</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;SpkmapProcessor (currently) requires all trials to have the same env length!&quot;</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>                <span class="n">env_length</span> <span class="o">=</span> <span class="n">env_length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_env_length</span> <span class="o">=</span> <span class="n">env_length</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="n">num_positions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_length</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dist_step</span><span class="p">)</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_length</span><span class="p">,</span> <span class="n">num_positions</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dist_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Distance centers for the position bins.</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a><span class="sd">        np.ndarray</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="sd">            1D array of position bin centers. Shape is (num_positions,).</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>        <span class="k">return</span> <span class="n">helpers</span><span class="o">.</span><span class="n">edge2center</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span><span class="p">)</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_idx_required_position_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the indices of the position bins that are required for a full trial</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a><span class="sd">        clear_one_cache : bool, default=False</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a><span class="sd">            Whether to clear the onefile cache after getting the indices</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="sd">        np.ndarray</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a><span class="sd">            The indices of the position bins that are required for a trial to be considered full</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>        <span class="n">num_position_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span><span class="p">)</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">full_trial_flexibility</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>            <span class="n">idx_to_required_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_position_bins</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">full_trial_flexibility</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">full_trial_flexibility</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>            <span class="n">idx_to_required_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>        <span class="k">return</span> <span class="n">idx_to_required_bins</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>    <span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_raw_maps</span><span class="p">(</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get raw maps (occupancy, speed, spkmap) from session data.</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a><span class="sd">        This method processes session data to create spatial maps representing</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a><span class="sd">        occupancy, speed, and neural activity across position bins. The maps</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a><span class="sd">        are in raw format (not smoothed or normalized by occupancy).</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="sd">        force_recompute : bool, optional</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">            Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">            Maps instance containing raw occupancy, speed, and spike maps.</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">            Shape: (trials, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">            (trials, positions, rois) for spkmap.</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a><span class="sd">        The method:</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a><span class="sd">        1. Bins positions according to dist_step</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a><span class="sd">        2. Filters by speed threshold</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a><span class="sd">        3. Computes occupancy, speed, and spike maps</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a><span class="sd">        4. Sets unvisited position bins to NaN</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a><span class="sd">        5. Optionally standardizes spike data</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a><span class="sd">        Results are cached based on parameter hash for efficient reuse.</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>        <span class="n">dist_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="n">dist_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>        <span class="n">num_positions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist_centers</span><span class="p">)</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>        <span class="c1"># Get behavioral timestamps and positions</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>        <span class="n">timestamps</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">trial_numbers</span><span class="p">,</span> <span class="n">idx_behave_to_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">positions</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>        <span class="c1"># compute behavioral speed on each sample</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>        <span class="n">within_trial_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>        <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>        <span class="n">speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_duration</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="c1"># do this after division so no /0 errors</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>        <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">sample_duration</span> <span class="o">*</span> <span class="n">within_trial_sample</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>        <span class="c1"># speed 0 in last sample for each trial (it&#39;s undefined)</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>        <span class="n">speeds</span> <span class="o">=</span> <span class="n">speeds</span> <span class="o">*</span> <span class="n">within_trial_sample</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>        <span class="c1"># Convert positions to position bins</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="n">position_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">dist_edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="c1"># get imaging information</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>        <span class="n">frame_time_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">timestamps</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="n">sampling_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_time_stamps</span><span class="p">))</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>        <span class="n">dist_cutoff</span> <span class="o">=</span> <span class="n">sampling_period</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>        <span class="n">delay_position_to_imaging</span> <span class="o">=</span> <span class="n">frame_time_stamps</span><span class="p">[</span><span class="n">idx_behave_to_frame</span><span class="p">]</span> <span class="o">-</span> <span class="n">timestamps</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="c1"># get spiking information</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>        <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>        <span class="n">num_rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;numROIs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="c1"># Do standardization</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">standardize_spks</span><span class="p">:</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>            <span class="n">spks</span> <span class="o">=</span> <span class="n">median_zscore</span><span class="p">(</span><span class="n">spks</span><span class="p">,</span> <span class="n">median_subtract</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">zero_baseline_spks</span><span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>        <span class="c1"># Get high resolution occupancy and speed maps</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>        <span class="n">occmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="n">speedmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">,</span> <span class="n">num_rois</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="n">extra_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>        <span class="c1"># Get maps -- doing this independently for each map allows for more</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>        <span class="c1"># flexibility in which data to load (basically the occmap &amp; speedmap</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>        <span class="c1"># are instantaneous, but the spkmap is a bit slower)</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>        <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>            <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>            <span class="n">occmap</span><span class="p">,</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="n">counts</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>            <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>            <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>            <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>            <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>            <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>        <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>            <span class="n">speedmap</span><span class="p">,</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>            <span class="n">counts</span><span class="p">,</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>            <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>            <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>            <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>            <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>            <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="p">)</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>            <span class="n">spks</span><span class="p">,</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>            <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>            <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>            <span class="n">spkmap</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>            <span class="n">extra_counts</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>            <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>            <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>            <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>            <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>            <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>            <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>            <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>        <span class="p">)</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>        <span class="c1"># Figure out the valid range (outside of this range, set the maps to nan, because their values are not meaningful)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>        <span class="n">position_bin_per_trial</span> <span class="o">=</span> <span class="p">[</span><span class="n">position_bin</span><span class="p">[</span><span class="n">trial_numbers</span> <span class="o">==</span> <span class="n">tnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">tnum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">)]</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>        <span class="c1"># offsetting by 1 because there is a bug in the vrControl software where the first sample is always set</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>        <span class="c1"># to the minimum position (which is 0), but if there is a built-up buffer in the rotary encoder, the position</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>        <span class="c1"># will jump at the second sample. In general this will always work unless the mice have a truly ridiculous</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>        <span class="c1"># speed at the beginning of the trial...</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>        <span class="n">first_valid_bin</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bpb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bpb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">bpb</span><span class="p">)</span> <span class="k">for</span> <span class="n">bpb</span> <span class="ow">in</span> <span class="n">position_bin_per_trial</span><span class="p">]</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>        <span class="n">last_valid_bin</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bpb</span><span class="p">)</span> <span class="k">for</span> <span class="n">bpb</span> <span class="ow">in</span> <span class="n">position_bin_per_trial</span><span class="p">]</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>        <span class="c1"># set bins to nan when mouse didn&#39;t visit them</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>        <span class="n">occmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>        <span class="n">speedmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>        <span class="n">spkmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>        <span class="k">return</span> <span class="n">Maps</span><span class="o">.</span><span class="n">create_raw_maps</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">)</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>    <span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;processed_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_processed_maps</span><span class="p">(</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>        <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get processed maps (smoothed and normalized by occupancy).</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">        This method creates processed maps by:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">        1. Getting raw maps</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">        2. Optionally smoothing with a Gaussian kernel</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><span class="sd">        3. Normalizing speedmap and spkmap by occupancy</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><span class="sd">        4. Reorganizing spkmap to have ROIs as the first dimension</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><span class="sd">        force_recompute : bool, optional</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a><span class="sd">            Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a><span class="sd">            Maps instance containing processed occupancy, speed, and spike maps.</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a><span class="sd">            Shape: (trials, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a><span class="sd">            (rois, trials, positions) for spkmap.</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>        <span class="c1"># Get the raw maps first (don&#39;t need to specify params because they&#39;re already set by this method)</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>        <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_maps</span><span class="p">(</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>            <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>        <span class="p">)</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>        <span class="c1"># Process the maps (smooth, divide by occupancy, and change to ROIs first)</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>        <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">raw_to_processed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">smooth_width</span><span class="p">)</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>    <span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;env_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_env_maps</span><span class="p">(</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>        <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>        <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get processed maps separated by environment.</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a><span class="sd">        This method creates environment-separated maps by:</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><span class="sd">        1. Getting processed maps</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a><span class="sd">        2. Filtering to include only full trials (based on full_trial_flexibility)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><span class="sd">        3. Filtering ROIs if use_session_filters=True</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><span class="sd">        4. Grouping maps by environment</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><span class="sd">        use_session_filters : bool, optional</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><span class="sd">            Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><span class="sd">        force_recompute : bool, optional</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="sd">            Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a><span class="sd">            Maps instance with by_environment=True, containing lists of maps</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a><span class="sd">            for each environment. Shape per environment:</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a><span class="sd">            (trials_in_env, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a><span class="sd">            (rois, trials_in_env, positions) for spkmap.</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>        <span class="c1"># Make sure it&#39;s an iterable -- the output will always be a list</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>        <span class="n">envnum</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>        <span class="c1"># Get the indices of the trials to each environment</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>        <span class="n">idx_each_environment</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_environments</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">envnum</span><span class="p">]</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>        <span class="c1"># Then get the indices of the position bins that are required for a full trial</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>        <span class="n">idx_required_position_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx_required_position_bins</span><span class="p">(</span><span class="n">clear_one_cache</span><span class="p">)</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>        <span class="c1"># Get the processed maps (don&#39;t need to specify params because they&#39;re already set by the decorator)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>        <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">(</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>            <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>            <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>        <span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>        <span class="c1"># Add the list of environments to the maps</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>        <span class="n">maps</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="n">envnum</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>        <span class="c1"># Make a list of the maps we are processing</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>        <span class="n">maps_to_process</span> <span class="o">=</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">()</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>        <span class="c1"># Filter the maps to only include the ROIs we want</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>        <span class="k">if</span> <span class="n">use_session_filters</span><span class="p">:</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>            <span class="n">idx_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>            <span class="n">idx_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;numROIs&quot;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>        <span class="c1"># Filter the maps to only include the full trials</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>        <span class="n">full_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">maps</span><span class="o">.</span><span class="n">occmap</span><span class="p">[:,</span> <span class="n">idx_required_position_bins</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>        <span class="c1"># Implement trial &amp; ROI filtering here</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">maps_to_process</span><span class="p">:</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>            <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>                <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>                <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>        <span class="c1"># Filter the trial indices to only include full trials</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>        <span class="n">idx_each_environment</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>        <span class="c1"># Then group each one by environment</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>        <span class="c1"># -&gt; this is now (trials_in_env, position_bins, ...(roi if spkmap)...)</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>        <span class="n">maps</span><span class="o">.</span><span class="n">by_environment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">maps_to_process</span><span class="p">:</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>            <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>                <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>                <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>        <span class="k">return</span> <span class="n">maps</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>    <span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;reliability&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_reliability</span><span class="p">(</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>        <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>        <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Reliability</span><span class="p">:</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate reliability of spike maps across trials.</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a><span class="sd">        Reliability measures how consistent neural activity is across trials</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a><span class="sd">        within each environment. Multiple methods are supported.</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a><span class="sd">        use_session_filters : bool, optional</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a><span class="sd">            Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><span class="sd">        force_recompute : bool, optional</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a><span class="sd">            Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">        Reliability</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a><span class="sd">            Reliability instance containing reliability values for each ROI</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a><span class="sd">            in each environment. Shape: (num_environments, num_rois).</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="sd">        Supported reliability methods:</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a><span class="sd">        - &quot;leave_one_out&quot;: Leave-one-out cross-validation</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">        - &quot;correlation&quot;: Correlation between trial pairs</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a><span class="sd">        - &quot;mse&quot;: Mean squared error between trial pairs</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a><span class="sd">        All reliability measures require maps with no NaN positions.</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>        <span class="n">envnum</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>        <span class="c1"># A list of the requested environments (all if not specified)</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>        <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">(</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>            <span class="n">use_session_filters</span><span class="o">=</span><span class="n">use_session_filters</span><span class="p">,</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>            <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>            <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;autosave&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># Prevent saving in the case of a recompute</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>        <span class="p">)</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>        <span class="c1"># All reliability measures require no NaNs</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>        <span class="n">maps</span><span class="o">.</span><span class="n">pop_nan_positions</span><span class="p">()</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;leave_one_out&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>            <span class="n">rel_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">helpers</span><span class="o">.</span><span class="n">reliability_loo</span><span class="p">(</span><span class="n">spkmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">spkmap</span> <span class="ow">in</span> <span class="n">maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;correlation&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>            <span class="n">rel_mse</span><span class="p">,</span> <span class="n">rel_cor</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">named_transpose</span><span class="p">([</span><span class="n">helpers</span><span class="o">.</span><span class="n">measureReliability</span><span class="p">(</span><span class="n">spkmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">spkmap</span> <span class="ow">in</span> <span class="n">maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">])</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>            <span class="n">rel_values</span> <span class="o">=</span> <span class="n">rel_mse</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span> <span class="k">else</span> <span class="n">rel_cor</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>        <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>            <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">rel_values</span><span class="p">),</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>            <span class="n">environments</span><span class="o">=</span><span class="n">envnum</span><span class="p">,</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span><span class="p">,</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>        <span class="p">)</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>    <span class="c1"># ------------------- convert between imaging and behavioral time -------------------</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_frame_behavior</span><span class="p">(</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get position and environment data for each imaging frame.</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">        This method aligns behavioral data (position, speed, environment, trial)</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">        to imaging frame timestamps. Returns NaN for frames where no position</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="sd">        data is available (e.g., if the closest behavioral sample is further</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">        away in time than half the sampling period).</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><span class="sd">            A tuple containing four arrays (all with shape (num_frames,)):</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><span class="sd">            - frame_position: Position for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a><span class="sd">            - frame_speed: Speed for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a><span class="sd">            - frame_environment: Environment number for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a><span class="sd">            - frame_trial: Trial number for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.times&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.position&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>        <span class="n">idx_behave_to_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.mpci&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>        <span class="n">trial_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;trials.positionTracking&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>        <span class="n">trial_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trial_start_index</span><span class="p">))</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>        <span class="n">trial_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_start_index</span><span class="p">),</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="n">trial_start_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>        <span class="n">trial_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">,</span> <span class="n">trial_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>        <span class="n">trial_environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;trials.environmentIndex&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>        <span class="n">trial_environment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">trial_environment</span><span class="p">,</span> <span class="n">trial_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>        <span class="n">within_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>        <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>        <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_duration</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>        <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">sample_duration</span> <span class="o">*</span> <span class="n">within_trial</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>        <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">within_trial</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>        <span class="n">frame_timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;mpci.times&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>        <span class="n">difference_timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">timestamps</span> <span class="o">-</span> <span class="n">frame_timestamps</span><span class="p">[</span><span class="n">idx_behave_to_frame</span><span class="p">])</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>        <span class="n">sampling_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">))</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>        <span class="n">dist_cutoff</span> <span class="o">=</span> <span class="n">sampling_period</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>        <span class="n">frame_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>        <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>        <span class="n">helpers</span><span class="o">.</span><span class="n">get_average_frame_position</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">idx_behave_to_frame</span><span class="p">,</span> <span class="n">difference_timestamps</span><span class="p">,</span> <span class="n">dist_cutoff</span><span class="p">,</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>        <span class="n">frame_position</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">count</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>        <span class="n">frame_position</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>        <span class="n">frame_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_position</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>        <span class="n">frame_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>        <span class="c1"># Get a map from frame to behavior time for quick lookup</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>        <span class="n">idx_frame_to_behave</span><span class="p">,</span> <span class="n">dist_frame_to_behave</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">nearestpoint</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>        <span class="n">idx_get_position</span> <span class="o">=</span> <span class="n">dist_frame_to_behave</span> <span class="o">&lt;</span> <span class="n">dist_cutoff</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>        <span class="n">frame_environment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>        <span class="n">frame_environment</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_environment</span><span class="p">[</span><span class="n">idx_frame_to_behave</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]]</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>        <span class="n">frame_environment</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>        <span class="n">frame_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>        <span class="n">frame_trial</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_numbers</span><span class="p">[</span><span class="n">idx_frame_to_behave</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]]</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>        <span class="n">frame_trial</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>        <span class="k">return</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">frame_speed</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">frame_trial</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>    <span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>    <span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_placefield_prediction</span><span class="p">(</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>        <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>        <span class="n">spks_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>        <span class="n">use_speed_threshold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>        <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict neural activity from place field maps.</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a><span class="sd">        This method uses averaged environment maps to predict neural activity</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a><span class="sd">        at each imaging frame based on the animal&#39;s position and environment.</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a><span class="sd">        use_session_filters : bool, optional</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a><span class="sd">            Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><span class="sd">        spks_type : str or None, optional</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><span class="sd">            Type of spike data to use. If None, uses session&#39;s current spks_type.</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a><span class="sd">            Temporarily changes session.spks_type if provided. Default is None.</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">        use_speed_threshold : bool, optional</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><span class="sd">            Whether to only predict for frames where speed exceeds threshold.</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="sd">            Default is True.</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">        clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">            Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><span class="sd">        params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><span class="sd">            Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a><span class="sd">            If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><span class="sd">            Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a><span class="sd">        -------</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a><span class="sd">            A tuple containing:</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a><span class="sd">            - placefield_prediction: Predicted activity array with shape (frames, rois).</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a><span class="sd">              NaN for frames where prediction is not possible.</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a><span class="sd">            - extras: Dictionary with additional information:</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a><span class="sd">              - frame_position_index: Position bin index for each frame</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a><span class="sd">              - frame_environment_index: Environment index for each frame</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a><span class="sd">              - idx_valid: Boolean array indicating valid predictions</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a><span class="sd">        -----</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><span class="sd">        Predictions are based on averaged trial maps. Frames where the animal</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><span class="sd">        is not moving (if use_speed_threshold=True) or where position/environment</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a><span class="sd">        data is unavailable will have NaN predictions.</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>        <span class="k">if</span> <span class="n">spks_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>            <span class="n">_spks_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks_type</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">spks_type</span> <span class="o">=</span> <span class="n">spks_type</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>        <span class="n">frame_position</span><span class="p">,</span> <span class="n">frame_speed</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_behavior</span><span class="p">(</span><span class="n">clear_one_cache</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>        <span class="n">idx_valid</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">frame_position</span><span class="p">)</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>        <span class="k">if</span> <span class="n">use_speed_threshold</span><span class="p">:</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>            <span class="n">idx_valid</span> <span class="o">=</span> <span class="n">idx_valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">frame_speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">)</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>        <span class="c1"># Convert frame position to bins indices</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>        <span class="n">frame_position_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span><span class="p">,</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>        <span class="c1"># Get the place field for each neuron</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="n">env_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="n">use_session_filters</span><span class="p">)</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>        <span class="n">env_maps</span><span class="o">.</span><span class="n">average_trials</span><span class="p">()</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>        <span class="c1"># Convert frame environment to indices</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>        <span class="n">env_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">env</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env_maps</span><span class="o">.</span><span class="n">environments</span><span class="p">)}</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>        <span class="n">frame_environment_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">env_to_idx</span><span class="p">[</span><span class="n">env</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">frame_environment</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>        <span class="c1"># Get the original spks data</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>        <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>        <span class="k">if</span> <span class="n">use_session_filters</span><span class="p">:</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>            <span class="n">spks</span> <span class="o">=</span> <span class="n">spks</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">]</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>        <span class="c1"># Use a numba speed up to get the placefield prediction (single pass simple algorithm)</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>        <span class="n">placefield_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">spks</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>        <span class="n">spkmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">)))</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>        <span class="n">placefield_prediction</span> <span class="o">=</span> <span class="n">placefield_prediction_numba</span><span class="p">(</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>            <span class="n">placefield_prediction</span><span class="p">,</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>            <span class="n">spkmaps</span><span class="p">,</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>            <span class="n">frame_environment_index</span><span class="p">,</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>            <span class="n">frame_position_index</span><span class="p">,</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>            <span class="n">idx_valid</span><span class="p">,</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>        <span class="p">)</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>        <span class="c1"># This will add samples for which a place field was not estimable (at the edges of the environment)</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>        <span class="n">idx_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">placefield_prediction</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="c1"># Reset spks_type</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>        <span class="k">if</span> <span class="n">spks_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">spks_type</span> <span class="o">=</span> <span class="n">_spks_type</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>        <span class="c1"># Include extra details in a dictionary for forward compatibility</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>        <span class="n">extras</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>            <span class="n">frame_position_index</span><span class="o">=</span><span class="n">frame_position_index</span><span class="p">,</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>            <span class="n">frame_environment_index</span><span class="o">=</span><span class="n">frame_environment_index</span><span class="p">,</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>            <span class="n">idx_valid</span><span class="o">=</span><span class="n">idx_valid</span><span class="p">,</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>        <span class="p">)</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>        <span class="k">return</span> <span class="n">placefield_prediction</span><span class="p">,</span> <span class="n">extras</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_traversals</span><span class="p">(</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="n">idx_roi</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="n">idx_env</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>        <span class="n">placefield_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>        <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>        <span class="n">spks</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>        <span class="n">spks_prediction</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract neural activity around place field peak during traversals.</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">        This method identifies trials where the animal passes through a neuron&#39;s</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">        place field peak and extracts activity windows around those moments.</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">        idx_roi : int</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a><span class="sd">            Index of the ROI (neuron) to analyze.</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a><span class="sd">        idx_env : int</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a><span class="sd">            Index of the environment to analyze (index into env_maps.environments).</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a><span class="sd">        width : int, optional</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a><span class="sd">            Number of frames on each side of the peak to include. Total window</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a><span class="sd">            size is 2*width + 1. Default is 10.</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a><span class="sd">        placefield_threshold : float, optional</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a><span class="sd">            Maximum distance from place field peak to include a trial (in spatial units).</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a><span class="sd">            Default is 5.0.</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a><span class="sd">        fill_nan : bool, optional</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a><span class="sd">            Whether to fill NaN values with 0. Default is False.</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a><span class="sd">        spks : np.ndarray, optional</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a><span class="sd">            Spike data array. If None, loads from session. Default is None.</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a><span class="sd">        spks_prediction : np.ndarray, optional</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a><span class="sd">            Place field prediction array. If None, computes it. Default is None.</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a><span class="sd">        -------</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a><span class="sd">            A tuple containing:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a><span class="sd">            - traversals: Array of shape (num_traversals, 2*width+1) containing</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a><span class="sd">              actual neural activity around each traversal.</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a><span class="sd">            - pred_travs: Array of shape (num_traversals, 2*width+1) containing</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a><span class="sd">              predicted activity around each traversal.</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a><span class="sd">        -----</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a><span class="sd">        Only includes trials where the animal passes within placefield_threshold</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a><span class="sd">        of the place field peak. The peak is determined from the averaged spike</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a><span class="sd">        map for the specified ROI and environment.</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>        <span class="n">frame_position</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">frame_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_behavior</span><span class="p">()</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>        <span class="k">if</span> <span class="n">spks_prediction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>            <span class="n">spks_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_placefield_prediction</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>        <span class="k">if</span> <span class="n">spks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>            <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">]</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="k">if</span> <span class="n">spks</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">spks_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spks and spks_prediction must have the same shape&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>        <span class="n">env_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">()</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>        <span class="n">pos_peak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">env_maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">idx_env</span><span class="p">][</span><span class="n">idx_roi</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))]</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>        <span class="n">envnum</span> <span class="o">=</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_env</span><span class="p">]</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>        <span class="n">env_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frame_trial</span><span class="p">[</span><span class="n">frame_environment</span> <span class="o">==</span> <span class="n">envnum</span><span class="p">])</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>        <span class="n">num_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">env_trials</span><span class="p">)</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>        <span class="n">idx_traversal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>        <span class="k">for</span> <span class="n">itrial</span><span class="p">,</span> <span class="n">trialnum</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env_trials</span><span class="p">):</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>            <span class="n">idx_trial</span> <span class="o">=</span> <span class="n">frame_trial</span> <span class="o">==</span> <span class="n">trialnum</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>            <span class="n">idx_closest_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_position</span> <span class="o">-</span> <span class="n">pos_peak</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10000</span> <span class="o">*</span> <span class="o">~</span><span class="n">idx_trial</span><span class="p">)</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>            <span class="c1"># Only include the trial if the closest position is within placefield threshold of the peak</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_position</span><span class="p">[</span><span class="n">idx_closest_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos_peak</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">placefield_threshold</span><span class="p">:</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>                <span class="n">idx_traversal</span><span class="p">[</span><span class="n">itrial</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_closest_pos</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>        <span class="c1"># Filter out trials that don&#39;t have a traversal</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>        <span class="n">idx_traversal</span> <span class="o">=</span> <span class="n">idx_traversal</span><span class="p">[</span><span class="n">idx_traversal</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>        <span class="c1"># Get traversals through place field in requested environment</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>        <span class="n">traversals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">),</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>        <span class="n">pred_travs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">),</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">):</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>            <span class="n">istart</span> <span class="o">=</span> <span class="n">it</span> <span class="o">-</span> <span class="n">width</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>            <span class="n">iend</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>            <span class="n">istartoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">istart</span><span class="p">)</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>            <span class="n">iendoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">spks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>            <span class="n">traversals</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">]</span> <span class="o">=</span> <span class="n">spks</span><span class="p">[</span><span class="n">istart</span> <span class="o">+</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">,</span> <span class="n">idx_roi</span><span class="p">]</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>            <span class="n">pred_travs</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">]</span> <span class="o">=</span> <span class="n">spks_prediction</span><span class="p">[</span><span class="n">istart</span> <span class="o">+</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">,</span> <span class="n">idx_roi</span><span class="p">]</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>        <span class="k">if</span> <span class="n">fill_nan</span><span class="p">:</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>            <span class="n">traversals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">traversals</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>            <span class="n">pred_travs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pred_travs</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>        <span class="k">return</span> <span class="n">traversals</span><span class="p">,</span> <span class="n">pred_travs</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_centers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dist_centers</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_centers" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Distance centers for the position bins.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of position bin centers. Shape is (num_positions,).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dist_edges</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dist_edges" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Distance edges for the position bins.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1D array of position bin edges. Shape is (num_positions + 1,).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not all trials have the same environment length.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The number of position bins is determined by dividing the environment
length by dist_step. This property caches the environment length
internally after first access.</p>
</details>
    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.cache_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cache_directory" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the cache directory path for a given data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of cached data. If None, returns the base cache directory.
Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the cache directory for the specified data type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="k">def</span><span class="w"> </span><span class="nf">cache_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the cache directory path for a given data type.</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">    data_type : str, optional</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">        Type of cached data. If None, returns the base cache directory.</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a><span class="sd">        Default is None.</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">    Path</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">        Path to the cache directory for the specified data type.</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;spkmaps&quot;</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>        <span class="n">folder_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;spkmaps&quot;</span> <span class="o">/</span> <span class="n">folder_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.cached_dependencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cached_dependencies</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.cached_dependencies" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the parameter dependencies for a given data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of cached data ("raw_maps", "processed_maps", "env_maps", or "reliability").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of parameter names that affect the cache validity for this data type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="k">def</span><span class="w"> </span><span class="nf">cached_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the parameter dependencies for a given data type.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">    data_type : str</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        Type of cached data (&quot;raw_maps&quot;, &quot;processed_maps&quot;, &quot;env_maps&quot;, or &quot;reliability&quot;).</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    list of str</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">        List of parameter names that affect the cache validity for this data type.</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth_width&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;dist_step&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span> <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth_width&quot;</span><span class="p">,</span> <span class="s2">&quot;full_trial_flexibility&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="s2">&quot;dist_step&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="s2">&quot;speed_threshold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="s2">&quot;speed_max_allowed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="s2">&quot;standardize_spks&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>            <span class="s2">&quot;smooth_width&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="s2">&quot;full_trial_flexibility&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="s2">&quot;reliability_method&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="p">]</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="c1"># Otherwise just return all params</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.check_params_match" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_params_match</span><span class="p">(</span><span class="n">cached_params</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.check_params_match" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if the cached params and the current params are the same.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cached_params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cached params to check against the current params</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the cached params are nonempty and match the current params, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1373" name="__codelineno-0-1373"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_params_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cached_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the cached params and the current params are the same.</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">    cached_params : dict</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">        The cached params to check against the current params</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">    bool</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">        True if the cached params are nonempty and match the current params, False otherwise</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>    <span class="k">return</span> <span class="n">cached_params</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">cached_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cached_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.dependent_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dependent_params</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.dependent_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the dependent parameters for a given data type as a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of cached data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping parameter names to their values for the given data type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1275" name="__codelineno-0-1275"></a><span class="k">def</span><span class="w"> </span><span class="nf">dependent_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the dependent parameters for a given data type as a dictionary.</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="sd">    data_type : str</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="sd">        Type of cached data.</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">    dict</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">        Dictionary mapping parameter names to their values for the given data type.</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached_dependencies</span><span class="p">(</span><span class="n">data_type</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_env_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_env_maps</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_recompute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_env_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get processed maps separated by environment.</p>
<p>This method creates environment-separated maps by:
1. Getting processed maps
2. Filtering to include only full trials (based on full_trial_flexibility)
3. Filtering ROIs if use_session_filters=True
4. Grouping maps by environment</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_session_filters</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to filter ROIs using session.idx_rois. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_recompute</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force recomputation even if cached data exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance with by_environment=True, containing lists of maps
for each environment. Shape per environment:
(trials_in_env, positions) for occmap/speedmap,
(rois, trials_in_env, positions) for spkmap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;env_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_env_maps</span><span class="p">(</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>    <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get processed maps separated by environment.</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a><span class="sd">    This method creates environment-separated maps by:</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><span class="sd">    1. Getting processed maps</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a><span class="sd">    2. Filtering to include only full trials (based on full_trial_flexibility)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><span class="sd">    3. Filtering ROIs if use_session_filters=True</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><span class="sd">    4. Grouping maps by environment</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><span class="sd">    use_session_filters : bool, optional</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><span class="sd">        Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><span class="sd">    force_recompute : bool, optional</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="sd">        Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a><span class="sd">        Maps instance with by_environment=True, containing lists of maps</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a><span class="sd">        for each environment. Shape per environment:</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a><span class="sd">        (trials_in_env, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a><span class="sd">        (rois, trials_in_env, positions) for spkmap.</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>    <span class="c1"># Make sure it&#39;s an iterable -- the output will always be a list</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>    <span class="n">envnum</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>    <span class="c1"># Get the indices of the trials to each environment</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>    <span class="n">idx_each_environment</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_environments</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">envnum</span><span class="p">]</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>    <span class="c1"># Then get the indices of the position bins that are required for a full trial</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>    <span class="n">idx_required_position_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idx_required_position_bins</span><span class="p">(</span><span class="n">clear_one_cache</span><span class="p">)</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>    <span class="c1"># Get the processed maps (don&#39;t need to specify params because they&#39;re already set by the decorator)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>    <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">(</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>        <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>        <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>    <span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>    <span class="c1"># Add the list of environments to the maps</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>    <span class="n">maps</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="n">envnum</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>    <span class="c1"># Make a list of the maps we are processing</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>    <span class="n">maps_to_process</span> <span class="o">=</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">()</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>    <span class="c1"># Filter the maps to only include the ROIs we want</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>    <span class="k">if</span> <span class="n">use_session_filters</span><span class="p">:</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>        <span class="n">idx_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>        <span class="n">idx_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;numROIs&quot;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>    <span class="c1"># Filter the maps to only include the full trials</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>    <span class="n">full_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">maps</span><span class="o">.</span><span class="n">occmap</span><span class="p">[:,</span> <span class="n">idx_required_position_bins</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>    <span class="c1"># Implement trial &amp; ROI filtering here</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">maps_to_process</span><span class="p">:</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>        <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>            <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>            <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>    <span class="c1"># Filter the trial indices to only include full trials</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>    <span class="n">idx_each_environment</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">full_trials</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>    <span class="c1"># Then group each one by environment</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>    <span class="c1"># -&gt; this is now (trials_in_env, position_bins, ...(roi if spkmap)...)</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>    <span class="n">maps</span><span class="o">.</span><span class="n">by_environment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">maps_to_process</span><span class="p">:</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>        <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>            <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>            <span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_each_environment</span><span class="p">]</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>    <span class="k">return</span> <span class="n">maps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_frame_behavior" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_frame_behavior</span><span class="p">(</span><span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_frame_behavior" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get position and environment data for each imaging frame.</p>
<p>This method aligns behavioral data (position, speed, environment, trial)
to imaging frame timestamps. Returns NaN for frames where no position
data is available (e.g., if the closest behavioral sample is further
away in time than half the sampling period).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing four arrays (all with shape (num_frames,)):
- frame_position: Position for each frame (NaN if unavailable)
- frame_speed: Speed for each frame (NaN if unavailable)
- frame_environment: Environment number for each frame (NaN if unavailable)
- frame_trial: Trial number for each frame (NaN if unavailable)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_frame_behavior</span><span class="p">(</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get position and environment data for each imaging frame.</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">    This method aligns behavioral data (position, speed, environment, trial)</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">    to imaging frame timestamps. Returns NaN for frames where no position</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="sd">    data is available (e.g., if the closest behavioral sample is further</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">    away in time than half the sampling period).</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><span class="sd">        A tuple containing four arrays (all with shape (num_frames,)):</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><span class="sd">        - frame_position: Position for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a><span class="sd">        - frame_speed: Speed for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a><span class="sd">        - frame_environment: Environment number for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a><span class="sd">        - frame_trial: Trial number for each frame (NaN if unavailable)</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.times&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.position&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>    <span class="n">idx_behave_to_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;positionTracking.mpci&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>    <span class="n">trial_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;trials.positionTracking&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>    <span class="n">trial_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trial_start_index</span><span class="p">))</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>    <span class="n">trial_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_start_index</span><span class="p">),</span> <span class="n">num_samples</span> <span class="o">-</span> <span class="n">trial_start_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>    <span class="n">trial_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">,</span> <span class="n">trial_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>    <span class="n">trial_environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;trials.environmentIndex&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>    <span class="n">trial_environment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">trial_environment</span><span class="p">,</span> <span class="n">trial_lengths</span><span class="p">)</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>    <span class="n">within_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>    <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>    <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_duration</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>    <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">sample_duration</span> <span class="o">*</span> <span class="n">within_trial</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>    <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">*</span> <span class="n">within_trial</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>    <span class="n">frame_timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">loadone</span><span class="p">(</span><span class="s2">&quot;mpci.times&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>    <span class="n">difference_timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">timestamps</span> <span class="o">-</span> <span class="n">frame_timestamps</span><span class="p">[</span><span class="n">idx_behave_to_frame</span><span class="p">])</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>    <span class="n">sampling_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">))</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>    <span class="n">dist_cutoff</span> <span class="o">=</span> <span class="n">sampling_period</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>    <span class="n">frame_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>    <span class="n">helpers</span><span class="o">.</span><span class="n">get_average_frame_position</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">idx_behave_to_frame</span><span class="p">,</span> <span class="n">difference_timestamps</span><span class="p">,</span> <span class="n">dist_cutoff</span><span class="p">,</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>    <span class="n">frame_position</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">count</span><span class="p">[</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>    <span class="n">frame_position</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>    <span class="n">frame_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_position</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>    <span class="n">frame_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>    <span class="c1"># Get a map from frame to behavior time for quick lookup</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>    <span class="n">idx_frame_to_behave</span><span class="p">,</span> <span class="n">dist_frame_to_behave</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">nearestpoint</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>    <span class="n">idx_get_position</span> <span class="o">=</span> <span class="n">dist_frame_to_behave</span> <span class="o">&lt;</span> <span class="n">dist_cutoff</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>    <span class="n">frame_environment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>    <span class="n">frame_environment</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_environment</span><span class="p">[</span><span class="n">idx_frame_to_behave</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]]</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>    <span class="n">frame_environment</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>    <span class="n">frame_trial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame_timestamps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>    <span class="n">frame_trial</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial_numbers</span><span class="p">[</span><span class="n">idx_frame_to_behave</span><span class="p">[</span><span class="n">idx_get_position</span><span class="p">]]</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>    <span class="n">frame_trial</span><span class="p">[</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>    <span class="k">return</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">frame_speed</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">frame_trial</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_placefield_prediction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_placefield_prediction</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spks_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_speed_threshold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_placefield_prediction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Predict neural activity from place field maps.</p>
<p>This method uses averaged environment maps to predict neural activity
at each imaging frame based on the animal's position and environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_session_filters</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to filter ROIs using session.idx_rois. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spks_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of spike data to use. If None, uses session's current spks_type.
Temporarily changes session.spks_type if provided. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_speed_threshold</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to only predict for frames where speed exceeds threshold.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- placefield_prediction: Predicted activity array with shape (frames, rois).
  NaN for frames where prediction is not possible.
- extras: Dictionary with additional information:
  - frame_position_index: Position bin index for each frame
  - frame_environment_index: Environment index for each frame
  - idx_valid: Boolean array indicating valid predictions</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Predictions are based on averaged trial maps. Frames where the animal
is not moving (if use_speed_threshold=True) or where position/environment
data is unavailable will have NaN predictions.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_placefield_prediction</span><span class="p">(</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>    <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>    <span class="n">spks_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>    <span class="n">use_speed_threshold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict neural activity from place field maps.</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a><span class="sd">    This method uses averaged environment maps to predict neural activity</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a><span class="sd">    at each imaging frame based on the animal&#39;s position and environment.</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a><span class="sd">    use_session_filters : bool, optional</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a><span class="sd">        Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><span class="sd">    spks_type : str or None, optional</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><span class="sd">        Type of spike data to use. If None, uses session&#39;s current spks_type.</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a><span class="sd">        Temporarily changes session.spks_type if provided. Default is None.</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">    use_speed_threshold : bool, optional</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><span class="sd">        Whether to only predict for frames where speed exceeds threshold.</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="sd">        Default is True.</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a><span class="sd">        - placefield_prediction: Predicted activity array with shape (frames, rois).</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a><span class="sd">          NaN for frames where prediction is not possible.</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a><span class="sd">        - extras: Dictionary with additional information:</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a><span class="sd">          - frame_position_index: Position bin index for each frame</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a><span class="sd">          - frame_environment_index: Environment index for each frame</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a><span class="sd">          - idx_valid: Boolean array indicating valid predictions</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a><span class="sd">    -----</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><span class="sd">    Predictions are based on averaged trial maps. Frames where the animal</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><span class="sd">    is not moving (if use_speed_threshold=True) or where position/environment</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a><span class="sd">    data is unavailable will have NaN predictions.</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>    <span class="k">if</span> <span class="n">spks_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>        <span class="n">_spks_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks_type</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">spks_type</span> <span class="o">=</span> <span class="n">spks_type</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>    <span class="n">frame_position</span><span class="p">,</span> <span class="n">frame_speed</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_behavior</span><span class="p">(</span><span class="n">clear_one_cache</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>    <span class="n">idx_valid</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">frame_position</span><span class="p">)</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>    <span class="k">if</span> <span class="n">use_speed_threshold</span><span class="p">:</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>        <span class="n">idx_valid</span> <span class="o">=</span> <span class="n">idx_valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">frame_speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">)</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>    <span class="c1"># Convert frame position to bins indices</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>    <span class="n">frame_position_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span><span class="p">,</span> <span class="n">frame_position</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>    <span class="c1"># Get the place field for each neuron</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>    <span class="n">env_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="n">use_session_filters</span><span class="p">)</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>    <span class="n">env_maps</span><span class="o">.</span><span class="n">average_trials</span><span class="p">()</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>    <span class="c1"># Convert frame environment to indices</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>    <span class="n">env_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">env</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env_maps</span><span class="o">.</span><span class="n">environments</span><span class="p">)}</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>    <span class="n">frame_environment_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">env_to_idx</span><span class="p">[</span><span class="n">env</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1000</span> <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">frame_environment</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>    <span class="c1"># Get the original spks data</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>    <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>    <span class="k">if</span> <span class="n">use_session_filters</span><span class="p">:</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>        <span class="n">spks</span> <span class="o">=</span> <span class="n">spks</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">]</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>    <span class="c1"># Use a numba speed up to get the placefield prediction (single pass simple algorithm)</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>    <span class="n">placefield_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">spks</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>    <span class="n">spkmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">)))</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>    <span class="n">placefield_prediction</span> <span class="o">=</span> <span class="n">placefield_prediction_numba</span><span class="p">(</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>        <span class="n">placefield_prediction</span><span class="p">,</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>        <span class="n">spkmaps</span><span class="p">,</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>        <span class="n">frame_environment_index</span><span class="p">,</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>        <span class="n">frame_position_index</span><span class="p">,</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>        <span class="n">idx_valid</span><span class="p">,</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>    <span class="p">)</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>    <span class="c1"># This will add samples for which a place field was not estimable (at the edges of the environment)</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>    <span class="n">idx_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">placefield_prediction</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>    <span class="c1"># Reset spks_type</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>    <span class="k">if</span> <span class="n">spks_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">spks_type</span> <span class="o">=</span> <span class="n">_spks_type</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>    <span class="c1"># Include extra details in a dictionary for forward compatibility</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>    <span class="n">extras</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>        <span class="n">frame_position_index</span><span class="o">=</span><span class="n">frame_position_index</span><span class="p">,</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>        <span class="n">frame_environment_index</span><span class="o">=</span><span class="n">frame_environment_index</span><span class="p">,</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>        <span class="n">idx_valid</span><span class="o">=</span><span class="n">idx_valid</span><span class="p">,</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>    <span class="p">)</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>    <span class="k">return</span> <span class="n">placefield_prediction</span><span class="p">,</span> <span class="n">extras</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_processed_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_processed_maps</span><span class="p">(</span><span class="n">force_recompute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_processed_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get processed maps (smoothed and normalized by occupancy).</p>
<p>This method creates processed maps by:
1. Getting raw maps
2. Optionally smoothing with a Gaussian kernel
3. Normalizing speedmap and spkmap by occupancy
4. Reorganizing spkmap to have ROIs as the first dimension</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>force_recompute</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force recomputation even if cached data exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance containing processed occupancy, speed, and spike maps.
Shape: (trials, positions) for occmap/speedmap,
(rois, trials, positions) for spkmap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;processed_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_processed_maps</span><span class="p">(</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get processed maps (smoothed and normalized by occupancy).</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">    This method creates processed maps by:</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">    1. Getting raw maps</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">    2. Optionally smoothing with a Gaussian kernel</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><span class="sd">    3. Normalizing speedmap and spkmap by occupancy</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><span class="sd">    4. Reorganizing spkmap to have ROIs as the first dimension</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><span class="sd">    force_recompute : bool, optional</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a><span class="sd">        Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a><span class="sd">        Maps instance containing processed occupancy, speed, and spike maps.</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a><span class="sd">        Shape: (trials, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a><span class="sd">        (rois, trials, positions) for spkmap.</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>    <span class="c1"># Get the raw maps first (don&#39;t need to specify params because they&#39;re already set by this method)</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>    <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_maps</span><span class="p">(</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>        <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>    <span class="p">)</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>    <span class="c1"># Process the maps (smooth, divide by occupancy, and change to ROIs first)</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>    <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">raw_to_processed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">smooth_width</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_raw_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_raw_maps</span><span class="p">(</span><span class="n">force_recompute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_raw_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get raw maps (occupancy, speed, spkmap) from session data.</p>
<p>This method processes session data to create spatial maps representing
occupancy, speed, and neural activity across position bins. The maps
are in raw format (not smoothed or normalized by occupancy).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>force_recompute</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force recomputation even if cached data exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance containing raw occupancy, speed, and spike maps.
Shape: (trials, positions) for occmap/speedmap,
(trials, positions, rois) for spkmap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The method:
1. Bins positions according to dist_step
2. Filters by speed threshold
3. Computes occupancy, speed, and spike maps
4. Sets unvisited position bins to NaN
5. Optionally standardizes spike data</p>
<p>Results are cached based on parameter hash for efficient reuse.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_raw_maps</span><span class="p">(</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Maps</span><span class="p">:</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get raw maps (occupancy, speed, spkmap) from session data.</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a><span class="sd">    This method processes session data to create spatial maps representing</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a><span class="sd">    occupancy, speed, and neural activity across position bins. The maps</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a><span class="sd">    are in raw format (not smoothed or normalized by occupancy).</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a><span class="sd">    force_recompute : bool, optional</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">        Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">        Maps instance containing raw occupancy, speed, and spike maps.</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">        Shape: (trials, positions) for occmap/speedmap,</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">        (trials, positions, rois) for spkmap.</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a><span class="sd">    The method:</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a><span class="sd">    1. Bins positions according to dist_step</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a><span class="sd">    2. Filters by speed threshold</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a><span class="sd">    3. Computes occupancy, speed, and spike maps</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a><span class="sd">    4. Sets unvisited position bins to NaN</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a><span class="sd">    5. Optionally standardizes spike data</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a><span class="sd">    Results are cached based on parameter hash for efficient reuse.</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>    <span class="n">dist_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_edges</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>    <span class="n">dist_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>    <span class="n">num_positions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist_centers</span><span class="p">)</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>    <span class="c1"># Get behavioral timestamps and positions</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>    <span class="n">timestamps</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">trial_numbers</span><span class="p">,</span> <span class="n">idx_behave_to_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">positions</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>    <span class="c1"># compute behavioral speed on each sample</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>    <span class="n">within_trial_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">trial_numbers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>    <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timestamps</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>    <span class="n">speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">/</span> <span class="n">sample_duration</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>    <span class="c1"># do this after division so no /0 errors</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>    <span class="n">sample_duration</span> <span class="o">=</span> <span class="n">sample_duration</span> <span class="o">*</span> <span class="n">within_trial_sample</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>    <span class="c1"># speed 0 in last sample for each trial (it&#39;s undefined)</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>    <span class="n">speeds</span> <span class="o">=</span> <span class="n">speeds</span> <span class="o">*</span> <span class="n">within_trial_sample</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="c1"># Convert positions to position bins</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>    <span class="n">position_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">dist_edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>    <span class="c1"># get imaging information</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>    <span class="n">frame_time_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">timestamps</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>    <span class="n">sampling_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_time_stamps</span><span class="p">))</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>    <span class="n">dist_cutoff</span> <span class="o">=</span> <span class="n">sampling_period</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>    <span class="n">delay_position_to_imaging</span> <span class="o">=</span> <span class="n">frame_time_stamps</span><span class="p">[</span><span class="n">idx_behave_to_frame</span><span class="p">]</span> <span class="o">-</span> <span class="n">timestamps</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>    <span class="c1"># get spiking information</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>    <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>    <span class="n">num_rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="s2">&quot;numROIs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>    <span class="c1"># Do standardization</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">standardize_spks</span><span class="p">:</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="n">spks</span> <span class="o">=</span> <span class="n">median_zscore</span><span class="p">(</span><span class="n">spks</span><span class="p">,</span> <span class="n">median_subtract</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">zero_baseline_spks</span><span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>    <span class="c1"># Get high resolution occupancy and speed maps</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>    <span class="n">occmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>    <span class="n">speedmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>    <span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">,</span> <span class="n">num_rois</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>    <span class="n">extra_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">num_positions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>    <span class="c1"># Get maps -- doing this independently for each map allows for more</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>    <span class="c1"># flexibility in which data to load (basically the occmap &amp; speedmap</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>    <span class="c1"># are instantaneous, but the spkmap is a bit slower)</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>    <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>        <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>        <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>        <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>        <span class="n">occmap</span><span class="p">,</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>        <span class="n">counts</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>        <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>        <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>        <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>        <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>        <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>        <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>    <span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>    <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>        <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>        <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>        <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>        <span class="n">speedmap</span><span class="p">,</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="n">counts</span><span class="p">,</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>        <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>        <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>        <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>        <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>        <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>        <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>        <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>    <span class="p">)</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>    <span class="n">get_summation_map</span><span class="p">(</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>        <span class="n">spks</span><span class="p">,</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>        <span class="n">trial_numbers</span><span class="p">,</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>        <span class="n">position_bin</span><span class="p">,</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>        <span class="n">spkmap</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>        <span class="n">extra_counts</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>        <span class="n">speeds</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">,</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>        <span class="n">delay_position_to_imaging</span><span class="p">,</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>        <span class="n">dist_cutoff</span><span class="p">,</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>        <span class="n">sample_duration</span><span class="p">,</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>        <span class="n">scale_by_sample_duration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>        <span class="n">use_sample_to_value_idx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>        <span class="n">sample_to_value_idx</span><span class="o">=</span><span class="n">idx_behave_to_frame</span><span class="p">,</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>    <span class="p">)</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>    <span class="c1"># Figure out the valid range (outside of this range, set the maps to nan, because their values are not meaningful)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>    <span class="n">position_bin_per_trial</span> <span class="o">=</span> <span class="p">[</span><span class="n">position_bin</span><span class="p">[</span><span class="n">trial_numbers</span> <span class="o">==</span> <span class="n">tnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">tnum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">num_trials</span><span class="p">)]</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>    <span class="c1"># offsetting by 1 because there is a bug in the vrControl software where the first sample is always set</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>    <span class="c1"># to the minimum position (which is 0), but if there is a built-up buffer in the rotary encoder, the position</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>    <span class="c1"># will jump at the second sample. In general this will always work unless the mice have a truly ridiculous</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>    <span class="c1"># speed at the beginning of the trial...</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>    <span class="n">first_valid_bin</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bpb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bpb</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">bpb</span><span class="p">)</span> <span class="k">for</span> <span class="n">bpb</span> <span class="ow">in</span> <span class="n">position_bin_per_trial</span><span class="p">]</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>    <span class="n">last_valid_bin</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bpb</span><span class="p">)</span> <span class="k">for</span> <span class="n">bpb</span> <span class="ow">in</span> <span class="n">position_bin_per_trial</span><span class="p">]</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>    <span class="c1"># set bins to nan when mouse didn&#39;t visit them</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>    <span class="n">occmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>    <span class="n">speedmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>    <span class="n">spkmap</span> <span class="o">=</span> <span class="n">replace_missing_data</span><span class="p">(</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">first_valid_bin</span><span class="p">,</span> <span class="n">last_valid_bin</span><span class="p">)</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>    <span class="k">return</span> <span class="n">Maps</span><span class="o">.</span><span class="n">create_raw_maps</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_reliability" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_reliability</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_recompute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_one_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_reliability" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate reliability of spike maps across trials.</p>
<p>Reliability measures how consistent neural activity is across trials
within each environment. Multiple methods are supported.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_session_filters</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to filter ROIs using session.idx_rois. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_recompute</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force recomputation even if cached data exists. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clear_one_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to clear the onefile cache after processing. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>SpkmapParams, dict, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters for processing. If None, uses instance parameters.
If a dict, updates instance parameters temporarily.
Parameters are restored after method execution. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Reliability


  
      dataclass
   (vrAnalysis.processors.spkmaps.Reliability)" href="#vrAnalysis.processors.spkmaps.Reliability">Reliability</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reliability instance containing reliability values for each ROI
in each environment. Shape: (num_environments, num_rois).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Supported reliability methods:
- "leave_one_out": Leave-one-out cross-validation
- "correlation": Correlation between trial pairs
- "mse": Mean squared error between trial pairs</p>
<p>All reliability measures require maps with no NaN positions.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a><span class="nd">@with_temp_params</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="nd">@manage_one_cache</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="nd">@cached_processor</span><span class="p">(</span><span class="s2">&quot;reliability&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_reliability</span><span class="p">(</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>    <span class="n">use_session_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>    <span class="n">clear_one_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SpkmapParams</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Reliability</span><span class="p">:</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate reliability of spike maps across trials.</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a><span class="sd">    Reliability measures how consistent neural activity is across trials</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a><span class="sd">    within each environment. Multiple methods are supported.</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a><span class="sd">    use_session_filters : bool, optional</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a><span class="sd">        Whether to filter ROIs using session.idx_rois. Default is True.</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><span class="sd">    force_recompute : bool, optional</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a><span class="sd">        Whether to force recomputation even if cached data exists. Default is False.</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><span class="sd">    clear_one_cache : bool, optional</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><span class="sd">        Whether to clear the onefile cache after processing. Default is True.</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a><span class="sd">    params : SpkmapParams, dict, or None, optional</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a><span class="sd">        Parameters for processing. If None, uses instance parameters.</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a><span class="sd">        If a dict, updates instance parameters temporarily.</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a><span class="sd">        Parameters are restored after method execution. Default is None.</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">    Reliability</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a><span class="sd">        Reliability instance containing reliability values for each ROI</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a><span class="sd">        in each environment. Shape: (num_environments, num_rois).</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="sd">    Supported reliability methods:</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a><span class="sd">    - &quot;leave_one_out&quot;: Leave-one-out cross-validation</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">    - &quot;correlation&quot;: Correlation between trial pairs</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a><span class="sd">    - &quot;mse&quot;: Mean squared error between trial pairs</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a><span class="sd">    All reliability measures require maps with no NaN positions.</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>    <span class="n">envnum</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>    <span class="c1"># A list of the requested environments (all if not specified)</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>    <span class="n">maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">(</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="n">use_session_filters</span><span class="o">=</span><span class="n">use_session_filters</span><span class="p">,</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>        <span class="n">clear_one_cache</span><span class="o">=</span><span class="n">clear_one_cache</span><span class="p">,</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;autosave&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># Prevent saving in the case of a recompute</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>    <span class="p">)</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>    <span class="c1"># All reliability measures require no NaNs</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>    <span class="n">maps</span><span class="o">.</span><span class="n">pop_nan_positions</span><span class="p">()</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;leave_one_out&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>        <span class="n">rel_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">helpers</span><span class="o">.</span><span class="n">reliability_loo</span><span class="p">(</span><span class="n">spkmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">spkmap</span> <span class="ow">in</span> <span class="n">maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;correlation&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>        <span class="n">rel_mse</span><span class="p">,</span> <span class="n">rel_cor</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">named_transpose</span><span class="p">([</span><span class="n">helpers</span><span class="o">.</span><span class="n">measureReliability</span><span class="p">(</span><span class="n">spkmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">spkmap</span> <span class="ow">in</span> <span class="n">maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">])</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>        <span class="n">rel_values</span> <span class="o">=</span> <span class="n">rel_mse</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span> <span class="o">==</span> <span class="s2">&quot;mse&quot;</span> <span class="k">else</span> <span class="n">rel_cor</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>    <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>        <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">rel_values</span><span class="p">),</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>        <span class="n">environments</span><span class="o">=</span><span class="n">envnum</span><span class="p">,</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>        <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">reliability_method</span><span class="p">,</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.get_traversals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_traversals</span><span class="p">(</span><span class="n">idx_roi</span><span class="p">,</span> <span class="n">idx_env</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">placefield_threshold</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">fill_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spks_prediction</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.get_traversals" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extract neural activity around place field peak during traversals.</p>
<p>This method identifies trials where the animal passes through a neuron's
place field peak and extracts activity windows around those moments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx_roi</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the ROI (neuron) to analyze.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>idx_env</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the environment to analyze (index into env_maps.environments).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of frames on each side of the peak to include. Total window
size is 2*width + 1. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>placefield_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum distance from place field peak to include a trial (in spatial units).
Default is 5.0.</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_nan</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to fill NaN values with 0. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spks</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike data array. If None, loads from session. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spks_prediction</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Place field prediction array. If None, computes it. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- traversals: Array of shape (num_traversals, 2<em>width+1) containing
  actual neural activity around each traversal.
- pred_travs: Array of shape (num_traversals, 2</em>width+1) containing
  predicted activity around each traversal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Only includes trials where the animal passes within placefield_threshold
of the place field peak. The peak is determined from the averaged spike
map for the specified ROI and environment.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2069" name="__codelineno-0-2069"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_traversals</span><span class="p">(</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>    <span class="n">idx_roi</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>    <span class="n">idx_env</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>    <span class="n">placefield_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>    <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>    <span class="n">spks</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>    <span class="n">spks_prediction</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract neural activity around place field peak during traversals.</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">    This method identifies trials where the animal passes through a neuron&#39;s</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">    place field peak and extracts activity windows around those moments.</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">    idx_roi : int</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a><span class="sd">        Index of the ROI (neuron) to analyze.</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a><span class="sd">    idx_env : int</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a><span class="sd">        Index of the environment to analyze (index into env_maps.environments).</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a><span class="sd">    width : int, optional</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a><span class="sd">        Number of frames on each side of the peak to include. Total window</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a><span class="sd">        size is 2*width + 1. Default is 10.</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a><span class="sd">    placefield_threshold : float, optional</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a><span class="sd">        Maximum distance from place field peak to include a trial (in spatial units).</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a><span class="sd">        Default is 5.0.</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a><span class="sd">    fill_nan : bool, optional</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a><span class="sd">        Whether to fill NaN values with 0. Default is False.</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a><span class="sd">    spks : np.ndarray, optional</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a><span class="sd">        Spike data array. If None, loads from session. Default is None.</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a><span class="sd">    spks_prediction : np.ndarray, optional</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a><span class="sd">        Place field prediction array. If None, computes it. Default is None.</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a><span class="sd">        - traversals: Array of shape (num_traversals, 2*width+1) containing</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a><span class="sd">          actual neural activity around each traversal.</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a><span class="sd">        - pred_travs: Array of shape (num_traversals, 2*width+1) containing</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a><span class="sd">          predicted activity around each traversal.</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a><span class="sd">    -----</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a><span class="sd">    Only includes trials where the animal passes within placefield_threshold</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a><span class="sd">    of the place field peak. The peak is determined from the averaged spike</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a><span class="sd">    map for the specified ROI and environment.</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>    <span class="n">frame_position</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">frame_environment</span><span class="p">,</span> <span class="n">frame_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame_behavior</span><span class="p">()</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>    <span class="k">if</span> <span class="n">spks_prediction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>        <span class="n">spks_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_placefield_prediction</span><span class="p">(</span><span class="n">use_session_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>    <span class="k">if</span> <span class="n">spks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>        <span class="n">spks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">spks</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">idx_rois</span><span class="p">]</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>    <span class="k">if</span> <span class="n">spks</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">spks_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;spks and spks_prediction must have the same shape&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>    <span class="n">env_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">()</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>    <span class="n">pos_peak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_centers</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">env_maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">idx_env</span><span class="p">][</span><span class="n">idx_roi</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))]</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>    <span class="n">envnum</span> <span class="o">=</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_env</span><span class="p">]</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>    <span class="n">env_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frame_trial</span><span class="p">[</span><span class="n">frame_environment</span> <span class="o">==</span> <span class="n">envnum</span><span class="p">])</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>    <span class="n">num_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">env_trials</span><span class="p">)</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>    <span class="n">idx_traversal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_trials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>    <span class="k">for</span> <span class="n">itrial</span><span class="p">,</span> <span class="n">trialnum</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env_trials</span><span class="p">):</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>        <span class="n">idx_trial</span> <span class="o">=</span> <span class="n">frame_trial</span> <span class="o">==</span> <span class="n">trialnum</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>        <span class="n">idx_closest_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_position</span> <span class="o">-</span> <span class="n">pos_peak</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10000</span> <span class="o">*</span> <span class="o">~</span><span class="n">idx_trial</span><span class="p">)</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>        <span class="c1"># Only include the trial if the closest position is within placefield threshold of the peak</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_position</span><span class="p">[</span><span class="n">idx_closest_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos_peak</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">placefield_threshold</span><span class="p">:</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>            <span class="n">idx_traversal</span><span class="p">[</span><span class="n">itrial</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_closest_pos</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>    <span class="c1"># Filter out trials that don&#39;t have a traversal</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>    <span class="n">idx_traversal</span> <span class="o">=</span> <span class="n">idx_traversal</span><span class="p">[</span><span class="n">idx_traversal</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>    <span class="c1"># Get traversals through place field in requested environment</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>    <span class="n">traversals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">),</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>    <span class="n">pred_travs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">),</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_traversal</span><span class="p">):</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>        <span class="n">istart</span> <span class="o">=</span> <span class="n">it</span> <span class="o">-</span> <span class="n">width</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>        <span class="n">iend</span> <span class="o">=</span> <span class="n">it</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>        <span class="n">istartoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">istart</span><span class="p">)</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>        <span class="n">iendoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">spks</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>        <span class="n">traversals</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">]</span> <span class="o">=</span> <span class="n">spks</span><span class="p">[</span><span class="n">istart</span> <span class="o">+</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">,</span> <span class="n">idx_roi</span><span class="p">]</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>        <span class="n">pred_travs</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">]</span> <span class="o">=</span> <span class="n">spks_prediction</span><span class="p">[</span><span class="n">istart</span> <span class="o">+</span> <span class="n">istartoffset</span> <span class="p">:</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">iendoffset</span><span class="p">,</span> <span class="n">idx_roi</span><span class="p">]</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>    <span class="k">if</span> <span class="n">fill_nan</span><span class="p">:</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>        <span class="n">traversals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">traversals</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>        <span class="n">pred_travs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pred_travs</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>    <span class="k">return</span> <span class="n">traversals</span><span class="p">,</span> <span class="n">pred_travs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.load_from_cache" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_from_cache</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.load_from_cache" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load cached parameters and data for a given data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of cached data to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- The cached data (Maps or Reliability), or None if not found
- A boolean indicating whether valid cache was found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1346" name="__codelineno-0-1346"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Maps</span><span class="p">,</span> <span class="n">Reliability</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load cached parameters and data for a given data type.</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a><span class="sd">    data_type : str</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a><span class="sd">        Type of cached data to load.</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a><span class="sd">        A tuple containing:</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a><span class="sd">        - The cached data (Maps or Reliability), or None if not found</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="sd">        - A boolean indicating whether valid cache was found</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="k">if</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="c1"># If the directory exists, check if there are any cached params that match the expected hash</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="n">params_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params_hash</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="n">cached_params_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;params_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npz&quot;</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="k">if</span> <span class="n">cached_params_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>            <span class="n">cached_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cached_params_path</span><span class="p">))</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>            <span class="c1"># Check if the cached params match the dependent params</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_params_match</span><span class="p">(</span><span class="n">cached_params</span><span class="p">):</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_cache</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">params_hash</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">cached_params</span><span class="p">),</span> <span class="kc">True</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.save_cache" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_cache</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.save_cache" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the cached parameters and data for a given data type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of data being cached ("raw_maps", "processed_maps", "env_maps", or "reliability").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a> or <a class="autorefs autorefs-internal" title="Reliability


  
      dataclass
   (vrAnalysis.processors.spkmaps.Reliability)" href="#vrAnalysis.processors.spkmaps.Reliability">Reliability</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data object to cache.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Creates the cache directory if it doesn't exist. Saves parameters as an NPZ file
and data as NPY files, using a hash of the parameters in the filenames.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Maps</span><span class="p">,</span> <span class="n">Reliability</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the cached parameters and data for a given data type.</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">    data_type : str</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">        Type of data being cached (&quot;raw_maps&quot;, &quot;processed_maps&quot;, &quot;env_maps&quot;, or &quot;reliability&quot;).</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">    data : Maps or Reliability</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">        The data object to cache.</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">    Creates the cache directory if it doesn&#39;t exist. Saves parameters as an NPZ file</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">    and data as NPY files, using a hash of the parameters in the filenames.</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>    <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>    <span class="n">params_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params_hash</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>    <span class="n">cache_param_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;params_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npz&quot;</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>        <span class="n">cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>    <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">cache_param_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dependent_params</span><span class="p">(</span><span class="n">data_type</span><span class="p">))</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;raw_maps&quot;</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>            <span class="n">cache_data_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_data_path</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapname</span><span class="p">))</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>        <span class="n">environments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">environments</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>        <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">environments</span><span class="p">):</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>            <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="n">Maps</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                <span class="n">cache_data_path</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_data_path</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mapname</span><span class="p">)[</span><span class="n">ienv</span><span class="p">])</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>    <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>        <span class="n">environments</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">environments</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>        <span class="c1"># don&#39;t need data.method because it&#39;s in params...</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">environments</span><span class="p">)</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_reliability_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown data type: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapProcessor.show_cache" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_cache</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapProcessor.show_cache" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Helper function that scrapes the cache directory and shows cached files</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicate a data type to filter which parts of the cache to show</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Prints a formatted table showing cache information including data_type, size,
parameters, and modification date. If no cache directory exists, prints a message.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="k">def</span><span class="w"> </span><span class="nf">show_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function that scrapes the cache directory and shows cached files</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">    data_type: Optional[str] = None</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">        Indicate a data type to filter which parts of the cache to show</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    Prints a formatted table showing cache information including data_type, size,</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">    parameters, and modification date. If no cache directory exists, prints a message.</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="c1"># Get the base cache directory</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>    <span class="n">base_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">()</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">base_cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cache directory found at: </span><span class="si">{</span><span class="n">base_cache_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>        <span class="k">return</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>    <span class="c1"># Collect information about all cache files</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span class="n">cache_info</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>    <span class="c1"># Define the data types to check</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>    <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="n">data_types_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_type</span><span class="p">]</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>        <span class="n">data_types_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;reliability&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">data_types_to_check</span><span class="p">:</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="n">cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_directory</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>            <span class="k">continue</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="c1"># Find all parameter files (they define what caches exist)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="n">param_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;params_*.npz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="k">for</span> <span class="n">param_file</span> <span class="ow">in</span> <span class="n">param_files</span><span class="p">:</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span class="c1"># Extract the hash from the filename</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>            <span class="n">params_hash</span> <span class="o">=</span> <span class="n">param_file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;params_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>            <span class="c1"># Load the parameters</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                <span class="n">cached_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">param_file</span><span class="p">))</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                <span class="n">param_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cached_params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                <span class="n">param_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error loading params: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>            <span class="c1"># Get file modification time</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>            <span class="n">mod_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">param_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>            <span class="n">date_str</span> <span class="o">=</span> <span class="n">mod_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>            <span class="c1"># Calculate total size of all related cache files</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>            <span class="n">total_size</span> <span class="o">=</span> <span class="n">param_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="k">if</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;raw_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_maps&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>                <span class="c1"># For maps, look for data files for each map type</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>                <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>                    <span class="n">data_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>                    <span class="k">if</span> <span class="n">data_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">data_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="k">elif</span> <span class="n">dt</span> <span class="o">==</span> <span class="s2">&quot;env_maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span class="c1"># For env_maps, look for environment file and individual environment data files</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>                <span class="n">env_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>                <span class="k">if</span> <span class="n">env_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                    <span class="n">total_size</span> <span class="o">+=</span> <span class="n">env_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                    <span class="c1"># Load environments to find all data files</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>                        <span class="n">environments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">env_file</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>                        <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>                            <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>                                <span class="n">data_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">env</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>                                <span class="k">if</span> <span class="n">data_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>                                    <span class="n">total_size</span> <span class="o">+=</span> <span class="n">data_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                        <span class="k">pass</span>  <span class="c1"># Continue even if we can&#39;t load environments</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>            <span class="k">elif</span> <span class="n">dt</span> <span class="o">==</span> <span class="s2">&quot;reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>                <span class="c1"># For reliability, look for environments and reliability data files</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>                <span class="n">env_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_environments_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>                <span class="n">rel_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_reliability_</span><span class="si">{</span><span class="n">params_hash</span><span class="si">}</span><span class="s2">.npy&quot;</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>                <span class="k">if</span> <span class="n">env_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>                    <span class="n">total_size</span> <span class="o">+=</span> <span class="n">env_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="k">if</span> <span class="n">rel_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                    <span class="n">total_size</span> <span class="o">+=</span> <span class="n">rel_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="c1"># Convert size to human readable format</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>            <span class="n">size_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_file_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="n">cache_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="p">{</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                    <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                    <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size_str</span><span class="p">,</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">param_str</span><span class="p">,</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date_str</span><span class="p">,</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                    <span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">params_hash</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span>  <span class="c1"># Show first 8 chars of hash</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                <span class="p">}</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>            <span class="p">)</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_info</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No cache files found.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>        <span class="k">return</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>    <span class="c1"># Format the output as a table</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Cache Files Summary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Data Type&#39;</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Size&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Date&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Hash&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Parameters&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">cache_info</span><span class="p">:</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>        <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total cache entries: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cache_info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_lines</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
    show_root_heading: true
    show_root_toc_entry: true
    heading_level: 3</p>


<div class="doc doc-object doc-class">



<h2 id="vrAnalysis.processors.spkmaps.Maps" class="doc doc-heading">
            <code>Maps</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Maps" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Container for occupancy, speed, and spike maps.</p>
<p>This class holds spatial maps representing neural activity, behavioral occupancy,
and speed across position bins. Maps can be organized either as single arrays
(all trials combined) or as lists of arrays (separated by environment).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.occmap">occmap</span></code></td>
            <td>
                  <code>np.ndarray or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Occupancy map(s) representing time spent in each position bin.
Shape: (trials, positions) for single array, or list of (trials, positions)
arrays when by_environment=True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.speedmap">speedmap</span></code></td>
            <td>
                  <code>np.ndarray or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed map(s) representing average speed in each position bin.
Shape: (trials, positions) for single array, or list of (trials, positions)
arrays when by_environment=True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.spkmap">spkmap</span></code></td>
            <td>
                  <code>np.ndarray or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike map(s) representing neural activity in each position bin.
Shape depends on rois_first:
- If rois_first=True: (rois, trials, positions) or list of (rois, trials, positions)
- If rois_first=False: (trials, positions, rois) or list of (trials, positions, rois)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.by_environment">by_environment</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether maps are separated by environment (True) or combined (False).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.rois_first">rois_first</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether ROI dimension is first (True) or last (False) in spkmap arrays.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.environments">environments</span></code></td>
            <td>
                  <code>list of int, optional</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of environment numbers when by_environment=True. Default is None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps.distcenters">distcenters</span></code></td>
            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center positions of distance bins. Default is None.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Maps._averaged">_averaged</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal flag indicating whether trials have been averaged. Default is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The Maps class supports two organizational modes:
1. Single maps: All trials combined in single arrays (by_environment=False)
2. Environment-separated maps: Maps split by environment (by_environment=True)</p>
<p>The spkmap can have ROIs as the first or last dimension depending on rois_first.
This allows flexibility in how data is organized for different processing steps.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">Maps</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for occupancy, speed, and spike maps.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    This class holds spatial maps representing neural activity, behavioral occupancy,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    and speed across position bins. Maps can be organized either as single arrays</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    (all trials combined) or as lists of arrays (separated by environment).</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    occmap : np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Occupancy map(s) representing time spent in each position bin.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        Shape: (trials, positions) for single array, or list of (trials, positions)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        arrays when by_environment=True.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    speedmap : np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        Speed map(s) representing average speed in each position bin.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Shape: (trials, positions) for single array, or list of (trials, positions)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        arrays when by_environment=True.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    spkmap : np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Spike map(s) representing neural activity in each position bin.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        Shape depends on rois_first:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        - If rois_first=True: (rois, trials, positions) or list of (rois, trials, positions)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        - If rois_first=False: (trials, positions, rois) or list of (trials, positions, rois)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    by_environment : bool</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        Whether maps are separated by environment (True) or combined (False).</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    rois_first : bool</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Whether ROI dimension is first (True) or last (False) in spkmap arrays.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    environments : list of int, optional</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        List of environment numbers when by_environment=True. Default is None.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    _averaged : bool</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Internal flag indicating whether trials have been averaged. Default is False.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    -----</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    The Maps class supports two organizational modes:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    1. Single maps: All trials combined in single arrays (by_environment=False)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    2. Environment-separated maps: Maps split by environment (by_environment=True)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    The spkmap can have ROIs as the first or last dimension depending on rois_first.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    This allows flexibility in how data is organized for different processing steps.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">occmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">speedmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">spkmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">by_environment</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">rois_first</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">_averaged</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must be provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;environments must be provided if by_environment is True&quot;</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must be lists if by_environment is True&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must be single arrays if by_environment is False&quot;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">spkmap_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">spkmap_shape</span><span class="p">):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must have the same shape&quot;</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must have the same number of environments&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">spkmap_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">spkmap_shape</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;occmap, speedmap, and spkmap must have the same shape for each environment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">roi_axis</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">rois_per_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">spkmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">roi_axis</span><span class="p">]</span> <span class="k">for</span> <span class="n">spkmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">rpe</span> <span class="o">==</span> <span class="n">rois_per_env</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">rpe</span> <span class="ow">in</span> <span class="n">rois_per_env</span><span class="p">]):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All environments must have the same number of ROIs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># Get number of positions</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">num_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">num_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># Get number of trials</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">num_trials</span> <span class="o">=</span> <span class="s2">&quot;averaged&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="n">num_trials</span> <span class="o">=</span> <span class="p">[</span><span class="n">occmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">occmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">num_trials</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="n">num_trials</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="n">num_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># Get number of ROIs</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">num_rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">num_rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">environments</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;, environments=</span><span class="se">{{</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">])</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Maps(num_trials=</span><span class="si">{</span><span class="n">num_trials</span><span class="si">}</span><span class="s2">, num_positions=</span><span class="si">{</span><span class="n">num_positions</span><span class="si">}</span><span class="s2">, num_rois=</span><span class="si">{</span><span class="n">num_rois</span><span class="si">}{</span><span class="n">environments</span><span class="si">}</span><span class="s2">, rois_first=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_raw_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">occmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Maps instance from raw (unprocessed) map data.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        occmap : np.ndarray</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            Occupancy map with shape (trials, positions).</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        speedmap : np.ndarray</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            Speed map with shape (trials, positions).</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        spkmap : np.ndarray</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            Spike map with shape (trials, positions, rois).</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        -------</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            Maps instance with by_environment=False and rois_first=False.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span> <span class="n">by_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rois_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_processed_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">occmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Maps instance from processed map data.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        occmap : np.ndarray</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">            Occupancy map with shape (trials, positions).</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        speedmap : np.ndarray</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            Speed map with shape (trials, positions).</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        spkmap : np.ndarray</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            Spike map with shape (rois, trials, positions).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        -------</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">            Maps instance with by_environment=False and rois_first=True.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span> <span class="n">by_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rois_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_environment_maps</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">occmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">speedmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">spkmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Maps instance with maps separated by environment.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        occmap : list of np.ndarray</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            List of occupancy maps, one per environment. Each with shape (trials, positions).</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        speedmap : list of np.ndarray</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            List of speed maps, one per environment. Each with shape (trials, positions).</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        spkmap : list of np.ndarray</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">            List of spike maps, one per environment. Each with shape (rois, trials, positions).</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        environments : list of int</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            List of environment numbers corresponding to each map in the lists.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        -------</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">            Maps instance with by_environment=True and rois_first=True.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">environments</span><span class="o">=</span><span class="n">environments</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">by_environment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">rois_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">map_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of map type names.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        -------</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        list of str</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            List containing [&quot;occmap&quot;, &quot;speedmap&quot;, &quot;spkmap&quot;].</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a map by name using dictionary-like access.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        key : str</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">            Name of the map to retrieve (&quot;occmap&quot;, &quot;speedmap&quot;, or &quot;spkmap&quot;).</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        -------</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            The requested map array(s).</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a map by name using dictionary-like access.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        key : str</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            Name of the map to set (&quot;occmap&quot;, &quot;speedmap&quot;, or &quot;spkmap&quot;).</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        value : np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            The map array(s) to assign.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_position_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the axis index for the position dimension.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        mapname : str</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            Name of the map (&quot;occmap&quot;, &quot;speedmap&quot;, or &quot;spkmap&quot;).</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        -------</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        int</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">            Axis index for the position dimension. Typically -1 (last axis),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">            except for spkmap when rois_first=False, where it&#39;s -2.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        -----</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        The only time the position axis isn&#39;t the last one is for spkmap when</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        rois_first is False, where the shape is (trials, positions, rois).</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="n">average_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">average_offset</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter maps to keep only specified position bins.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        idx_positions : np.ndarray</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            Indices of position bins to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        -----</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        This method modifies the maps in-place, keeping only the position bins</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        specified by idx_positions. Also updates distcenters if present.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span><span class="p">[</span><span class="n">idx_positions</span><span class="p">]</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_position_axis</span><span class="p">(</span><span class="n">mapname</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">idx_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter spike maps to keep only specified ROIs.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        idx_rois : np.ndarray</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            Indices of ROIs to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        -----</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        This method modifies the spkmap in-place, keeping only the ROIs</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        specified by idx_rois. Only affects spkmap; occmap and speedmap</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        are unchanged.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter maps to keep only specified environments.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        environments : list of int</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            List of environment numbers to keep.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        ------</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        ValueError</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">            If by_environment is False, since environments cannot be filtered</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">            when maps are not separated by environment.</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        -----</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        This method modifies the maps in-place, keeping only the environments</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        specified. Only works when by_environment=True.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">idx_to_requested_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span> <span class="k">if</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">]</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot filter environments when maps aren&#39;t separated by environment!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pop_nan_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove position bins that contain NaN values in any map.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        -----</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        This method identifies position bins that have NaN values in any of the</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">        maps (occmap, speedmap, or spkmap) and removes them from all maps.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        Useful for cleaning data before analysis.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="n">idx_valid_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">occmap</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">occmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">idx_valid_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_positions</span><span class="p">(</span><span class="n">idx_valid_positions</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">smooth_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">kernel_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Smooth the maps using a Gaussian kernel.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        positions : np.ndarray</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">            Position values corresponding to the position bins. Used to compute</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">            the Gaussian kernel.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        kernel_width : float</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">            Width of the Gaussian smoothing kernel in spatial units.</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        -----</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        This method applies Gaussian smoothing to all maps (occmap, speedmap, spkmap).</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        NaN values are temporarily replaced with 0 during smoothing, then restored</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        afterward. The smoothing is applied along the position dimension.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">kernel</span> <span class="o">=</span> <span class="n">get_gauss_kernel</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">kernel_width</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="c1"># Replace nans with 0s</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">idxnan</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">occmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">occmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">]</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">idxnan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="c1"># Move the rois axis to the last axis</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">inanenv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxnan</span><span class="p">):</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                    <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">ienv</span><span class="p">][</span><span class="n">inanenv</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">idxnan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="c1"># Since we moved ROIs to the last axis position will be axis=1 for all map types</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">convolve_toeplitz</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve_toeplitz</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="c1"># Put nans back in place</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">inanenv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxnan</span><span class="p">):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                    <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">ienv</span><span class="p">][</span><span class="n">inanenv</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">idxnan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="c1"># Move the rois axis back to the first axis</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">average_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Average the trials within each environment.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        keepdims : bool, optional</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">            Whether to keep the trial dimension with size 1 after averaging.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">            Default is False.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        -----</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        This method computes the mean across trials for each map. After averaging,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        the _averaged flag is set to True to prevent redundant averaging.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        The trial dimension is removed unless keepdims=True.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="k">return</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the total memory size of all maps in bytes.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        -------</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        int</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            Total number of bytes used by all map arrays.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="n">num_bytes</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="n">num_bytes</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="n">num_bytes</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">nbytes</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="k">return</span> <span class="n">num_bytes</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">raw_to_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">smooth_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert raw maps to processed maps.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Processing steps:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        1. Optionally smooth maps with a Gaussian kernel</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        2. Divide speedmap and spkmap by occmap (correct_map)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        3. Reorganize spkmap to have ROIs as the first dimension</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        positions : np.ndarray</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">            Position values corresponding to the position bins.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        smooth_width : float, optional</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">            Width of the Gaussian smoothing kernel. If None, no smoothing is applied.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            Default is None.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        -------</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        Maps</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">            Self, with maps now in processed format (rois_first=True).</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        -----</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        This method modifies the maps in-place. After processing, spkmap will</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        have shape (rois, trials, positions) instead of (trials, positions, rois).</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">if</span> <span class="n">smooth_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smooth_maps</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">smooth_width</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span> <span class="o">=</span> <span class="n">correct_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">correct_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="c1"># Change spkmap to be ROIs first</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.__getitem__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get a map by name using dictionary-like access.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the map to retrieve ("occmap", "speedmap", or "spkmap").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>np.ndarray or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The requested map array(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a map by name using dictionary-like access.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    key : str</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Name of the map to retrieve (&quot;occmap&quot;, &quot;speedmap&quot;, or &quot;spkmap&quot;).</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    -------</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        The requested map array(s).</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.__setitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.__setitem__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set a map by name using dictionary-like access.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the map to set ("occmap", "speedmap", or "spkmap").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code>np.ndarray or list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The map array(s) to assign.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a map by name using dictionary-like access.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    key : str</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        Name of the map to set (&quot;occmap&quot;, &quot;speedmap&quot;, or &quot;spkmap&quot;).</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    value : np.ndarray or list of np.ndarray</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        The map array(s) to assign.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.average_trials" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">average_trials</span><span class="p">(</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.average_trials" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Average the trials within each environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>keepdims</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to keep the trial dimension with size 1 after averaging.
Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method computes the mean across trials for each map. After averaging,
the _averaged flag is set to True to prevent redundant averaging.
The trial dimension is removed unless keepdims=True.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="k">def</span><span class="w"> </span><span class="nf">average_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Average the trials within each environment.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    keepdims : bool, optional</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        Whether to keep the trial dimension with size 1 after averaging.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        Default is False.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    -----</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    This method computes the mean across trials for each map. After averaging,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    the _averaged flag is set to True to prevent redundant averaging.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    The trial dimension is removed unless keepdims=True.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="k">return</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapname</span> <span class="o">==</span> <span class="s2">&quot;spkmap&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_averaged</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.create_environment_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_environment_maps</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">,</span> <span class="n">environments</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Maps.create_environment_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Maps instance with maps separated by environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>occmap</code>
            </td>
            <td>
                  <code>list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of occupancy maps, one per environment. Each with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speedmap</code>
            </td>
            <td>
                  <code>list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of speed maps, one per environment. Each with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spkmap</code>
            </td>
            <td>
                  <code>list of np.ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of spike maps, one per environment. Each with shape (rois, trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>environments</code>
            </td>
            <td>
                  <code>list of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of environment numbers corresponding to each map in the lists.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distcenters</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center positions of distance bins. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance with by_environment=True and rois_first=True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_environment_maps</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">occmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">speedmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">spkmap</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Maps instance with maps separated by environment.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    occmap : list of np.ndarray</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        List of occupancy maps, one per environment. Each with shape (trials, positions).</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    speedmap : list of np.ndarray</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        List of speed maps, one per environment. Each with shape (trials, positions).</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    spkmap : list of np.ndarray</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        List of spike maps, one per environment. Each with shape (rois, trials, positions).</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    environments : list of int</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        List of environment numbers corresponding to each map in the lists.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    -------</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        Maps instance with by_environment=True and rois_first=True.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">environments</span><span class="o">=</span><span class="n">environments</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">by_environment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">rois_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.create_processed_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_processed_maps</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Maps.create_processed_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Maps instance from processed map data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>occmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Occupancy map with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speedmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed map with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spkmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike map with shape (rois, trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distcenters</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center positions of distance bins. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance with by_environment=False and rois_first=True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_processed_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">occmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Maps instance from processed map data.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    occmap : np.ndarray</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Occupancy map with shape (trials, positions).</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    speedmap : np.ndarray</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        Speed map with shape (trials, positions).</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    spkmap : np.ndarray</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Spike map with shape (rois, trials, positions).</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    -------</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        Maps instance with by_environment=False and rois_first=True.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span> <span class="n">by_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rois_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.create_raw_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_raw_maps</span><span class="p">(</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Maps.create_raw_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Maps instance from raw (unprocessed) map data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>occmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Occupancy map with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speedmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Speed map with shape (trials, positions).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spkmap</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spike map with shape (trials, positions, rois).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distcenters</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Center positions of distance bins. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps instance with by_environment=False and rois_first=False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_raw_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">occmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">speedmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">spkmap</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distcenters</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Maps instance from raw (unprocessed) map data.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    occmap : np.ndarray</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        Occupancy map with shape (trials, positions).</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    speedmap : np.ndarray</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Speed map with shape (trials, positions).</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    spkmap : np.ndarray</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Spike map with shape (trials, positions, rois).</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    distcenters : np.ndarray, optional</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Center positions of distance bins. Default is None.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    -------</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Maps instance with by_environment=False and rois_first=False.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">occmap</span><span class="o">=</span><span class="n">occmap</span><span class="p">,</span> <span class="n">speedmap</span><span class="o">=</span><span class="n">speedmap</span><span class="p">,</span> <span class="n">spkmap</span><span class="o">=</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">distcenters</span><span class="o">=</span><span class="n">distcenters</span><span class="p">,</span> <span class="n">by_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rois_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.filter_environments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_environments</span><span class="p">(</span><span class="n">environments</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.filter_environments" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter maps to keep only specified environments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>environments</code>
            </td>
            <td>
                  <code>list of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of environment numbers to keep.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If by_environment is False, since environments cannot be filtered
when maps are not separated by environment.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method modifies the maps in-place, keeping only the environments
specified. Only works when by_environment=True.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter maps to keep only specified environments.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    environments : list of int</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        List of environment numbers to keep.</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    ------</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        If by_environment is False, since environments cannot be filtered</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        when maps are not separated by environment.</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    -----</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    This method modifies the maps in-place, keeping only the environments</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    specified. Only works when by_environment=True.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">idx_to_requested_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span> <span class="k">if</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">]</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">environments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_to_requested_env</span><span class="p">]</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot filter environments when maps aren&#39;t separated by environment!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.filter_positions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_positions</span><span class="p">(</span><span class="n">idx_positions</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.filter_positions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter maps to keep only specified position bins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx_positions</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of position bins to keep. Must be a 1D array of integers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method modifies the maps in-place, keeping only the position bins
specified by idx_positions. Also updates distcenters if present.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter maps to keep only specified position bins.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    idx_positions : np.ndarray</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        Indices of position bins to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    -----</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    This method modifies the maps in-place, keeping only the position bins</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    specified by idx_positions. Also updates distcenters if present.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distcenters</span><span class="p">[</span><span class="n">idx_positions</span><span class="p">]</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_position_axis</span><span class="p">(</span><span class="n">mapname</span><span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">idx_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">idx_positions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.filter_rois" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_rois</span><span class="p">(</span><span class="n">idx_rois</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.filter_rois" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter spike maps to keep only specified ROIs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx_rois</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of ROIs to keep. Must be a 1D array of integers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method modifies the spkmap in-place, keeping only the ROIs
specified by idx_rois. Only affects spkmap; occmap and speedmap
are unchanged.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter spike maps to keep only specified ROIs.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    idx_rois : np.ndarray</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        Indices of ROIs to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    -----</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    This method modifies the spkmap in-place, keeping only the ROIs</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    specified by idx_rois. Only affects spkmap; occmap and speedmap</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    are unchanged.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.map_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_types</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Maps.map_types" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the list of map type names.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List containing ["occmap", "speedmap", "spkmap"].</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of map type names.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    -------</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    list of str</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        List containing [&quot;occmap&quot;, &quot;speedmap&quot;, &quot;spkmap&quot;].</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;occmap&quot;</span><span class="p">,</span> <span class="s2">&quot;speedmap&quot;</span><span class="p">,</span> <span class="s2">&quot;spkmap&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.nbytes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nbytes</span><span class="p">()</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.nbytes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the total memory size of all maps in bytes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of bytes used by all map arrays.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="k">def</span><span class="w"> </span><span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the total memory size of all maps in bytes.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    -------</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    int</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        Total number of bytes used by all map arrays.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">num_bytes</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">num_bytes</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">num_bytes</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">nbytes</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="k">return</span> <span class="n">num_bytes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.pop_nan_positions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pop_nan_positions</span><span class="p">()</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.pop_nan_positions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove position bins that contain NaN values in any map.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method identifies position bins that have NaN values in any of the
maps (occmap, speedmap, or spkmap) and removes them from all maps.
Useful for cleaning data before analysis.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="k">def</span><span class="w"> </span><span class="nf">pop_nan_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove position bins that contain NaN values in any map.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    -----</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    This method identifies position bins that have NaN values in any of the</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    maps (occmap, speedmap, or spkmap) and removes them from all maps.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    Useful for cleaning data before analysis.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">idx_valid_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">occmap</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">occmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">idx_valid_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">filter_positions</span><span class="p">(</span><span class="n">idx_valid_positions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.raw_to_processed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">raw_to_processed</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">smooth_width</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.raw_to_processed" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert raw maps to processed maps.</p>
<p>Processing steps:
1. Optionally smooth maps with a Gaussian kernel
2. Divide speedmap and spkmap by occmap (correct_map)
3. Reorganize spkmap to have ROIs as the first dimension</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Position values corresponding to the position bins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the Gaussian smoothing kernel. If None, no smoothing is applied.
Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Maps


  
      dataclass
   (vrAnalysis.processors.spkmaps.Maps)" href="#vrAnalysis.processors.spkmaps.Maps">Maps</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Self, with maps now in processed format (rois_first=True).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method modifies the maps in-place. After processing, spkmap will
have shape (rois, trials, positions) instead of (trials, positions, rois).</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="k">def</span><span class="w"> </span><span class="nf">raw_to_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">smooth_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Maps&quot;</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert raw maps to processed maps.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    Processing steps:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    1. Optionally smooth maps with a Gaussian kernel</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    2. Divide speedmap and spkmap by occmap (correct_map)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    3. Reorganize spkmap to have ROIs as the first dimension</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    positions : np.ndarray</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        Position values corresponding to the position bins.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    smooth_width : float, optional</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        Width of the Gaussian smoothing kernel. If None, no smoothing is applied.</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        Default is None.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    -------</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    Maps</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">        Self, with maps now in processed format (rois_first=True).</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    -----</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    This method modifies the maps in-place. After processing, spkmap will</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    have shape (rois, trials, positions) instead of (trials, positions, rois).</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">if</span> <span class="n">smooth_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_maps</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">smooth_width</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span> <span class="o">=</span> <span class="n">correct_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">speedmap</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">correct_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="c1"># Change spkmap to be ROIs first</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Maps.smooth_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smooth_maps</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">kernel_width</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Maps.smooth_maps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Smooth the maps using a Gaussian kernel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Position values corresponding to the position bins. Used to compute
the Gaussian kernel.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kernel_width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the Gaussian smoothing kernel in spatial units.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This method applies Gaussian smoothing to all maps (occmap, speedmap, spkmap).
NaN values are temporarily replaced with 0 during smoothing, then restored
afterward. The smoothing is applied along the position dimension.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="k">def</span><span class="w"> </span><span class="nf">smooth_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">kernel_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Smooth the maps using a Gaussian kernel.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    positions : np.ndarray</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        Position values corresponding to the position bins. Used to compute</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        the Gaussian kernel.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    kernel_width : float</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">        Width of the Gaussian smoothing kernel in spatial units.</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    -----</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    This method applies Gaussian smoothing to all maps (occmap, speedmap, spkmap).</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    NaN values are temporarily replaced with 0 during smoothing, then restored</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    afterward. The smoothing is applied along the position dimension.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="n">kernel</span> <span class="o">=</span> <span class="n">get_gauss_kernel</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">kernel_width</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="c1"># Replace nans with 0s</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">idxnan</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">occmap</span><span class="p">)</span> <span class="k">for</span> <span class="n">occmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">]</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="n">idxnan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occmap</span><span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="c1"># Move the rois axis to the last axis</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">inanenv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxnan</span><span class="p">):</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">ienv</span><span class="p">][</span><span class="n">inanenv</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">idxnan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="c1"># Since we moved ROIs to the last axis position will be axis=1 for all map types</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">convolve_toeplitz</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]]</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve_toeplitz</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">],</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="c1"># Put nans back in place</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="k">for</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_types</span><span class="p">():</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="k">for</span> <span class="n">ienv</span><span class="p">,</span> <span class="n">inanenv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxnan</span><span class="p">):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">ienv</span><span class="p">][</span><span class="n">inanenv</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="bp">self</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="n">idxnan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="c1"># Move the rois axis back to the first axis</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois_first</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_environment</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spkmap</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
    show_root_heading: true
    show_root_toc_entry: true
    heading_level: 3</p>


<div class="doc doc-object doc-class">



<h2 id="vrAnalysis.processors.spkmaps.Reliability" class="doc doc-heading">
            <code>Reliability</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.Reliability" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Container for reliability values.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Reliability.values">values</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reliability values for each neuron</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Reliability.environments">environments</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environments for which the reliability was computed</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="vrAnalysis.processors.spkmaps.Reliability.method">method</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method used to compute the reliability</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="k">class</span><span class="w"> </span><span class="nc">Reliability</span><span class="p">:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for reliability values.</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">    values : np.ndarray</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        Reliability values for each neuron</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    environments : np.ndarray</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        Environments for which the reliability was computed</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    method : str</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        Method used to compute the reliability</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="n">environments</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">):</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;values and environments must have the same number of environments&quot;</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Reliability(num_rois=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, environments=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="si">}</span><span class="s2">, method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified ROIs.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        idx_rois : np.ndarray</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">            Indices of ROIs to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        -------</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        Reliability</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">            New Reliability instance with filtered ROI values.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="n">idx_rois</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_environments</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified environments by index.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        idx_environments : np.ndarray</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">            Indices of environments to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        -------</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        Reliability</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            New Reliability instance with filtered environment values.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx_environments</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_environments</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_by_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified environments by environment number.</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        environments : list of int</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">            List of environment numbers to keep.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        -------</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        Reliability</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">            New Reliability instance with filtered environment values.</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="n">idx_to_requested_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span> <span class="k">if</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">]</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx_to_requested_env</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_to_requested_env</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Reliability.filter_by_environment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_by_environment</span><span class="p">(</span><span class="n">environments</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Reliability.filter_by_environment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter reliability values to keep only specified environments by environment number.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>environments</code>
            </td>
            <td>
                  <code>list of int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of environment numbers to keep.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Reliability


  
      dataclass
   (vrAnalysis.processors.spkmaps.Reliability)" href="#vrAnalysis.processors.spkmaps.Reliability">Reliability</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Reliability instance with filtered environment values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified environments by environment number.</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    environments : list of int</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        List of environment numbers to keep.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">    -------</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    Reliability</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        New Reliability instance with filtered environment values.</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="n">idx_to_requested_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">env</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">)</span> <span class="k">if</span> <span class="n">env</span> <span class="ow">in</span> <span class="n">environments</span><span class="p">]</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx_to_requested_env</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_to_requested_env</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Reliability.filter_environments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_environments</span><span class="p">(</span><span class="n">idx_environments</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Reliability.filter_environments" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter reliability values to keep only specified environments by index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx_environments</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of environments to keep. Must be a 1D array of integers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Reliability


  
      dataclass
   (vrAnalysis.processors.spkmaps.Reliability)" href="#vrAnalysis.processors.spkmaps.Reliability">Reliability</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Reliability instance with filtered environment values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_environments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_environments</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified environments by index.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    idx_environments : np.ndarray</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        Indices of environments to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    -------</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Reliability</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        New Reliability instance with filtered environment values.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx_environments</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">[</span><span class="n">idx_environments</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.Reliability.filter_rois" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_rois</span><span class="p">(</span><span class="n">idx_rois</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.Reliability.filter_rois" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Filter reliability values to keep only specified ROIs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx_rois</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of ROIs to keep. Must be a 1D array of integers.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Reliability


  
      dataclass
   (vrAnalysis.processors.spkmaps.Reliability)" href="#vrAnalysis.processors.spkmaps.Reliability">Reliability</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New Reliability instance with filtered ROI values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_rois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx_rois</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Reliability&quot;</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter reliability values to keep only specified ROIs.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    idx_rois : np.ndarray</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        Indices of ROIs to keep. Must be a 1D array of integers.</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    -------</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    Reliability</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        New Reliability instance with filtered ROI values.</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">return</span> <span class="n">Reliability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="n">idx_rois</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">environments</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
    show_root_heading: true
    show_root_toc_entry: true
    heading_level: 3</p>


<div class="doc doc-object doc-class">



<h2 id="vrAnalysis.processors.spkmaps.SpkmapParams" class="doc doc-heading">
            <code>SpkmapParams</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapParams" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Parameters for spike map processing.</p>
<p>Contains configuration settings that control how spike maps are processed,
including distance steps, speed thresholds, and standardization options.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dist_step</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step size for distance calculations in spatial units</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speed_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum speed threshold for valid movement periods</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>speed_max_allowed</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum speed allowed for valid movement periods (default is no maximum,
can be useful when behavioral computer allows jumps in position which
are usually due to hardware issues</p>
              </div>
            </td>
            <td>
                  <code>np.inf</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_trial_flexibility</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flexibility parameter for trial alignment. If None, no flexibility</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>standardize_spks</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to standardize spike counts by dividing by the standard deviation</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_width</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the Gaussian smoothing kernel to apply to the maps (width in spatial units)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reliability_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method to use for calculating reliability</p>
              </div>
            </td>
            <td>
                  <code>&#34;leave_one_out&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>autosave</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the cache automatically</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="nd">@dataclass</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpkmapParams</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for spike map processing.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    Contains configuration settings that control how spike maps are processed,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">    including distance steps, speed thresholds, and standardization options.</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">    dist_step : float, default=1</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">        Step size for distance calculations in spatial units</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">    speed_threshold : float, default=1.0</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">        Minimum speed threshold for valid movement periods</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">    speed_max_allowed : float, default=np.inf</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">        Maximum speed allowed for valid movement periods (default is no maximum,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">        can be useful when behavioral computer allows jumps in position which</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">        are usually due to hardware issues</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">    full_trial_flexibility : float | None, default=None</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">        Flexibility parameter for trial alignment. If None, no flexibility</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">    standardize_spks : bool, default=True</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        Whether to standardize spike counts by dividing by the standard deviation</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">    smooth_width : float | None, default=1</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">        Width of the Gaussian smoothing kernel to apply to the maps (width in spatial units)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">    reliability_method : str, default=&quot;leave_one_out&quot;</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">        Method to use for calculating reliability</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">    autosave : bool, default=True</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">        Whether to save the cache automatically</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="n">dist_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="n">speed_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="n">speed_max_allowed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>    <span class="n">full_trial_flexibility</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="n">standardize_spks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="n">smooth_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="n">reliability_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;leave_one_out&quot;</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="n">autosave</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">class_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">class_fields</span><span class="p">:</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="n">field_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">joined_lines</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">(</span><span class="se">\n</span><span class="s2">    </span><span class="si">{</span><span class="n">joined_lines</span><span class="si">}</span><span class="se">\n</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">:</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a SpkmapParams instance from a dictionary.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        params_dict : dict</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">            Dictionary of parameter names and values. Missing parameters will</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">            use default values from SpkmapParams.</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        -------</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">        SpkmapParams</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">            New SpkmapParams instance with values from the dictionary.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">params_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params_dict</span><span class="p">})</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">:</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a SpkmapParams instance from a JSON file.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        path : Path</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">            Path to the JSON file containing parameter values.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        -------</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        SpkmapParams</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">            New SpkmapParams instance loaded from the JSON file.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">,</span> <span class="n">filter_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare two SpkmapParams instances.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        other : SpkmapParams</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">            Another SpkmapParams instance to compare against.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        filter_keys : list of str, optional</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">            If provided, only compare the specified parameter keys.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">            If None, compare all parameters. Default is None.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">        -------</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">        bool</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">            True if the parameters match (or specified keys match), False otherwise.</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="k">if</span> <span class="n">filter_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">filter_keys</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the parameters to a JSON file.</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        path : Path</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">            Path where the JSON file will be saved.</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dist_step must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_threshold</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;speed_threshold must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_trial_flexibility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_trial_flexibility</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If used, full_trial_flexibility must be nonnegative (can also be None)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_width</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;smooth_width must be positive (can also be None)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="c1"># Convert floats to floats when not None</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dist_step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_step</span><span class="p">)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">speed_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_threshold</span><span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">speed_max_allowed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_max_allowed</span><span class="p">)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">full_trial_flexibility</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_trial_flexibility</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_trial_flexibility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smooth_width</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapParams.compare" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">filter_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapParams.compare" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compare two SpkmapParams instances.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SpkmapParams


  
      dataclass
   (vrAnalysis.processors.spkmaps.SpkmapParams)" href="#vrAnalysis.processors.spkmaps.SpkmapParams">SpkmapParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Another SpkmapParams instance to compare against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter_keys</code>
            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, only compare the specified parameter keys.
If None, compare all parameters. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the parameters match (or specified keys match), False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="k">def</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">,</span> <span class="n">filter_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare two SpkmapParams instances.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    other : SpkmapParams</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        Another SpkmapParams instance to compare against.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">    filter_keys : list of str, optional</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        If provided, only compare the specified parameter keys.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        If None, compare all parameters. Default is None.</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">    -------</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">    bool</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">        True if the parameters match (or specified keys match), False otherwise.</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="k">if</span> <span class="n">filter_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">filter_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapParams.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_dict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a SpkmapParams instance from a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of parameter names and values. Missing parameters will
use default values from SpkmapParams.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="SpkmapParams


  
      dataclass
   (vrAnalysis.processors.spkmaps.SpkmapParams)" href="#vrAnalysis.processors.spkmaps.SpkmapParams">SpkmapParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New SpkmapParams instance with values from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">:</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a SpkmapParams instance from a dictionary.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    params_dict : dict</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">        Dictionary of parameter names and values. Missing parameters will</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">        use default values from SpkmapParams.</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    -------</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">    SpkmapParams</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        New SpkmapParams instance with values from the dictionary.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">params_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params_dict</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapParams.from_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#vrAnalysis.processors.spkmaps.SpkmapParams.from_path" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a SpkmapParams instance from a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the JSON file containing parameter values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="SpkmapParams


  
      dataclass
   (vrAnalysis.processors.spkmaps.SpkmapParams)" href="#vrAnalysis.processors.spkmaps.SpkmapParams">SpkmapParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New SpkmapParams instance loaded from the JSON file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="k">def</span><span class="w"> </span><span class="nf">from_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpkmapParams&quot;</span><span class="p">:</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a SpkmapParams instance from a JSON file.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">    path : Path</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        Path to the JSON file containing parameter values.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">    -------</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">    SpkmapParams</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        New SpkmapParams instance loaded from the JSON file.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.processors.spkmaps.SpkmapParams.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#vrAnalysis.processors.spkmaps.SpkmapParams.save" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the parameters to a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the JSON file will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>vrAnalysis/processors/spkmaps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the parameters to a JSON file.</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">    path : Path</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        Path where the JSON file will be saved.</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
    show_root_heading: true
    show_root_toc_entry: true
    heading_level: 3</p>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">&para;</a></h2>
<h3 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vrAnalysis.processors</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpkmapProcessor</span><span class="p">,</span> <span class="n">SpkmapParams</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">vrAnalysis.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">B2Session</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Create a session</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">session</span> <span class="o">=</span> <span class="n">B2Session</span><span class="p">(</span><span class="s2">&quot;path/to/session&quot;</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Create a processor with default parameters</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">processor</span> <span class="o">=</span> <span class="n">SpkmapProcessor</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1"># Get raw maps (unsmoothed, not normalized)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">raw_maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_raw_maps</span><span class="p">()</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1"># Get processed maps (smoothed and normalized by occupancy)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">processed_maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">()</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># Get environment-separated maps</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">env_maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">()</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="c1"># Calculate reliability</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">reliability</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_reliability</span><span class="p">()</span>
</code></pre></div>
<h3 id="custom-parameters">Custom Parameters<a class="headerlink" href="#custom-parameters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Create custom parameters</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">params</span> <span class="o">=</span> <span class="n">SpkmapParams</span><span class="p">(</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">dist_step</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># 2 cm bins</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">speed_threshold</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># 2 cm/s minimum speed</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">smooth_width</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># 5 cm smoothing</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">standardize_spks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># Use custom parameters</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">processor</span> <span class="o">=</span> <span class="n">SpkmapProcessor</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1"># Or update parameters temporarily</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;smooth_width&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">})</span>
</code></pre></div>
<h3 id="working-with-maps">Working with Maps<a class="headerlink" href="#working-with-maps" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Get processed maps</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">()</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1"># Filter to specific ROIs</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">maps</span><span class="o">.</span><span class="n">filter_rois</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1"># Filter to specific positions</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">maps</span><span class="o">.</span><span class="n">filter_positions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="c1"># Average across trials</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">maps</span><span class="o">.</span><span class="n">average_trials</span><span class="p">()</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="c1"># Check memory usage</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maps use </span><span class="si">{</span><span class="n">maps</span><span class="o">.</span><span class="n">nbytes</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="environment-separated-maps">Environment-Separated Maps<a class="headerlink" href="#environment-separated-maps" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Get maps separated by environment</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">env_maps</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_env_maps</span><span class="p">()</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># Access maps for a specific environment</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">env_idx</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">occmap_env0</span> <span class="o">=</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">occmap</span><span class="p">[</span><span class="n">env_idx</span><span class="p">]</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">spkmap_env0</span> <span class="o">=</span> <span class="n">env_maps</span><span class="o">.</span><span class="n">spkmap</span><span class="p">[</span><span class="n">env_idx</span><span class="p">]</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="c1"># Filter to specific environments</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">env_maps</span><span class="o">.</span><span class="n">filter_environments</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>  <span class="c1"># Keep only environments 1 and 2</span>
</code></pre></div>
<h3 id="reliability-analysis">Reliability Analysis<a class="headerlink" href="#reliability-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Calculate reliability with default method (leave_one_out)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">reliability</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_reliability</span><span class="p">()</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># Access reliability values</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c1"># Shape: (num_environments, num_rois)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">reliability_values</span> <span class="o">=</span> <span class="n">reliability</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># Filter to specific ROIs</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">reliability_filtered</span> <span class="o">=</span> <span class="n">reliability</span><span class="o">.</span><span class="n">filter_rois</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># Filter to specific environments</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="n">reliability_env</span> <span class="o">=</span> <span class="n">reliability</span><span class="o">.</span><span class="n">filter_by_environment</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>
<h3 id="place-field-predictions">Place Field Predictions<a class="headerlink" href="#place-field-predictions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Get place field predictions for each frame</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">prediction</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_placefield_prediction</span><span class="p">()</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># prediction shape: (num_frames, num_rois)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># extras contains frame_position_index, frame_environment_index, idx_valid</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1"># Use predictions to analyze neural activity</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">valid_predictions</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">extras</span><span class="p">[</span><span class="s2">&quot;idx_valid&quot;</span><span class="p">]]</span>
</code></pre></div>
<h3 id="traversals-analysis">Traversals Analysis<a class="headerlink" href="#traversals-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Extract activity around place field peak</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">roi_idx</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Neuron index</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">env_idx</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Environment index</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">traversals</span><span class="p">,</span> <span class="n">pred_travs</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_traversals</span><span class="p">(</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">idx_roi</span><span class="o">=</span><span class="n">roi_idx</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">idx_env</span><span class="o">=</span><span class="n">env_idx</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># 10 frames on each side</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">placefield_threshold</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># 5 cm threshold</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="c1"># traversals shape: (num_traversals, 21)  # 2*width + 1</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># pred_travs shape: (num_traversals, 21)</span>
</code></pre></div>
<h2 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link">&para;</a></h2>
<p>The SpkmapProcessor uses intelligent caching to avoid recomputing maps when parameters haven't changed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Enable autosave to cache results</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">params</span> <span class="o">=</span> <span class="n">SpkmapParams</span><span class="p">(</span><span class="n">autosave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">processor</span> <span class="o">=</span> <span class="n">SpkmapProcessor</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c1"># First call computes and caches</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">maps1</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">()</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c1"># Second call loads from cache (much faster)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">maps2</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">()</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="c1"># Force recomputation</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">maps3</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_processed_maps</span><span class="p">(</span><span class="n">force_recompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="c1"># View cache information</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">processor</span><span class="o">.</span><span class="n">show_cache</span><span class="p">()</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">processor</span><span class="o">.</span><span class="n">show_cache</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;processed_maps&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="protocol-interface">Protocol Interface<a class="headerlink" href="#protocol-interface" title="Permanent link">&para;</a></h2>
<p>The <code>SpkmapProcessor</code> works with any session class that implements the <code>SessionToSpkmapProtocol</code>. This protocol defines the required properties:</p>
<ul>
<li><code>spks</code>: Spike data array</li>
<li><code>spks_type</code>: Type of spike data</li>
<li><code>idx_rois</code>: ROI filter mask</li>
<li><code>timestamps</code>: Imaging frame timestamps</li>
<li><code>env_length</code>: Environment length(s)</li>
<li><code>positions</code>: Position data tuple</li>
<li><code>trial_environment</code>: Environment for each trial</li>
<li><code>num_trials</code>: Number of trials</li>
<li><code>zero_baseline_spks</code>: Whether spikes are zero-baselined</li>
</ul>
<p>See the protocol documentation for details on implementing custom session classes.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>