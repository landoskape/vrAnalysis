
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for vrAnalysis - Virtual Reality Analysis Package">
      
      
        <meta name="author" content="Andrew Landau">
      
      
        <link rel="canonical" href="https://landoskape.github.io/vrAnalysis/api/database/">
      
      
        <link rel="prev" href="../b2session/">
      
      
        <link rel="next" href="../registration/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>database - vrAnalysis Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="vrAnalysis Documentation" class="md-header__button md-logo" aria-label="vrAnalysis Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            vrAnalysis Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              database
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/landoskape/vrAnalysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    landoskape/vrAnalysis
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../overview/" class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../workflows/" class="md-tabs__link">
          
  
  
  Workflows

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../sessions/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="vrAnalysis Documentation" class="md-nav__button md-logo" aria-label="vrAnalysis Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    vrAnalysis Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/landoskape/vrAnalysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    landoskape/vrAnalysis
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Registration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sessions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../b2session/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    b2sessions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    database
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    database
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.database" class="md-nav__link">
    <span class="md-ellipsis">
      database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDatabase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.add_record" class="md-nav__link">
    <span class="md-ellipsis">
      add_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.construct_filter_string" class="md-nav__link">
    <span class="md-ellipsis">
      construct_filter_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.create_update_many_statement" class="md-nav__link">
    <span class="md-ellipsis">
      create_update_many_statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.create_update_statement" class="md-nav__link">
    <span class="md-ellipsis">
      create_update_statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_dbfile" class="md-nav__link">
    <span class="md-ellipsis">
      get_dbfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_record" class="md-nav__link">
    <span class="md-ellipsis">
      get_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_table" class="md-nav__link">
    <span class="md-ellipsis">
      get_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.open_cursor" class="md-nav__link">
    <span class="md-ellipsis">
      open_cursor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.process_filter_value" class="md-nav__link">
    <span class="md-ellipsis">
      process_filter_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.process_unique_fields" class="md-nav__link">
    <span class="md-ellipsis">
      process_unique_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.save_backup" class="md-nav__link">
    <span class="md-ellipsis">
      save_backup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.show_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      show_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.table_column_info" class="md-nav__link">
    <span class="md-ellipsis">
      table_column_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.table_data" class="md-nav__link">
    <span class="md-ellipsis">
      table_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.update_database_field" class="md-nav__link">
    <span class="md-ellipsis">
      update_database_field
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase" class="md-nav__link">
    <span class="md-ellipsis">
      SessionDatabase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SessionDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.check_s2p" class="md-nav__link">
    <span class="md-ellipsis">
      check_s2p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.iter_sessions" class="md-nav__link">
    <span class="md-ellipsis">
      iter_sessions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.iter_sessions_need_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      iter_sessions_need_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.make_b2registration" class="md-nav__link">
    <span class="md-ellipsis">
      make_b2registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.make_b2session" class="md-nav__link">
    <span class="md-ellipsis">
      make_b2session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      needs_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_registration" class="md-nav__link">
    <span class="md-ellipsis">
      needs_registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_s2p" class="md-nav__link">
    <span class="md-ellipsis">
      needs_s2p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.print_registration_errors" class="md-nav__link">
    <span class="md-ellipsis">
      print_registration_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_record" class="md-nav__link">
    <span class="md-ellipsis">
      register_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_sessions" class="md-nav__link">
    <span class="md-ellipsis">
      register_sessions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_single_session" class="md-nav__link">
    <span class="md-ellipsis">
      register_single_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.session_name" class="md-nav__link">
    <span class="md-ellipsis">
      session_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.set_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      set_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.update_red_cell_qc_date_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_red_cell_qc_date_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.update_s2p_date_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_s2p_date_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.get_database" class="md-nav__link">
    <span class="md-ellipsis">
      get_database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.get_database_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_database_metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../registration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../processors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    processors
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/session_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vrAnalysis.database" class="md-nav__link">
    <span class="md-ellipsis">
      database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase" class="md-nav__link">
    <span class="md-ellipsis">
      BaseDatabase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.add_record" class="md-nav__link">
    <span class="md-ellipsis">
      add_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.construct_filter_string" class="md-nav__link">
    <span class="md-ellipsis">
      construct_filter_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.create_update_many_statement" class="md-nav__link">
    <span class="md-ellipsis">
      create_update_many_statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.create_update_statement" class="md-nav__link">
    <span class="md-ellipsis">
      create_update_statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_dbfile" class="md-nav__link">
    <span class="md-ellipsis">
      get_dbfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_record" class="md-nav__link">
    <span class="md-ellipsis">
      get_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.get_table" class="md-nav__link">
    <span class="md-ellipsis">
      get_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.open_cursor" class="md-nav__link">
    <span class="md-ellipsis">
      open_cursor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.process_filter_value" class="md-nav__link">
    <span class="md-ellipsis">
      process_filter_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.process_unique_fields" class="md-nav__link">
    <span class="md-ellipsis">
      process_unique_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.save_backup" class="md-nav__link">
    <span class="md-ellipsis">
      save_backup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.show_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      show_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.table_column_info" class="md-nav__link">
    <span class="md-ellipsis">
      table_column_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.table_data" class="md-nav__link">
    <span class="md-ellipsis">
      table_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.BaseDatabase.update_database_field" class="md-nav__link">
    <span class="md-ellipsis">
      update_database_field
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase" class="md-nav__link">
    <span class="md-ellipsis">
      SessionDatabase
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SessionDatabase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.check_s2p" class="md-nav__link">
    <span class="md-ellipsis">
      check_s2p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.iter_sessions" class="md-nav__link">
    <span class="md-ellipsis">
      iter_sessions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.iter_sessions_need_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      iter_sessions_need_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.make_b2registration" class="md-nav__link">
    <span class="md-ellipsis">
      make_b2registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.make_b2session" class="md-nav__link">
    <span class="md-ellipsis">
      make_b2session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      needs_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_registration" class="md-nav__link">
    <span class="md-ellipsis">
      needs_registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.needs_s2p" class="md-nav__link">
    <span class="md-ellipsis">
      needs_s2p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.print_registration_errors" class="md-nav__link">
    <span class="md-ellipsis">
      print_registration_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_record" class="md-nav__link">
    <span class="md-ellipsis">
      register_record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_sessions" class="md-nav__link">
    <span class="md-ellipsis">
      register_sessions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.register_single_session" class="md-nav__link">
    <span class="md-ellipsis">
      register_single_session
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.session_name" class="md-nav__link">
    <span class="md-ellipsis">
      session_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.set_red_cell_qc" class="md-nav__link">
    <span class="md-ellipsis">
      set_red_cell_qc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.update_red_cell_qc_date_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_red_cell_qc_date_time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.SessionDatabase.update_s2p_date_time" class="md-nav__link">
    <span class="md-ellipsis">
      update_s2p_date_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.get_database" class="md-nav__link">
    <span class="md-ellipsis">
      get_database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vrAnalysis.database.get_database_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      get_database_metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="database-api-reference">Database API Reference<a class="headerlink" href="#database-api-reference" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<h2 id="vrAnalysis.database" class="doc doc-heading">
            <code>database</code>


<a href="#vrAnalysis.database" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

        <p>Database management module for VR analysis sessions.</p>
<p>This module provides classes and functions for interacting with Microsoft Access
databases used to track VR session data. It includes base database functionality
and specialized session database management with support for registration workflows,
suite2p processing tracking, and quality control operations.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="vrAnalysis.database.BaseDatabase" class="doc doc-heading">
            <code>BaseDatabase</code>


<a href="#vrAnalysis.database.BaseDatabase" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>vrAnalysis/database.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseDatabase</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Initialize a new database instance.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        This constructor initializes a new instance of the BaseDatabase class. It sets the default</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        values for the table name, database name, and database path. It is built to work with</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        the Microsoft Access application; however, a few small changes can make it compatible with</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        other SQL-based database systems.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        db_name : str, required</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">            The name of the database to access.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        Example</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        -------</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        &gt;&gt;&gt; db = BaseDatabase(&#39;vrSessions&#39;)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        &gt;&gt;&gt; print(vrdb.table_name)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        &#39;sessiondb&#39;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        &gt;&gt;&gt; print(vrdb.db_name)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        &#39;vrDatabase&#39;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        -----</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        - This constructor uses a supporting function called get_database_metadata to get database metadata based on the db_name provided.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        - If you are using this on a new system, then you should edit your path, database name, and default table in that function.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_database_metadata</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_path&quot;</span><span class="p">]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_ext&quot;</span><span class="p">]</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;table_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;backup_path&quot;</span><span class="p">]</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">host_type</span> <span class="o">=</span> <span class="n">host_types</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="p">]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_unique_fields</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;unique_fields&quot;</span><span class="p">])</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;default_conditions&quot;</span><span class="p">]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_unique_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Process and validate unique field definitions.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        Converts unique field specifications into a standardized format where each</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        field is a tuple of (field_name, field_type). String fields can be specified</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        as just the name and will default to str type.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        fields : list</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">            List of field specifications. Each can be:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">            - A string (field name, defaults to str type)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            - A tuple of (field_name, type) where type is a Python type class</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        -------</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        list</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">            List of tuples, each containing (field_name, field_type).</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        ------</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        ValueError</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">            If a field specification is not a string or a valid (string, type) tuple.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">ufields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="n">ufields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">ufields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unique field </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> must be a string or a string-type tuple&quot;</span><span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">return</span> <span class="n">ufields</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_dbfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Get the full path to the database file.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        -------</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        Path</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            Path object pointing to the database file.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_out</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CompletedProcess</span><span class="p">]:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a backup of the database to the backup path specified in metadata.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        return_out : bool, optional</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            If True, return the output of the robocopy command.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        -------</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        CompletedProcess or None</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            CompletedProcess object from the robocopy command (if return_out is True).</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            Returns None if return_out is False.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">target_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">source_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">robocopy_arguments</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;robocopy </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">source_file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">outs</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">robocopy_arguments</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="k">if</span> <span class="n">return_out</span><span class="p">:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="k">return</span> <span class="n">outs</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">        Establish a connection to the database.</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        Creates a pyodbc connection using the appropriate driver string based on</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        the database file extension. Currently configured for Microsoft Access</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        databases (.accdb, .mdb files).</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        -------</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        pyodbc.Connection</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">            Database connection object.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        ------</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        AssertionError</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">            If the host type for the database extension is not supported.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        -----</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        To support additional database types:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        1. Determine the appropriate pyodbc driver string for your database</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        2. Add it to the driver_string dictionary in this method</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        3. Update the host_types dictionary at the module level to map your</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">           file extension to the driver key</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        See https://www.connectionstrings.com/ for driver string examples.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">driver_string</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;DRIVER={Microsoft Access Driver (*.mdb, *.accdb)};&quot;</span> <span class="o">+</span> <span class="sa">rf</span><span class="s2">&quot;DBQ=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dbfile</span><span class="p">()</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="c1"># Make sure connections are possible for this hosttype</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">failure_message</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="sa">f</span><span class="s2">&quot;Requested host_type (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="si">}</span><span class="s2">) is not available. The only ones that are coded are: </span><span class="si">{</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">driver_string</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="sa">f</span><span class="s2">&quot;For support with writing a driver string for a different host, use the fantastic website: https://www.connectionstrings.com/&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_type</span> <span class="ow">in</span> <span class="n">driver_string</span><span class="p">,</span> <span class="n">failure_message</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="c1"># Return a connection to the database</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="k">return</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">driver_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="p">])</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="nd">@contextmanager</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit_changes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">pyodbc</span><span class="o">.</span><span class="n">Cursor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">        Context manager to open a database cursor and manage connections.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        This context manager provides a convenient way to open a cursor to the database,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        perform database operations, and manage connections. It also allows you to</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        commit changes if needed.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        commit_changes : bool, optional</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">            Whether to commit changes to the database. Default is False.</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        Yields</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        ------</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        pyodbc.Cursor</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">            A database cursor for executing SQL queries.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        ------</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        Exception</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            If an error occurs while connecting to the database.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Example</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        -------</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        Use the context manager to perform database operations:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        ...     cursor.execute(&quot;SELECT * FROM your_table&quot;)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="c1"># Attempt to open a cursor to the database</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="k">yield</span> <span class="n">cursor</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An exception occurred while trying to connect to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="k">raise</span> <span class="n">ex</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="c1"># if no exception was raised, commit changes</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="k">if</span> <span class="n">commit_changes</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="c1"># Always close the cursor and connection</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="c1"># == display meta data for database ==</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        Display metadata associated with the open database.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">        Prints information about the database location, name, table, unique ID field,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        backup path, and default filtering conditions.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="si">}</span><span class="s2"> database located at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="si">}</span><span class="s2">, table name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">, with uid: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Backup path located at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No backup path specified...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default database filters:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_filter_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_filter_value</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No default filters.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">table_column_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Retrieve the column names, data types, and nullable status of the table.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        -------</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">            A tuple containing three elements:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">            - A list of strings representing the column names of the table.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">            - A list of strings representing the data types of the table.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">            - A list of booleans representing the nullable status of the table.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> WHERE 1=0&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="n">column_descriptions</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">column_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">column_descriptions</span><span class="p">))</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="k">return</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">nullable</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="c1"># == retrieve table data ==</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">table_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        Retrieve data and field names from the specified table.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        This method retrieves the field names and table elements from the table specified</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        in the `BaseDatabase` instance.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        -------</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            A tuple containing two elements:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            - A list of strings representing the field names of the table.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">            - A list of tuples representing the data rows of the table.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">column_name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">table_elements</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">return</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">table_elements</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        Retrieve data from table in database and return as dataframe with optional filtering.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        This method retrieves all data from the primary table in the database specified in</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        BaseDatabase instance. It automatically filters the data using the defaultConditions</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        defined in the dbMetadata method. kw_conditions overwrite defaultConditions if there is</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        a conflict.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        use_default : bool, default=True</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">            Use default conditions if true, if False ignore them</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">            Additional filtering conditions as keyword arguments.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">            Each condition should match a column name in the table.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">            Value can either be a variable (e.g. 0 or &#39;ATL000&#39;), or a (value, operation) pair.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">            The operation defaults to &#39;==&#39;, but you can use anything that works as a df query.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">            Examples:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">                - Simple equality: ``imaging=True`` filters where imaging column equals True</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">                - Comparison operators: ``sessionID=(5, &#39;&gt;&#39;)`` filters where sessionID &gt; 5</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">                - Multiple conditions: ``imaging=True, mouseName=&#39;ATL028&#39;`` applies AND logic</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">            Note: this is limited in the sense that empty data can&#39;t be identified with key:None.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">            (using the pd.isnull() is a valid work around, but needs to be coded outside of get_table())</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        -------</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        df : pandas dataframe</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            A dataframe containing the filtered data from the primary database table.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        Example</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        -------</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        &gt;&gt;&gt; vrdb = YourDatabaseClass()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        &gt;&gt;&gt; df = vrdb.get_table(imaging=True)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        &gt;&gt;&gt; df = vrdb.get_table(mouseName=&#39;ATL028&#39;, sessionID=(5, &#39;&gt;&#39;))</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">field_names</span><span class="p">,</span> <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">()</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">field_names</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">conditions</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="p">)</span> <span class="k">if</span> <span class="n">use_default</span> <span class="k">else</span> <span class="p">{}</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="n">conditions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">if</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not a column name in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="n">conditions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_filter_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># make sure it&#39;s a value/operation pair</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">construct_filter_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_op_tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_op_tuple</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_filter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Ensure filter value has an operation associated with it.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        Filters are passed to pandas DataFrame queries as {key}{operation}{value}.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        This method ensures each value is a tuple of (value, operation), defaulting</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        to &#39;==&#39; if no operation is specified.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        val : any or tuple</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">            Filter value. If a tuple, should be (value, operation). If not a tuple,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">            will be converted to (val, &#39;==&#39;).</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        -------</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">            Tuple of (value, operation) for use in DataFrame queries.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">return</span> <span class="n">val</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_filter_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val_op_tuple</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        Construct a string to be used as a pandas DataFrame query expression.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">        key : str</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">            Column name to filter on.</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">        val_op_tuple : tuple</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">            Tuple of (value, operation) where operation is a comparison operator</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">            (e.g., &#39;==&#39;, &#39;!=&#39;, &#39;&gt;&#39;, &#39;&lt;&#39;).</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">        -------</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">        str</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">            Query string in the format `column_name`operator&#39;value&#39;.</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="n">val</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="n">val_op_tuple</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`</span><span class="si">{</span><span class="n">op</span><span class="si">}{</span><span class="n">val</span><span class="si">!r}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="c1"># == methods for adding records and updating information to the database ==</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_update_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        Create an SQL UPDATE statement for a single field and record.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        field : str</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">            Name of the field to update.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        uid : any</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">            Unique identifier value for the record to update.</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        -------</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">        str</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">            SQL UPDATE statement with parameter placeholder.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">        Example</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        -------</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        ...     cursor.execute(self.create_update_statement(&quot;fieldName&quot;, 123), value)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> set </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = ? WHERE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_update_many_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        Create an SQL UPDATE statement for batch updating a single field.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        field : str</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">            Name of the field to update.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        -------</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        str</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">            SQL UPDATE statement with parameter placeholders for value and uid.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        Example</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        -------</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        ...     stmt = self.create_update_many_statement(&quot;fieldName&quot;)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">        ...     cursor.executemany(stmt, [(val1, uid1), (val2, uid2), ...])</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> set </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = ? where </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> = ?&quot;</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_database_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        Update a database field for all records matching specified conditions.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        field : str</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">            Name of the field to update.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        val : any</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">            Value to set for the field.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">            Filtering conditions to identify records to update.</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">            Examples: ``mouseName=&#39;ATL028&#39;``, ``imaging=True``</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">        Raises</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        ------</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        AssertionError</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">            If the specified field is not in the database table.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Requested field (</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">) is not in table. Use &#39;self.table_data()[0]&#39; to see available fields.&quot;</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">update_statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">uids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># uids of all sessions requested</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="n">val_as_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">uids</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> for all requested records...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">update_statement</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">val_as_list</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="c1"># == method for adding a record to the database ==</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">insert_statement</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Add a single record to the database.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        First checks if a record with matching unique field values already exists.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">        If so, prevents duplicate insertion and returns a message. Otherwise,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        adds the new record to the database.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        insert_statement : str</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">            SQL INSERT statement with parameter placeholders.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        columns : list</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            List of column names matching the insert statement.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        values : list</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            List of values to insert, corresponding to the columns.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">        -------</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">        str</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">            Success or duplicate record message.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="n">unique_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">]</span>  <span class="c1"># get values associated with unique fields</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="c1"># this is required for communicating with Access</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>                <span class="n">unique_values</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">uv</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="o">*</span><span class="n">unique_values</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Record already exists for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Record already exists for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert_statement</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully added new record for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="k">return</span> <span class="s2">&quot;Successfully added new record&quot;</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">unique_values</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        Retrieve single record from table in database and return as dataframe.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">        This method retrieves a single record(row) from the table in the database. The metadata for</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        each database defines a set of fields that comprise a unique set (each combination of values</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">        for the unique fields is only represented once in the database).</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">        *unique_values: variable length list of values associated with the unique fields</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">            - must be the same length as self.uniqueFields</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">            - the second value of the uniqueField tuple (string by default) determines how</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">              to query the unique value</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">        -------</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        record : pandas Series</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">        Example</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">        -------</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        &gt;&gt;&gt; vrdb = YourDatabaseClass()</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        &gt;&gt;&gt; record = vrdb.get_record(*unique_conditions)</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="c1"># Check if correct values are provided</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">):</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="n">expected_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">])</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> values provided but *get_record* is expecting values for: </span><span class="si">{</span><span class="n">expected_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="c1"># Get table and compare</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">):</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="k">if</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">uv</span><span class="p">]</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="k">elif</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">datetime</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sd</span><span class="p">:</span> <span class="n">sd</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="n">uv</span><span class="p">]</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="k">elif</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">uv</span><span class="p">)]</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;uniqueField type (</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">) not recognized, add the appropriate query to this method!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No session found under: </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple sessions found under: </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize a new database instance.</p>
<p>This constructor initializes a new instance of the BaseDatabase class. It sets the default
values for the table name, database name, and database path. It is built to work with
the Microsoft Access application; however, a few small changes can make it compatible with
other SQL-based database systems.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_name</code>
            </td>
            <td>
                  <code>(<span title="str">str</span>, <span title="required">required</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the database to access.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>db = BaseDatabase('vrSessions')
print(vrdb.table_name)
'sessiondb'
print(vrdb.db_name)
'vrDatabase'</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>This constructor uses a supporting function called get_database_metadata to get database metadata based on the db_name provided.</li>
<li>If you are using this on a new system, then you should edit your path, database name, and default table in that function.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    Initialize a new database instance.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    This constructor initializes a new instance of the BaseDatabase class. It sets the default</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    values for the table name, database name, and database path. It is built to work with</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    the Microsoft Access application; however, a few small changes can make it compatible with</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    other SQL-based database systems.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    db_name : str, required</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        The name of the database to access.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    Example</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    -------</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    &gt;&gt;&gt; db = BaseDatabase(&#39;vrSessions&#39;)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    &gt;&gt;&gt; print(vrdb.table_name)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    &#39;sessiondb&#39;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    &gt;&gt;&gt; print(vrdb.db_name)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    &#39;vrDatabase&#39;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    -----</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    - This constructor uses a supporting function called get_database_metadata to get database metadata based on the db_name provided.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    - If you are using this on a new system, then you should edit your path, database name, and default table in that function.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_database_metadata</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_path&quot;</span><span class="p">]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;db_ext&quot;</span><span class="p">]</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;table_name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;backup_path&quot;</span><span class="p">]</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">host_type</span> <span class="o">=</span> <span class="n">host_types</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="p">]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_unique_fields</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;unique_fields&quot;</span><span class="p">])</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;default_conditions&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.add_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_record</span><span class="p">(</span><span class="n">insert_statement</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.add_record" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Add a single record to the database.</p>
<p>First checks if a record with matching unique field values already exists.
If so, prevents duplicate insertion and returns a message. Otherwise,
adds the new record to the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>insert_statement</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL INSERT statement with parameter placeholders.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of column names matching the insert statement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of values to insert, corresponding to the columns.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Success or duplicate record message.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">insert_statement</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    Add a single record to the database.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    First checks if a record with matching unique field values already exists.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    If so, prevents duplicate insertion and returns a message. Otherwise,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    adds the new record to the database.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    insert_statement : str</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        SQL INSERT statement with parameter placeholders.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    columns : list</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        List of column names matching the insert statement.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    values : list</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">        List of values to insert, corresponding to the columns.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">    -------</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    str</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">        Success or duplicate record message.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">unique_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">]</span>  <span class="c1"># get values associated with unique fields</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="c1"># this is required for communicating with Access</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="n">unique_values</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">uv</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="o">*</span><span class="n">unique_values</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Record already exists for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Record already exists for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">insert_statement</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully added new record for </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="k">return</span> <span class="s2">&quot;Successfully added new record&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.BaseDatabase.connect" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Establish a connection to the database.</p>
<p>Creates a pyodbc connection using the appropriate driver string based on
the database file extension. Currently configured for Microsoft Access
databases (.accdb, .mdb files).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyodbc.Connection">Connection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database connection object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AssertionError">AssertionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the host type for the database extension is not supported.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>To support additional database types:
1. Determine the appropriate pyodbc driver string for your database
2. Add it to the driver_string dictionary in this method
3. Update the host_types dictionary at the module level to map your
   file extension to the driver key</p>
<p>See https://www.connectionstrings.com/ for driver string examples.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    Establish a connection to the database.</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    Creates a pyodbc connection using the appropriate driver string based on</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    the database file extension. Currently configured for Microsoft Access</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    databases (.accdb, .mdb files).</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    -------</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    pyodbc.Connection</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        Database connection object.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    ------</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    AssertionError</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        If the host type for the database extension is not supported.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    -----</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    To support additional database types:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    1. Determine the appropriate pyodbc driver string for your database</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    2. Add it to the driver_string dictionary in this method</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    3. Update the host_types dictionary at the module level to map your</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">       file extension to the driver key</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    See https://www.connectionstrings.com/ for driver string examples.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="n">driver_string</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;DRIVER={Microsoft Access Driver (*.mdb, *.accdb)};&quot;</span> <span class="o">+</span> <span class="sa">rf</span><span class="s2">&quot;DBQ=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dbfile</span><span class="p">()</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">}</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="c1"># Make sure connections are possible for this hosttype</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">failure_message</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="sa">f</span><span class="s2">&quot;Requested host_type (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="si">}</span><span class="s2">) is not available. The only ones that are coded are: </span><span class="si">{</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">driver_string</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="sa">f</span><span class="s2">&quot;For support with writing a driver string for a different host, use the fantastic website: https://www.connectionstrings.com/&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_type</span> <span class="ow">in</span> <span class="n">driver_string</span><span class="p">,</span> <span class="n">failure_message</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="c1"># Return a connection to the database</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">return</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">driver_string</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.construct_filter_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_filter_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_op_tuple</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.construct_filter_string" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Construct a string to be used as a pandas DataFrame query expression.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name to filter on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val_op_tuple</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (value, operation) where operation is a comparison operator
(e.g., '==', '!=', '&gt;', '&lt;').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query string in the format <code>column_name</code>operator'value'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_filter_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val_op_tuple</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    Construct a string to be used as a pandas DataFrame query expression.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">    key : str</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">        Column name to filter on.</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">    val_op_tuple : tuple</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">        Tuple of (value, operation) where operation is a comparison operator</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">        (e.g., &#39;==&#39;, &#39;!=&#39;, &#39;&gt;&#39;, &#39;&lt;&#39;).</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    -------</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    str</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">        Query string in the format `column_name`operator&#39;value&#39;.</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="n">val</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="n">val_op_tuple</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`</span><span class="si">{</span><span class="n">op</span><span class="si">}{</span><span class="n">val</span><span class="si">!r}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.create_update_many_statement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_update_many_statement</span><span class="p">(</span><span class="n">field</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.create_update_many_statement" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create an SQL UPDATE statement for batch updating a single field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL UPDATE statement with parameter placeholders for value and uid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with self.open_cursor(commit_changes=True) as cursor:
...     stmt = self.create_update_many_statement("fieldName")
...     cursor.executemany(stmt, [(val1, uid1), (val2, uid2), ...])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_update_many_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    Create an SQL UPDATE statement for batch updating a single field.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    field : str</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        Name of the field to update.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    -------</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">    str</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        SQL UPDATE statement with parameter placeholders for value and uid.</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    Example</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    -------</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    ...     stmt = self.create_update_many_statement(&quot;fieldName&quot;)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    ...     cursor.executemany(stmt, [(val1, uid1), (val2, uid2), ...])</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> set </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = ? where </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> = ?&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.create_update_statement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_update_statement</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.create_update_statement" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create an SQL UPDATE statement for a single field and record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uid</code>
            </td>
            <td>
                  <code><span title="any">any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier value for the record to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL UPDATE statement with parameter placeholder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with self.open_cursor(commit_changes=True) as cursor:
...     cursor.execute(self.create_update_statement("fieldName", 123), value)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_update_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    Create an SQL UPDATE statement for a single field and record.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">    field : str</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">        Name of the field to update.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    uid : any</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        Unique identifier value for the record to update.</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    -------</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    str</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">        SQL UPDATE statement with parameter placeholder.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    Example</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    -------</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">    ...     cursor.execute(self.create_update_statement(&quot;fieldName&quot;, 123), value)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> set </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = ? WHERE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.get_dbfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dbfile</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.BaseDatabase.get_dbfile" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the full path to the database file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path object pointing to the database file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_dbfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Get the full path to the database file.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    -------</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    Path</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        Path object pointing to the database file.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.get_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_record</span><span class="p">(</span><span class="o">*</span><span class="n">unique_values</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.get_record" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Retrieve single record from table in database and return as dataframe.</p>
<p>This method retrieves a single record(row) from the table in the database. The metadata for
each database defines a set of fields that comprise a unique set (each combination of values
for the unique fields is only represented once in the database).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>*unique_values</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>must be the same length as self.uniqueFields</li>
<li>the second value of the uniqueField tuple (string by default) determines how
  to query the unique value</li>
</ul>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>record</code></td>            <td>
                  <code>pandas Series</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>vrdb = YourDatabaseClass()
record = vrdb.get_record(*unique_conditions)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">unique_values</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    Retrieve single record from table in database and return as dataframe.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">    This method retrieves a single record(row) from the table in the database. The metadata for</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    each database defines a set of fields that comprise a unique set (each combination of values</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    for the unique fields is only represented once in the database).</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">    *unique_values: variable length list of values associated with the unique fields</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">        - must be the same length as self.uniqueFields</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        - the second value of the uniqueField tuple (string by default) determines how</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">          to query the unique value</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    -------</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    record : pandas Series</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    Example</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    -------</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    &gt;&gt;&gt; vrdb = YourDatabaseClass()</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    &gt;&gt;&gt; record = vrdb.get_record(*unique_conditions)</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="c1"># Check if correct values are provided</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">):</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="n">expected_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">uf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">])</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> values provided but *get_record* is expecting values for: </span><span class="si">{</span><span class="n">expected_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="c1"># Get table and compare</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">):</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="k">if</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">uv</span><span class="p">]</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">elif</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">datetime</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sd</span><span class="p">:</span> <span class="n">sd</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="n">uv</span><span class="p">]</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="k">elif</span> <span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">uv</span><span class="p">)]</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;uniqueField type (</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">) not recognized, add the appropriate query to this method!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No session found under: </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="n">unique_combo</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">uv</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">uf</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_fields</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)])</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple sessions found under: </span><span class="si">{</span><span class="n">unique_combo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.get_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_table</span><span class="p">(</span><span class="n">use_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.get_table" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Retrieve data from table in database and return as dataframe with optional filtering.</p>
<p>This method retrieves all data from the primary table in the database specified in
BaseDatabase instance. It automatically filters the data using the defaultConditions
defined in the dbMetadata method. kw_conditions overwrite defaultConditions if there is
a conflict.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_default</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use default conditions if true, if False ignore them</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions as keyword arguments.
Each condition should match a column name in the table.
Value can either be a variable (e.g. 0 or 'ATL000'), or a (value, operation) pair.
The operation defaults to '==', but you can use anything that works as a df query.</p>
<p>Examples:
    - Simple equality: <code>imaging=True</code> filters where imaging column equals True
    - Comparison operators: <code>sessionID=(5, '&gt;')</code> filters where sessionID &gt; 5
    - Multiple conditions: <code>imaging=True, mouseName='ATL028'</code> applies AND logic</p>
<p>Note: this is limited in the sense that empty data can't be identified with key:None.
(using the pd.isnull() is a valid work around, but needs to be coded outside of get_table())</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>df</code></td>            <td>
                  <code>pandas dataframe</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataframe containing the filtered data from the primary database table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>vrdb = YourDatabaseClass()
df = vrdb.get_table(imaging=True)
df = vrdb.get_table(mouseName='ATL028', sessionID=(5, '&gt;'))</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">    Retrieve data from table in database and return as dataframe with optional filtering.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">    This method retrieves all data from the primary table in the database specified in</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    BaseDatabase instance. It automatically filters the data using the defaultConditions</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    defined in the dbMetadata method. kw_conditions overwrite defaultConditions if there is</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    a conflict.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    use_default : bool, default=True</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        Use default conditions if true, if False ignore them</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        Additional filtering conditions as keyword arguments.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        Each condition should match a column name in the table.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        Value can either be a variable (e.g. 0 or &#39;ATL000&#39;), or a (value, operation) pair.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">        The operation defaults to &#39;==&#39;, but you can use anything that works as a df query.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        Examples:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">            - Simple equality: ``imaging=True`` filters where imaging column equals True</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">            - Comparison operators: ``sessionID=(5, &#39;&gt;&#39;)`` filters where sessionID &gt; 5</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">            - Multiple conditions: ``imaging=True, mouseName=&#39;ATL028&#39;`` applies AND logic</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        Note: this is limited in the sense that empty data can&#39;t be identified with key:None.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        (using the pd.isnull() is a valid work around, but needs to be coded outside of get_table())</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    -------</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    df : pandas dataframe</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        A dataframe containing the filtered data from the primary database table.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    Example</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    -------</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    &gt;&gt;&gt; vrdb = YourDatabaseClass()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    &gt;&gt;&gt; df = vrdb.get_table(imaging=True)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    &gt;&gt;&gt; df = vrdb.get_table(mouseName=&#39;ATL028&#39;, sessionID=(5, &#39;&gt;&#39;))</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="n">field_names</span><span class="p">,</span> <span class="n">table_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">()</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">field_names</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="n">conditions</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="p">)</span> <span class="k">if</span> <span class="n">use_default</span> <span class="k">else</span> <span class="p">{}</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="n">conditions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">if</span> <span class="n">conditions</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not a column name in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="n">conditions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_filter_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># make sure it&#39;s a value/operation pair</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">construct_filter_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val_op_tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val_op_tuple</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.open_cursor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.open_cursor" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Context manager to open a database cursor and manage connections.</p>
<p>This context manager provides a convenient way to open a cursor to the database,
perform database operations, and manage connections. It also allows you to
commit changes if needed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>commit_changes</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to commit changes to the database. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyodbc.Cursor">Cursor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A database cursor for executing SQL queries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an error occurs while connecting to the database.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Use the context manager to perform database operations:</p>
<blockquote>
<blockquote>
<blockquote>
<p>with self.open_cursor(commit_changes=True) as cursor:
...     cursor.execute("SELECT * FROM your_table")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="nd">@contextmanager</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="k">def</span><span class="w"> </span><span class="nf">open_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit_changes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">pyodbc</span><span class="o">.</span><span class="n">Cursor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    Context manager to open a database cursor and manage connections.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    This context manager provides a convenient way to open a cursor to the database,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    perform database operations, and manage connections. It also allows you to</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    commit changes if needed.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    commit_changes : bool, optional</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Whether to commit changes to the database. Default is False.</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    Yields</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    ------</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    pyodbc.Cursor</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        A database cursor for executing SQL queries.</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    ------</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    Exception</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        If an error occurs while connecting to the database.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Example</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    -------</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    Use the context manager to perform database operations:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    &gt;&gt;&gt; with self.open_cursor(commit_changes=True) as cursor:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    ...     cursor.execute(&quot;SELECT * FROM your_table&quot;)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="c1"># Attempt to open a cursor to the database</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="k">yield</span> <span class="n">cursor</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An exception occurred while trying to connect to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">raise</span> <span class="n">ex</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="c1"># if no exception was raised, commit changes</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">if</span> <span class="n">commit_changes</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="c1"># Always close the cursor and connection</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.process_filter_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_filter_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.process_filter_value" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Ensure filter value has an operation associated with it.</p>
<p>Filters are passed to pandas DataFrame queries as {key}{operation}{value}.
This method ensures each value is a tuple of (value, operation), defaulting
to '==' if no operation is specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>val</code>
            </td>
            <td>
                  <code><span title="any">any</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter value. If a tuple, should be (value, operation). If not a tuple,
will be converted to (val, '==').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (value, operation) for use in DataFrame queries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_filter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    Ensure filter value has an operation associated with it.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Filters are passed to pandas DataFrame queries as {key}{operation}{value}.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    This method ensures each value is a tuple of (value, operation), defaulting</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    to &#39;==&#39; if no operation is specified.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    val : any or tuple</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        Filter value. If a tuple, should be (value, operation). If not a tuple,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        will be converted to (val, &#39;==&#39;).</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    -------</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        Tuple of (value, operation) for use in DataFrame queries.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;==&quot;</span><span class="p">)</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="k">return</span> <span class="n">val</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.process_unique_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_unique_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.process_unique_fields" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process and validate unique field definitions.</p>
<p>Converts unique field specifications into a standardized format where each
field is a tuple of (field_name, field_type). String fields can be specified
as just the name and will default to str type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of field specifications. Each can be:
- A string (field name, defaults to str type)
- A tuple of (field_name, type) where type is a Python type class</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tuples, each containing (field_name, field_type).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a field specification is not a string or a valid (string, type) tuple.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_unique_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Process and validate unique field definitions.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Converts unique field specifications into a standardized format where each</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    field is a tuple of (field_name, field_type). String fields can be specified</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    as just the name and will default to str type.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    fields : list</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        List of field specifications. Each can be:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        - A string (field name, defaults to str type)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        - A tuple of (field_name, type) where type is a Python type class</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    -------</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    list</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        List of tuples, each containing (field_name, field_type).</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    ------</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        If a field specification is not a string or a valid (string, type) tuple.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">ufields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">type</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">ufields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">ufields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unique field </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> must be a string or a string-type tuple&quot;</span><span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">return</span> <span class="n">ufields</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.save_backup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_backup</span><span class="p">(</span><span class="n">return_out</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.save_backup" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Save a backup of the database to the backup path specified in metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>return_out</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the output of the robocopy command.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="subprocess.CompletedProcess">CompletedProcess</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CompletedProcess object from the robocopy command (if return_out is True).
Returns None if return_out is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_out</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CompletedProcess</span><span class="p">]:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a backup of the database to the backup path specified in metadata.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    return_out : bool, optional</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        If True, return the output of the robocopy command.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    -------</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    CompletedProcess or None</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        CompletedProcess object from the robocopy command (if return_out is True).</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        Returns None if return_out is False.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="n">target_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">source_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">robocopy_arguments</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;robocopy </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">source_file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">outs</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">robocopy_arguments</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">if</span> <span class="n">return_out</span><span class="p">:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">return</span> <span class="n">outs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.show_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_metadata</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.BaseDatabase.show_metadata" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Display metadata associated with the open database.</p>
<p>Prints information about the database location, name, table, unique ID field,
backup path, and default filtering conditions.</p>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="k">def</span><span class="w"> </span><span class="nf">show_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    Display metadata associated with the open database.</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    Prints information about the database location, name, table, unique ID field,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    backup path, and default filtering conditions.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host_type</span><span class="si">}</span><span class="s2"> database located at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_ext</span><span class="si">}</span><span class="s2">, table name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">, with uid: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Backup path located at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No backup path specified...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Default database filters:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_filter_string</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_filter_value</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No default filters.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.table_column_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">table_column_info</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.BaseDatabase.table_column_info" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Retrieve the column names, data types, and nullable status of the table.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing three elements:
- A list of strings representing the column names of the table.
- A list of strings representing the data types of the table.
- A list of booleans representing the nullable status of the table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="k">def</span><span class="w"> </span><span class="nf">table_column_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Retrieve the column names, data types, and nullable status of the table.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    -------</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">        A tuple containing three elements:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        - A list of strings representing the column names of the table.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        - A list of strings representing the data types of the table.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        - A list of booleans representing the nullable status of the table.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> WHERE 1=0&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">column_descriptions</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">column_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">column_descriptions</span><span class="p">))</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="k">return</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">nullable</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.table_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">table_data</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.BaseDatabase.table_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Retrieve data and field names from the specified table.</p>
<p>This method retrieves the field names and table elements from the table specified
in the <code>BaseDatabase</code> instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing two elements:
- A list of strings representing the field names of the table.
- A list of tuples representing the data rows of the table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="k">def</span><span class="w"> </span><span class="nf">table_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    Retrieve data and field names from the specified table.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">    This method retrieves the field names and table elements from the table specified</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    in the `BaseDatabase` instance.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    -------</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        A tuple containing two elements:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        - A list of strings representing the field names of the table.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">        - A list of tuples representing the data rows of the table.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">column_name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">table_elements</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="k">return</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">table_elements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.BaseDatabase.update_database_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_database_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.BaseDatabase.update_database_field" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Update a database field for all records matching specified conditions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val</code>
            </td>
            <td>
                  <code><span title="any">any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to set for the field.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filtering conditions to identify records to update.
See get_table() documentation for filtering syntax.
Examples: <code>mouseName='ATL028'</code>, <code>imaging=True</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AssertionError">AssertionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified field is not in the database table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_database_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    Update a database field for all records matching specified conditions.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    field : str</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        Name of the field to update.</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    val : any</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        Value to set for the field.</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        Filtering conditions to identify records to update.</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        Examples: ``mouseName=&#39;ATL028&#39;``, ``imaging=True``</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    ------</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">    AssertionError</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        If the specified field is not in the database table.</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="k">assert</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Requested field (</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">) is not in table. Use &#39;self.table_data()[0]&#39; to see available fields.&quot;</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">update_statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">uids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># uids of all sessions requested</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="n">val_as_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">uids</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> for all requested records...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">update_statement</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">val_as_list</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="vrAnalysis.database.SessionDatabase" class="doc doc-heading">
            <code>SessionDatabase</code>


<a href="#vrAnalysis.database.SessionDatabase" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseDatabase (vrAnalysis.database.BaseDatabase)" href="#vrAnalysis.database.BaseDatabase">BaseDatabase</a></code></p>


        <p>Database class for handling VR session data.</p>
<p>Specialized database class that extends BaseDatabase with session-specific
functionality, including methods for creating session objects, managing
registration workflows, and handling quality control processes.</p>








              <details class="quote">
                <summary>Source code in <code>vrAnalysis/database.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="k">class</span><span class="w"> </span><span class="nc">SessionDatabase</span><span class="p">(</span><span class="n">BaseDatabase</span><span class="p">):</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    Database class for handling VR session data.</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">    Specialized database class that extends BaseDatabase with session-specific</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    functionality, including methods for creating session objects, managing</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    registration workflows, and handling quality control processes.</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">B2Session</span><span class="p">]:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over sessions matching conditions.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        session_params : dict, default={}</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">            Additional parameters to pass to the session constructor when creating</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">            B2Session objects. These are passed through to B2Session.create().</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">            Examples: ``mouseName=&#39;ATL028&#39;``, ``imaging=True``, ``sessionID=(5, &#39;&gt;&#39;)``</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        -------</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">        sessions : list[B2Session]</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">            List of sessions matching the conditions.</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B2Session</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;mouseName&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionDate&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionID&quot;</span><span class="p">]),</span> <span class="n">params</span><span class="o">=</span><span class="n">session_params</span><span class="p">))</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="k">return</span> <span class="n">sessions</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="c1"># == EVERYTHING BELOW HERE IS THE SAME AS THE ORIGINAL DATABASE CLASS ==</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="c1"># == It should be refactored to use the new vrAnalysis classes eventually, but I&#39;m leaving it here for now ==</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="c1"># == It should work as is as long as vrAnalysis stays on the path! ==</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="c1"># == vrExperiment related methods ==</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">session_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">        Extract session identifiers from a database record.</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">        row : pandas.Series</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">            Database record containing session information.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        -------</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">            Tuple of (mouse_name, session_date, session_id) where session_date is</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">            formatted as &#39;YYYY-MM-DD&#39; and session_id is converted to string.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">mouse_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mouseName&quot;</span><span class="p">]</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">session_date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionID&quot;</span><span class="p">])</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="k">return</span> <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_b2session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B2Session</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        Create a B2Session object from a database record.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        row : pandas.Series</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">            Database record containing session information.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        -------</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">        B2Session</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">            Session object initialized with data from the record.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="k">return</span> <span class="n">B2Session</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_b2registration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">B2RegistrationOpts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B2Registration</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">        Create a B2Registration object from a database record.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        row : pandas.Series</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">            Database record containing session information.</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">        opts : B2RegistrationOpts</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">            Registration options to use for the session.</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">        -------</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        B2Registration</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">            Registration object initialized with session data and options.</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="k">return</span> <span class="n">B2Registration</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="c1"># == helper functions for figuring out what needs work ==</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_registration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        Get or print sessions that need registration preprocessing.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        skip_errors : bool, default=True</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">            If True, exclude sessions that had registration errors.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        return_df : bool, default=True</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">            If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        -------</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">        pandas.DataFrame or None</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">            If return_df=True, returns DataFrame containing sessions that need registration.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">            If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="k">if</span> <span class="n">skip_errors</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session needs registration: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_s2p_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">        Update suite2p creation dates in the database based on file modification times.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        For all sessions where suite2p processing is complete, finds the most recent</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        file modification time in the suite2p output directory and updates the</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        suite2pDate field in the database.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="n">s2p_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">uids</span> <span class="o">=</span> <span class="n">s2p_done</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="n">s2p_creation_date</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s2p_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  <span class="c1"># create vrSession to point to session folder</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>            <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()):</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                    <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="n">c_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>            <span class="n">s2p_creation_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_date_time</span><span class="p">)</span>  <span class="c1"># get suite2p path creation date</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="s2">&quot;suite2pDate&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s2p_creation_date</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_s2p</span><span class="p">(</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">needs_qc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">print_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        Get or print sessions that need suite2p processing or quality control.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">        needs_qc : bool, default=False</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">            If False, returns/prints sessions that need suite2p processing.</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">            If True, returns/prints sessions that need suite2p quality control.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">        return_df : bool, default=True</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">            If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">        print_targets : bool, default=True</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">            If True and return_df=False, prints suite2p target information for sessions needing processing.</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">        -------</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">        pandas.DataFrame or None</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">            If return_df=True, returns DataFrame containing sessions that need suite2p processing or QC.</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">            If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="k">if</span> <span class="n">needs_qc</span><span class="p">:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2pQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>            <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                <span class="k">if</span> <span class="n">needs_qc</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that suite2p has been run but not QC&#39;d: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that suite2p has not been run: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                    <span class="k">if</span> <span class="n">print_targets</span><span class="p">:</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                        <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                        <span class="n">s2p_targets</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_s2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_database_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">        Verify suite2p status consistency between database and file system.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">        Checks for discrepancies where:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">        - Database says suite2p is done but files don&#39;t exist</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">        - Files exist but database says suite2p wasn&#39;t done</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">        with_database_update : bool, default=False</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">            If True, automatically corrects database entries when discrepancies are found.</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">        return_check : bool, default=False</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">            If True, returns a boolean indicating whether any discrepancies were found.</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">        -------</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">        bool or None</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">            If return_check is True, returns True if any discrepancies were found,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">            False otherwise. Returns None if return_check is False.</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="c1"># Check sessions where database says suite2p is done but files don&#39;t exist</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">check_s2p_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="n">checked_not_done</span> <span class="o">=</span> <span class="n">check_s2p_done</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="n">not_actually_done</span> <span class="o">=</span> <span class="n">check_s2p_done</span><span class="p">[</span><span class="n">checked_not_done</span><span class="p">]</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="c1"># Check sessions where files exist but database says suite2p wasn&#39;t done</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>        <span class="n">check_s2p_needed</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>        <span class="n">checked_not_needed</span> <span class="o">=</span> <span class="n">check_s2p_needed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="n">not_actually_needed</span> <span class="o">=</span> <span class="n">check_s2p_needed</span><span class="p">[</span><span class="n">checked_not_needed</span><span class="p">]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>        <span class="c1"># Print database errors to workspace</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database said suite2p has been ran, but it actually hasn&#39;t: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_needed</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database said suite2p didn&#39;t run, but it already did: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="c1"># If with_database_update is True, correct the database</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="k">if</span> <span class="n">with_database_update</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;suite2p&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_needed</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;suite2p&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="c1"># If return_check is requested, return True if any records were invalid</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>        <span class="k">if</span> <span class="n">return_check</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="k">return</span> <span class="n">checked_not_done</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">checked_not_needed</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>    <span class="c1"># == for communicating with the database about red cell quality control ==</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_red_cell_qc_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">        Update red cell QC dates in the database based on file modification times.</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">        For all sessions where red cell QC is complete, finds the most recent</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">        modification time of relevant red cell QC files and updates the</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">        redCellQCDate field in the database.</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="n">relevant_one_files</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="s2">&quot;mpciROIs.redCellIdx.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>            <span class="s2">&quot;mpciROIs.redCellManualAssignment.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="s2">&quot;parametersRed*&quot;</span><span class="p">,</span>  <span class="c1"># wildcard because there are multiple possibilities</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="p">]</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="n">red_cell_qc_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="n">uids</span> <span class="o">=</span> <span class="n">red_cell_qc_done</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="n">rc_edit_date</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">red_cell_qc_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  <span class="c1"># create vrSession to point to session folder</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_one_files</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">one_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                    <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="n">c_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="n">rc_edit_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_date_time</span><span class="p">)</span>  <span class="c1"># get red cell QC file modification date</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rc_edit_date</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        Get or print sessions that need red cell quality control.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">        return_df : bool, default=True</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">            If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">        -------</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">        pandas.DataFrame or None</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">            If return_df=True, returns DataFrame containing sessions that need red cell QC.</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">            Sessions must have imaging, suite2p processing, and registration completed.</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">            If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that redCellQC has not been performed for session: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_sessions_need_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">B2Session</span><span class="p">]:</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">        Get list of sessions that require red cell quality control.</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">        -------</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        list[B2Session]</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">            List of session objects that need red cell QC.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_red_cell_qc</span><span class="p">(</span><span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>        <span class="k">return</span> <span class="n">sessions</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">        Set the red cell QC status for a specific session.</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">        mouse_name : str</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">            Mouse name identifier.</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">        date_string : str</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">            Session date in &#39;YYYY-MM-DD&#39; format.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">        session_id : str or int</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">            Session ID.</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">        state : bool, default=True</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">            Red cell QC status to set. If True, also sets the QC date to now.</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">        bool</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">            True if update was successful, False otherwise.</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">date_string</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find session </span><span class="si">{</span><span class="n">mouse_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_string</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> in database.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="n">state</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                    <span class="c1"># If setting red cell QC to true, add the date</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                        <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                    <span class="c1"># Otherwise remove the date</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update database for session: </span><span class="si">{</span><span class="n">mouse_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_string</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="c1"># == operating vrExperiment pipeline ==</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        Perform registration preprocessing for a single session record.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        Creates a B2Registration object and runs preprocessing. Updates the database</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        with success/failure status and error information if applicable.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">        record : pandas.Series</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">            Database record containing session information.</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        raise_exception : bool, default=False</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">            If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">        imaging : bool, optional</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">            Override the imaging setting. If None (default), uses the value from the</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">            database record. If True or False, overrides the database value.</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">        tuple</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">            Tuple of (success, data_size) where:</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">            - success: bool indicating if registration succeeded</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">            - data_size: int size in bytes of registered oneData (0 if failed)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">        On failure, clears all oneData files and updates database error fields.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">        On success, updates registration status and date in the database.</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="n">opts</span> <span class="o">=</span> <span class="n">B2RegistrationOpts</span><span class="p">()</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>        <span class="n">opts</span><span class="o">.</span><span class="n">imaging</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">imaging</span><span class="p">)</span> <span class="k">if</span> <span class="n">imaging</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">bool</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="n">opts</span><span class="o">.</span><span class="n">facecam</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;faceCamera&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="n">opts</span><span class="o">.</span><span class="n">vrBehaviorVersion</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;vrBehaviorVersion&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="n">b2reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2registration</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registering data for session: </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>            <span class="n">b2reg</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationException&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                <span class="k">raise</span> <span class="n">ex</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following exception was raised when trying to preprocess session: </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">. Clearing all oneData.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">b2reg</span><span class="o">.</span><span class="n">clear_one_data</span><span class="p">(</span><span class="n">certainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="n">error_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="n">error_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="c1"># If failed, return (False, 0)</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>                <span class="c1"># Tell the database that vrRegistration was performed and the time of processing</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationException&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                <span class="p">)</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>            <span class="c1"># If successful, return (True, size of registered oneData)</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">sum</span><span class="p">([</span><span class="n">one_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">one_file</span> <span class="ow">in</span> <span class="n">b2reg</span><span class="o">.</span><span class="n">get_saved_one</span><span class="p">()]))</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2"> registered with </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> oneData.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>            <span class="k">del</span> <span class="n">b2reg</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_single_session</span><span class="p">(</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="n">mouse_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">session_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">session_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        Register a single session by its identifiers.</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        mouse_name : str</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">            Mouse name identifier.</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        session_date : str</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">            Session date in &#39;YYYY-MM-DD&#39; format.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        session_id : str or int</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">            Session ID.</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">        raise_exception : bool, default=False</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">            If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">        imaging : bool, optional</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="sd">            Override the imaging setting. If None (default), uses the value from the</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">            database record. If True or False, overrides the database value to enable</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">            or disable imaging processing during registration.</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">        -------</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">        bool or None</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">            True if registration succeeded, False if failed, None if session not found.</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>        <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">mouse_name</span><span class="p">,</span><span class="w"> </span><span class="n">session_date</span><span class="p">,</span><span class="w"> </span><span class="n">session_id</span><span class="p">])</span><span class="si">}</span><span class="s2"> is not in the database&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>            <span class="k">return</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_record</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="n">imaging</span><span class="p">)</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_sessions</span><span class="p">(</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>        <span class="n">max_data</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30e9</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>        <span class="n">skip_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">        Register multiple sessions that need registration.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">        Processes sessions in batches, stopping when the total data size limit is reached.</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><span class="sd">        Provides progress updates including accumulated data size and estimates.</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">        max_data : float, default=30e9</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="sd">            Maximum total data size (in bytes) to process before stopping.</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">            Default is 30 GB.</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">        skip_errors : bool, default=True</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">            If True, skip sessions that had previous registration errors.</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="sd">        raise_exception : bool, default=False</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="sd">            If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="sd">        imaging : bool, optional</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="sd">            Override the imaging setting for all sessions. If None (default), uses the</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="sd">            value from each session&#39;s database record. If True or False, overrides the</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="sd">            database value for all sessions to enable or disable imaging processing.</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">        -----</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><span class="sd">        Prints progress information including:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><span class="sd">        - Accumulated oneData registered</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">        - Average data size per session</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">        - Estimated remaining data to process</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="n">count_sessions</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="n">total_one_data</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="n">df_to_register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_registration</span><span class="p">(</span><span class="n">skip_errors</span><span class="o">=</span><span class="n">skip_errors</span><span class="p">)</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_to_register</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            <span class="k">if</span> <span class="n">total_one_data</span> <span class="o">&gt;</span> <span class="n">max_data</span><span class="p">:</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Max data limit reached. Total processed: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="p">)</span><span class="si">}</span><span class="s2">. Limit: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">max_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>                <span class="k">return</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_record</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="n">imaging</span><span class="p">)</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>            <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                <span class="n">count_sessions</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># count successful sessions</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="n">total_one_data</span> <span class="o">+=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># accumulated oneData registered</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                <span class="n">estimate_remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_to_register</span><span class="p">)</span> <span class="o">-</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                    <span class="sa">f</span><span class="s2">&quot;Accumulated oneData registered: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                    <span class="sa">f</span><span class="s2">&quot;Averaging: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="o">/</span><span class="n">count_sessions</span><span class="p">)</span><span class="si">}</span><span class="s2"> / session. &quot;</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                    <span class="sa">f</span><span class="s2">&quot;Estimate remaining: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="o">/</span><span class="n">count_sessions</span><span class="o">*</span><span class="n">estimate_remaining</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                <span class="p">)</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_registration_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">        Print registration errors for sessions that failed registration.</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">        **kw_conditions : dict, optional</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">            Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">            See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">))</span><span class="si">}</span><span class="s2"> had error: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vrRegistrationException&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.check_s2p" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_s2p</span><span class="p">(</span><span class="n">with_database_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.check_s2p" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Verify suite2p status consistency between database and file system.</p>
<p>Checks for discrepancies where:
- Database says suite2p is done but files don't exist
- Files exist but database says suite2p wasn't done</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>with_database_update</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, automatically corrects database entries when discrepancies are found.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_check</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, returns a boolean indicating whether any discrepancies were found.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_check is True, returns True if any discrepancies were found,
False otherwise. Returns None if return_check is False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_s2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_database_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">    Verify suite2p status consistency between database and file system.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a><span class="sd">    Checks for discrepancies where:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">    - Database says suite2p is done but files don&#39;t exist</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">    - Files exist but database says suite2p wasn&#39;t done</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">    with_database_update : bool, default=False</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">        If True, automatically corrects database entries when discrepancies are found.</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">    return_check : bool, default=False</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">        If True, returns a boolean indicating whether any discrepancies were found.</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    -------</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">    bool or None</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">        If return_check is True, returns True if any discrepancies were found,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">        False otherwise. Returns None if return_check is False.</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>    <span class="c1"># Check sessions where database says suite2p is done but files don&#39;t exist</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>    <span class="n">check_s2p_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>    <span class="n">checked_not_done</span> <span class="o">=</span> <span class="n">check_s2p_done</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>    <span class="n">not_actually_done</span> <span class="o">=</span> <span class="n">check_s2p_done</span><span class="p">[</span><span class="n">checked_not_done</span><span class="p">]</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="c1"># Check sessions where files exist but database says suite2p wasn&#39;t done</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>    <span class="n">check_s2p_needed</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>    <span class="n">checked_not_needed</span> <span class="o">=</span> <span class="n">check_s2p_needed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>    <span class="n">not_actually_needed</span> <span class="o">=</span> <span class="n">check_s2p_needed</span><span class="p">[</span><span class="n">checked_not_needed</span><span class="p">]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="c1"># Print database errors to workspace</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database said suite2p has been ran, but it actually hasn&#39;t: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_needed</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database said suite2p didn&#39;t run, but it already did: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="c1"># If with_database_update is True, correct the database</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="k">if</span> <span class="n">with_database_update</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;suite2p&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">not_actually_needed</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;suite2p&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>    <span class="c1"># If return_check is requested, return True if any records were invalid</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span class="k">if</span> <span class="n">return_check</span><span class="p">:</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="k">return</span> <span class="n">checked_not_done</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">checked_not_needed</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.iter_sessions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iter_sessions</span><span class="p">(</span><span class="n">session_params</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.iter_sessions" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Iterate over sessions matching conditions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session_params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional parameters to pass to the session constructor when creating
B2Session objects. These are passed through to B2Session.create().</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.
Examples: <code>mouseName='ATL028'</code>, <code>imaging=True</code>, <code>sessionID=(5, '&gt;')</code></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sessions</code></td>            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="B2Session


  
      dataclass
   (vrAnalysis.sessions.B2Session)" href="../b2session/#vrAnalysis.sessions.B2Session">B2Session</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of sessions matching the conditions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="k">def</span><span class="w"> </span><span class="nf">iter_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">B2Session</span><span class="p">]:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over sessions matching conditions.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    session_params : dict, default={}</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        Additional parameters to pass to the session constructor when creating</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        B2Session objects. These are passed through to B2Session.create().</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        Examples: ``mouseName=&#39;ATL028&#39;``, ``imaging=True``, ``sessionID=(5, &#39;&gt;&#39;)``</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    -------</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">    sessions : list[B2Session]</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">        List of sessions matching the conditions.</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B2Session</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;mouseName&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionDate&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionID&quot;</span><span class="p">]),</span> <span class="n">params</span><span class="o">=</span><span class="n">session_params</span><span class="p">))</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="k">return</span> <span class="n">sessions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.iter_sessions_need_red_cell_qc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iter_sessions_need_red_cell_qc</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.iter_sessions_need_red_cell_qc" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get list of sessions that require red cell quality control.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="B2Session


  
      dataclass
   (vrAnalysis.sessions.B2Session)" href="../b2session/#vrAnalysis.sessions.B2Session">B2Session</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of session objects that need red cell QC.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="k">def</span><span class="w"> </span><span class="nf">iter_sessions_need_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">B2Session</span><span class="p">]:</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    Get list of sessions that require red cell quality control.</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">    -------</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">    list[B2Session]</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        List of session objects that need red cell QC.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_red_cell_qc</span><span class="p">(</span><span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>    <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>    <span class="k">return</span> <span class="n">sessions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.make_b2registration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_b2registration</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.make_b2registration" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a B2Registration object from a database record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database record containing session information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opts</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="B2RegistrationOpts


  
      dataclass
   (vrAnalysis.sessions.b2session.B2RegistrationOpts)" href="../b2session/#vrAnalysis.sessions.b2session.B2RegistrationOpts">B2RegistrationOpts</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Registration options to use for the session.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="B2Registration


  
      dataclass
   (vrAnalysis.registration.B2Registration)" href="../registration/#vrAnalysis.registration.B2Registration">B2Registration</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Registration object initialized with session data and options.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_b2registration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">B2RegistrationOpts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B2Registration</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    Create a B2Registration object from a database record.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    row : pandas.Series</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">        Database record containing session information.</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    opts : B2RegistrationOpts</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        Registration options to use for the session.</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">    -------</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">    B2Registration</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">        Registration object initialized with session data and options.</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="k">return</span> <span class="n">B2Registration</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.make_b2session" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.make_b2session" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a B2Session object from a database record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database record containing session information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="B2Session


  
      dataclass
   (vrAnalysis.sessions.B2Session)" href="../b2session/#vrAnalysis.sessions.B2Session">B2Session</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session object initialized with data from the record.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_b2session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B2Session</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    Create a B2Session object from a database record.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">    row : pandas.Series</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        Database record containing session information.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">    -------</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">    B2Session</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">        Session object initialized with data from the record.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="k">return</span> <span class="n">B2Session</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.needs_red_cell_qc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">needs_red_cell_qc</span><span class="p">(</span><span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.needs_red_cell_qc" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get or print sessions that need red cell quality control.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>return_df</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, returns a DataFrame. If False, prints the sessions instead.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_df=True, returns DataFrame containing sessions that need red cell QC.
Sessions must have imaging, suite2p processing, and registration completed.
If return_df=False, returns None and prints the sessions instead.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span>
<span class="normal"><a href="#__codelineno-0-981">981</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="k">def</span><span class="w"> </span><span class="nf">needs_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    Get or print sessions that need red cell quality control.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">    return_df : bool, default=True</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    -------</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">    pandas.DataFrame or None</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">        If return_df=True, returns DataFrame containing sessions that need red cell QC.</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">        Sessions must have imaging, suite2p processing, and registration completed.</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">        If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that redCellQC has not been performed for session: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.needs_registration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">needs_registration</span><span class="p">(</span><span class="n">skip_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.needs_registration" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get or print sessions that need registration preprocessing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>skip_errors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, exclude sessions that had registration errors.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_df</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, returns a DataFrame. If False, prints the sessions instead.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_df=True, returns DataFrame containing sessions that need registration.
If return_df=False, returns None and prints the sessions instead.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="k">def</span><span class="w"> </span><span class="nf">needs_registration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">    Get or print sessions that need registration preprocessing.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    skip_errors : bool, default=True</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        If True, exclude sessions that had registration errors.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">    return_df : bool, default=True</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    -------</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">    pandas.DataFrame or None</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        If return_df=True, returns DataFrame containing sessions that need registration.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="k">if</span> <span class="n">skip_errors</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session needs registration: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.needs_s2p" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">needs_s2p</span><span class="p">(</span><span class="n">needs_qc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.needs_s2p" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get or print sessions that need suite2p processing or quality control.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>needs_qc</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False, returns/prints sessions that need suite2p processing.
If True, returns/prints sessions that need suite2p quality control.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_df</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, returns a DataFrame. If False, prints the sessions instead.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_targets</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True and return_df=False, prints suite2p target information for sessions needing processing.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_df=True, returns DataFrame containing sessions that need suite2p processing or QC.
If return_df=False, returns None and prints the sessions instead.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="k">def</span><span class="w"> </span><span class="nf">needs_s2p</span><span class="p">(</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">needs_qc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_df</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">print_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">    Get or print sessions that need suite2p processing or quality control.</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">    needs_qc : bool, default=False</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">        If False, returns/prints sessions that need suite2p processing.</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">        If True, returns/prints sessions that need suite2p quality control.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">    return_df : bool, default=True</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">        If True, returns a DataFrame. If False, prints the sessions instead.</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">    print_targets : bool, default=True</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">        If True and return_df=False, prints suite2p target information for sessions needing processing.</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="sd">    -------</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    pandas.DataFrame or None</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">        If return_df=True, returns DataFrame containing sessions that need suite2p processing or QC.</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">        If return_df=False, returns None and prints the sessions instead.</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="k">if</span> <span class="n">needs_qc</span><span class="p">:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2pQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>    <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="k">if</span> <span class="n">needs_qc</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that suite2p has been run but not QC&#39;d: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database indicates that suite2p has not been run: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                <span class="k">if</span> <span class="n">print_targets</span><span class="p">:</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                    <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                    <span class="n">s2p_targets</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.print_registration_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_registration_errors</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.print_registration_errors" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Print registration errors for sessions that failed registration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kw_conditions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional filtering conditions passed to get_table().
See get_table() documentation for filtering syntax.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="k">def</span><span class="w"> </span><span class="nf">print_registration_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_conditions</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">    Print registration errors for sessions that failed registration.</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">    **kw_conditions : dict, optional</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">        Additional filtering conditions passed to get_table().</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">        See get_table() documentation for filtering syntax.</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="o">**</span><span class="n">kw_conditions</span><span class="p">)</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">))</span><span class="si">}</span><span class="s2"> had error: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vrRegistrationException&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.register_record" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_record</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.register_record" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Perform registration preprocessing for a single session record.</p>
<p>Creates a B2Registration object and runs preprocessing. Updates the database
with success/failure status and error information if applicable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>record</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database record containing session information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_exception</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raises exceptions instead of handling them silently.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>imaging</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Override the imaging setting. If None (default), uses the value from the
database record. If True or False, overrides the database value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (success, data_size) where:
- success: bool indicating if registration succeeded
- data_size: int size in bytes of registered oneData (0 if failed)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>On failure, clears all oneData files and updates database error fields.
On success, updates registration status and date in the database.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    Perform registration preprocessing for a single session record.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    Creates a B2Registration object and runs preprocessing. Updates the database</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    with success/failure status and error information if applicable.</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">    record : pandas.Series</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        Database record containing session information.</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">    raise_exception : bool, default=False</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">    imaging : bool, optional</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><span class="sd">        Override the imaging setting. If None (default), uses the value from the</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">        database record. If True or False, overrides the database value.</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="sd">        Tuple of (success, data_size) where:</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="sd">        - success: bool indicating if registration succeeded</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="sd">        - data_size: int size in bytes of registered oneData (0 if failed)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">    On failure, clears all oneData files and updates database error fields.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">    On success, updates registration status and date in the database.</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">B2RegistrationOpts</span><span class="p">()</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="n">opts</span><span class="o">.</span><span class="n">imaging</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">imaging</span><span class="p">)</span> <span class="k">if</span> <span class="n">imaging</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">bool</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="n">opts</span><span class="o">.</span><span class="n">facecam</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;faceCamera&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="n">opts</span><span class="o">.</span><span class="n">vrBehaviorVersion</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;vrBehaviorVersion&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="n">b2reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2registration</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Registering data for session: </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>        <span class="n">b2reg</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationException&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>            <span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="k">if</span> <span class="n">raise_exception</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="k">raise</span> <span class="n">ex</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following exception was raised when trying to preprocess session: </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2">. Clearing all oneData.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="n">b2reg</span><span class="o">.</span><span class="n">clear_one_data</span><span class="p">(</span><span class="n">certainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>        <span class="n">error_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">extract_tb</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="n">error_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>        <span class="c1"># If failed, return (False, 0)</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="c1"># Tell the database that vrRegistration was performed and the time of processing</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistration&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationError&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationException&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;vrRegistrationDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>                <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>            <span class="p">)</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="c1"># If successful, return (True, size of registered oneData)</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="nb">sum</span><span class="p">([</span><span class="n">one_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">one_file</span> <span class="ow">in</span> <span class="n">b2reg</span><span class="o">.</span><span class="n">get_saved_one</span><span class="p">()]))</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="n">b2reg</span><span class="o">.</span><span class="n">session_print</span><span class="p">()</span><span class="si">}</span><span class="s2"> registered with </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> oneData.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>        <span class="k">del</span> <span class="n">b2reg</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.register_sessions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_sessions</span><span class="p">(</span><span class="n">max_data</span><span class="o">=</span><span class="mf">30000000000.0</span><span class="p">,</span> <span class="n">skip_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.register_sessions" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register multiple sessions that need registration.</p>
<p>Processes sessions in batches, stopping when the total data size limit is reached.
Provides progress updates including accumulated data size and estimates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_data</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum total data size (in bytes) to process before stopping.
Default is 30 GB.</p>
              </div>
            </td>
            <td>
                  <code>30e9</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_errors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, skip sessions that had previous registration errors.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_exception</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raises exceptions instead of handling them silently.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>imaging</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Override the imaging setting for all sessions. If None (default), uses the
value from each session's database record. If True or False, overrides the
database value for all sessions to enable or disable imaging processing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Prints progress information including:
- Accumulated oneData registered
- Average data size per session
- Estimated remaining data to process</p>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_sessions</span><span class="p">(</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>    <span class="n">max_data</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30e9</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>    <span class="n">skip_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>    <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>    <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">    Register multiple sessions that need registration.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">    Processes sessions in batches, stopping when the total data size limit is reached.</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><span class="sd">    Provides progress updates including accumulated data size and estimates.</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">    max_data : float, default=30e9</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="sd">        Maximum total data size (in bytes) to process before stopping.</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">        Default is 30 GB.</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">    skip_errors : bool, default=True</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">        If True, skip sessions that had previous registration errors.</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><span class="sd">    raise_exception : bool, default=False</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="sd">        If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="sd">    imaging : bool, optional</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="sd">        Override the imaging setting for all sessions. If None (default), uses the</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="sd">        value from each session&#39;s database record. If True or False, overrides the</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="sd">        database value for all sessions to enable or disable imaging processing.</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">    -----</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><span class="sd">    Prints progress information including:</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><span class="sd">    - Accumulated oneData registered</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">    - Average data size per session</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">    - Estimated remaining data to process</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>    <span class="n">count_sessions</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="n">total_one_data</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>    <span class="n">df_to_register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_registration</span><span class="p">(</span><span class="n">skip_errors</span><span class="o">=</span><span class="n">skip_errors</span><span class="p">)</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_to_register</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="k">if</span> <span class="n">total_one_data</span> <span class="o">&gt;</span> <span class="n">max_data</span><span class="p">:</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Max data limit reached. Total processed: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="p">)</span><span class="si">}</span><span class="s2">. Limit: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">max_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="k">return</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_record</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="n">imaging</span><span class="p">)</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>        <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="n">count_sessions</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># count successful sessions</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>            <span class="n">total_one_data</span> <span class="o">+=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># accumulated oneData registered</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>            <span class="n">estimate_remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_to_register</span><span class="p">)</span> <span class="o">-</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                <span class="sa">f</span><span class="s2">&quot;Accumulated oneData registered: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                <span class="sa">f</span><span class="s2">&quot;Averaging: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="o">/</span><span class="n">count_sessions</span><span class="p">)</span><span class="si">}</span><span class="s2"> / session. &quot;</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                <span class="sa">f</span><span class="s2">&quot;Estimate remaining: </span><span class="si">{</span><span class="n">readable_bytes</span><span class="p">(</span><span class="n">total_one_data</span><span class="o">/</span><span class="n">count_sessions</span><span class="o">*</span><span class="n">estimate_remaining</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.register_single_session" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_single_session</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.register_single_session" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Register a single session by its identifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mouse_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mouse name identifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_date</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session date in 'YYYY-MM-DD' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raise_exception</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, raises exceptions instead of handling them silently.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>imaging</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Override the imaging setting. If None (default), uses the value from the
database record. If True or False, overrides the database value to enable
or disable imaging processing during registration.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if registration succeeded, False if failed, None if session not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="k">def</span><span class="w"> </span><span class="nf">register_single_session</span><span class="p">(</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="n">mouse_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="n">session_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="n">raise_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="n">imaging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">    Register a single session by its identifiers.</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">    mouse_name : str</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        Mouse name identifier.</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">    session_date : str</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        Session date in &#39;YYYY-MM-DD&#39; format.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">    session_id : str or int</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">        Session ID.</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">    raise_exception : bool, default=False</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">        If True, raises exceptions instead of handling them silently.</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="sd">    imaging : bool, optional</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="sd">        Override the imaging setting. If None (default), uses the value from the</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><span class="sd">        database record. If True or False, overrides the database value to enable</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">        or disable imaging processing during registration.</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">    bool or None</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">        True if registration succeeded, False if failed, None if session not found.</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">mouse_name</span><span class="p">,</span><span class="w"> </span><span class="n">session_date</span><span class="p">,</span><span class="w"> </span><span class="n">session_id</span><span class="p">])</span><span class="si">}</span><span class="s2"> is not in the database&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>        <span class="k">return</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_record</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="n">imaging</span><span class="p">)</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>    <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.session_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">session_name</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.session_name" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Extract session identifiers from a database record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database record containing session information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (mouse_name, session_date, session_id) where session_date is
formatted as 'YYYY-MM-DD' and session_id is converted to string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="k">def</span><span class="w"> </span><span class="nf">session_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">    Extract session identifiers from a database record.</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">    row : pandas.Series</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        Database record containing session information.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">    -------</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">    tuple</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        Tuple of (mouse_name, session_date, session_id) where session_date is</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">        formatted as &#39;YYYY-MM-DD&#39; and session_id is converted to string.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="n">mouse_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mouseName&quot;</span><span class="p">]</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="n">session_date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="n">session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sessionID&quot;</span><span class="p">])</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="k">return</span> <span class="n">mouse_name</span><span class="p">,</span> <span class="n">session_date</span><span class="p">,</span> <span class="n">session_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.set_red_cell_qc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_red_cell_qc</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">date_string</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.SessionDatabase.set_red_cell_qc" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Set the red cell QC status for a specific session.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mouse_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mouse name identifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>date_string</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session date in 'YYYY-MM-DD' format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Session ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Red cell QC status to set. If True, also sets the QC date to now.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update was successful, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_red_cell_qc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouse_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    Set the red cell QC status for a specific session.</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">    mouse_name : str</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">        Mouse name identifier.</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">    date_string : str</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">        Session date in &#39;YYYY-MM-DD&#39; format.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">    session_id : str or int</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">        Session ID.</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">    state : bool, default=True</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">        Red cell QC status to set. If True, also sets the QC date to now.</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">    bool</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">        True if update was successful, False otherwise.</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_record</span><span class="p">(</span><span class="n">mouse_name</span><span class="p">,</span> <span class="n">date_string</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find session </span><span class="si">{</span><span class="n">mouse_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_string</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> in database.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="n">state</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                <span class="c1"># If setting red cell QC to true, add the date</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                    <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                <span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                <span class="c1"># Otherwise remove the date</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update database for session: </span><span class="si">{</span><span class="n">mouse_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_string</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.update_red_cell_qc_date_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_red_cell_qc_date_time</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.SessionDatabase.update_red_cell_qc_date_time" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Update red cell QC dates in the database based on file modification times.</p>
<p>For all sessions where red cell QC is complete, finds the most recent
modification time of relevant red cell QC files and updates the
redCellQCDate field in the database.</p>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_red_cell_qc_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">    Update red cell QC dates in the database based on file modification times.</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">    For all sessions where red cell QC is complete, finds the most recent</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    modification time of relevant red cell QC files and updates the</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">    redCellQCDate field in the database.</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="n">relevant_one_files</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="s2">&quot;mpciROIs.redCellIdx.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="s2">&quot;mpciROIs.redCellManualAssignment.npy&quot;</span><span class="p">,</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="s2">&quot;parametersRed*&quot;</span><span class="p">,</span>  <span class="c1"># wildcard because there are multiple possibilities</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="p">]</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="n">red_cell_qc_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;redCellQC&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="n">uids</span> <span class="o">=</span> <span class="n">red_cell_qc_done</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="n">rc_edit_date</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">red_cell_qc_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  <span class="c1"># create vrSession to point to session folder</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_one_files</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">one_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="n">c_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="n">rc_edit_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_date_time</span><span class="p">)</span>  <span class="c1"># get red cell QC file modification date</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="s2">&quot;redCellQCDate&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rc_edit_date</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="vrAnalysis.database.SessionDatabase.update_s2p_date_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_s2p_date_time</span><span class="p">()</span></code>

<a href="#vrAnalysis.database.SessionDatabase.update_s2p_date_time" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Update suite2p creation dates in the database based on file modification times.</p>
<p>For all sessions where suite2p processing is complete, finds the most recent
file modification time in the suite2p output directory and updates the
suite2pDate field in the database.</p>


            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_s2p_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">    Update suite2p creation dates in the database based on file modification times.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">    For all sessions where suite2p processing is complete, finds the most recent</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">    file modification time in the suite2p output directory and updates the</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    suite2pDate field in the database.</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="n">s2p_done</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;imaging&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;suite2p&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">uids</span> <span class="o">=</span> <span class="n">s2p_done</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="n">s2p_creation_date</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s2p_done</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_b2session</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  <span class="c1"># create vrSession to point to session folder</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">s2p_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()):</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="n">c_latest_mod</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>        <span class="n">c_date_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">c_latest_mod</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>        <span class="n">s2p_creation_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_date_time</span><span class="p">)</span>  <span class="c1"># get suite2p path creation date</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_cursor</span><span class="p">(</span><span class="n">commit_changes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_update_many_statement</span><span class="p">(</span><span class="s2">&quot;suite2pDate&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s2p_creation_date</span><span class="p">,</span> <span class="n">uids</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.database.get_database" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_database</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.get_database" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retrieve an appropriate database object instance.</p>
<p>This function retrieves metadata for the specified database and instantiates
the appropriate database class (BaseDatabase or a subclass like SessionDatabase).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the database to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="BaseDatabase (vrAnalysis.database.BaseDatabase)" href="#vrAnalysis.database.BaseDatabase">BaseDatabase</a> or <a class="autorefs autorefs-internal" title="SessionDatabase (vrAnalysis.database.SessionDatabase)" href="#vrAnalysis.database.SessionDatabase">SessionDatabase</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the appropriate database class as specified in the metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the constructor specified in metadata is not a subclass of BaseDatabase.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <p>get_database_metadata : Retrieve metadata for a database.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_database</span><span class="p">(</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BaseDatabase&quot;</span><span class="p">,</span> <span class="s2">&quot;SessionDatabase&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Retrieve an appropriate database object instance.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    This function retrieves metadata for the specified database and instantiates</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    the appropriate database class (BaseDatabase or a subclass like SessionDatabase).</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    db_name : str</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        The name of the database to retrieve.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    -------</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    BaseDatabase or SessionDatabase</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        An instance of the appropriate database class as specified in the metadata.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    ------</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        If the constructor specified in metadata is not a subclass of BaseDatabase.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    See Also</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    --------</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    get_database_metadata : Retrieve metadata for a database.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_database_metadata</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">if</span> <span class="s2">&quot;constructor&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;constructor&quot;</span><span class="p">],</span> <span class="n">BaseDatabase</span><span class="p">):</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">constructor</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;constructor&quot;</span><span class="p">]</span>  <span class="c1"># get class constructor method for this database</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;constructor&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must be a subclass of the `BaseDatabase` class!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">constructor</span> <span class="o">=</span> <span class="n">BaseDatabase</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">return</span> <span class="n">constructor</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="vrAnalysis.database.get_database_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_database_metadata</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span></code>

<a href="#vrAnalysis.database.get_database_metadata" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retrieve metadata for a specified database.</p>
<p>This function retrieves metadata for a specified database from the <code>dbdict</code> dictionary.
The <code>dbdict</code> dictionary contains the database paths, names, and primary table name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the database for which to retrieve metadata.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing metadata for the specified database.
It requires the following keys:
    'db_path': path to the database file
    'db_name': name of the database file
    'db_ext': extension of the database file
    'table_name': name of the table to use
    'uid': name of the field defining a unique ID for each row in the table
    'backup_path': path to the database backup (None if there isn't one)
    'unique_fields': list of names of fields for which there should only be one
                    database row per combination of the values in unique_fields
                    note: assumes string, but make it a tuple for different types
    'default_conditions': dictionary containing key-value pairs of any default
                         conditions to filter by when retrieving table data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the provided <code>db_name</code> is not recognized as a valid database name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>metadata = get_database_metadata('vrSessions')
print(metadata['db_path'])
'C:\Users\andrew\Documents\localData\vrDatabaseManagement'
print(metadata['db_name'])
'vrDatabase'</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The <code>dbdict</code> dictionary contains metadata for recognized databases.</li>
<li>Edit this function to specify the path, database, and primary table on your computer.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>vrAnalysis/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_database_metadata</span><span class="p">(</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Retrieve metadata for a specified database.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    This function retrieves metadata for a specified database from the `dbdict` dictionary.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    The `dbdict` dictionary contains the database paths, names, and primary table name.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    db_name : str</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        The name of the database for which to retrieve metadata.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    -------</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    dict</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        A dictionary containing metadata for the specified database.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        It requires the following keys:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            &#39;db_path&#39;: path to the database file</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            &#39;db_name&#39;: name of the database file</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            &#39;db_ext&#39;: extension of the database file</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            &#39;table_name&#39;: name of the table to use</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            &#39;uid&#39;: name of the field defining a unique ID for each row in the table</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            &#39;backup_path&#39;: path to the database backup (None if there isn&#39;t one)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            &#39;unique_fields&#39;: list of names of fields for which there should only be one</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                            database row per combination of the values in unique_fields</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                            note: assumes string, but make it a tuple for different types</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            &#39;default_conditions&#39;: dictionary containing key-value pairs of any default</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                                 conditions to filter by when retrieving table data</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    ------</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    ValueError</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        If the provided `db_name` is not recognized as a valid database name.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Example</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    -------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    &gt;&gt;&gt; metadata = get_database_metadata(&#39;vrSessions&#39;)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    &gt;&gt;&gt; print(metadata[&#39;db_path&#39;])</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &#39;C:\\Users\\andrew\\Documents\\localData\\vrDatabaseManagement&#39;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    &gt;&gt;&gt; print(metadata[&#39;db_name&#39;])</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &#39;vrDatabase&#39;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    -----</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    - The `dbdict` dictionary contains metadata for recognized databases.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    - Edit this function to specify the path, database, and primary table on your computer.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">dbdict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="s2">&quot;vrSessions&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="s2">&quot;db_path&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\andrew\Documents\localData\vrDatabaseManagement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="s2">&quot;db_name&quot;</span><span class="p">:</span> <span class="s2">&quot;vrDatabase&quot;</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="s2">&quot;db_ext&quot;</span><span class="p">:</span> <span class="s2">&quot;.accdb&quot;</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;sessiondb&quot;</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;uSessionID&quot;</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="s2">&quot;backup_path&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;D:\localData\vrDatabaseManagement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="s2">&quot;unique_fields&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;mouseName&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sessionDate&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sessionID&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)],</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="s2">&quot;default_conditions&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="s2">&quot;sessionQC&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="p">},</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="s2">&quot;constructor&quot;</span><span class="p">:</span> <span class="n">SessionDatabase</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="p">},</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="s2">&quot;vrMice&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="s2">&quot;db_path&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\andrew\Documents\localData\vrDatabaseManagement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="s2">&quot;db_name&quot;</span><span class="p">:</span> <span class="s2">&quot;vrDatabase&quot;</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="s2">&quot;db_ext&quot;</span><span class="p">:</span> <span class="s2">&quot;.accdb&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="s2">&quot;mousedb&quot;</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="s2">&quot;uMouseID&quot;</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="s2">&quot;backup_path&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;D:\localData\vrDatabaseManagement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="s2">&quot;unique_fields&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;mouseName&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)],</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="s2">&quot;default_conditions&quot;</span><span class="p">:</span> <span class="p">{},</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="s2">&quot;constructor&quot;</span><span class="p">:</span> <span class="n">BaseDatabase</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="p">},</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="p">}</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">if</span> <span class="n">db_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dbdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not recognize database=</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">, valid database names are: </span><span class="si">{</span><span class="p">[</span><span class="n">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dbdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">return</span> <span class="n">dbdict</span><span class="p">[</span><span class="n">db_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>